æˆ‘æŒ‰â€œæ¶æ„å±‚ â†’ äº¤äº’å±‚ â†’ å·¥ç¨‹å±‚ â†’ é£é™©å±‚â€çš„é¡ºåºç»™ä½ åšä¸€æ¬¡**åå·¥ç¨‹å®æˆ˜å‘çš„å®¡æŸ¥**ï¼Œé‡ç‚¹ä¸æ˜¯â€œå¥½ä¸å¥½â€ï¼Œè€Œæ˜¯ï¼š**å“ªé‡Œå°†æ¥ä¸€å®šä¼šç—›ï¼Œæ€ä¹ˆæå‰æ‹†é›·**ã€‚

---

# ğŸ§  ä¸€ã€æ•´ä½“è¯„ä»·ï¼ˆä¸€å¥è¯ç»“è®ºï¼‰

è¿™æ˜¯ä¸€ä¸ª**æ˜æ˜¾æœ‰æ¶æ„æ€ç»´çš„ä¸­å¤§å‹ TUI ç³»ç»Ÿæ–¹æ¡ˆ**ï¼Œå·²ç»è¶…è¿‡â€œèƒ½è·‘â€çš„å±‚çº§ï¼Œè¿›å…¥â€œæƒ³é•¿æœŸæ¼”è¿›â€çš„é˜¶æ®µã€‚
ä½†å½“å‰æœ€å¤§é£é™©æ˜¯ï¼š

> **æ¶æ„æ˜¯ Web æ€ç»´ + æ¸¸æˆå¼•æ“æ€ç»´çš„æ··åˆä½“ï¼Œä½†ç¼ºå°‘â€œç»ˆç«¯åœºæ™¯çº¦æŸä¸‹çš„è£å‰ªâ€**

ç®€å•è¯´ï¼š
**è®¾è®¡æ˜¯é«˜çº§çš„ï¼Œä½†â€œå¤æ‚åº¦é¢„ç®—â€è¿˜æ²¡æ”¶ä½ã€‚**
å¦‚æœç›´æ¥æŒ‰ç°æ–¹æ¡ˆå…¨é‡å®ç°ï¼ŒåæœŸæˆæœ¬ä¼šé«˜äºæ”¶ç›Šã€‚

---

# ğŸ§© äºŒã€æ¶æ„å±‚å®¡æŸ¥ï¼ˆæœ€å…³é”®ï¼‰

## 1ï¸âƒ£ Component + Flex + Absolute + Overlay å››ç³»ç»Ÿå¹¶å­˜ âš ï¸

ä½ ç°åœ¨æ˜¯å››å¥—å¸ƒå±€/æ¸²æŸ“æœºåˆ¶ï¼š

| ç³»ç»Ÿ              | ç”¨é€”   | é—®é¢˜            |
| --------------- | ---- | ------------- |
| Flex Layout     | å¸¸è§„UI | OK            |
| Absolute        | ç²¾å‡†å®šä½ | OK            |
| Overlay Manager | å¼¹å±‚   | â—é‡å¤èŒè´£         |
| ZIndex Layer    | åˆ†å±‚æ¸²æŸ“ | â—å’Œ Overlay é‡å  |

### ğŸš¨ æ¶æ„é£é™©

Overlay Manager æœ¬è´¨å°±æ˜¯ï¼š

```
Absolute + ZIndex + ç”Ÿå‘½å‘¨æœŸç®¡ç†
```

ä½ ç°åœ¨æŠŠå®ƒç‹¬ç«‹æˆç³»ç»Ÿï¼Œä¼šå¯¼è‡´ï¼š

* æ¸²æŸ“è·¯å¾„åˆ†å‰ï¼ˆä¸»æ ‘ vs overlayæ ‘ï¼‰
* äº‹ä»¶ç³»ç»ŸåŒè½¨ï¼ˆè°å…ˆå¤„ç†ï¼Ÿï¼‰
* focus ç®¡ç†å¤æ‚åº¦ç¿»å€
* å°†æ¥è¦åš Portal ä¼šå´©

### âœ… ä¼˜åŒ–å»ºè®®ï¼ˆéå¸¸å…³é”®ï¼‰

æŠŠ Overlay **é™çº§ä¸ºä¸€ç§ Component ç±»å‹ï¼Œè€Œä¸æ˜¯ç³»ç»Ÿ**ï¼š

```go
type Component interface {
    Render()
    HandleEvent()
    Children()
    Layer() int // æ–°å¢ï¼šå±‚çº§
    PositionMode() PositionMode // Flex | Absolute
}
```

Overlay åªæ˜¯ï¼š

```
Layer > Normal
PositionMode = Absolute
```

ğŸ‘‰ **æ”¶ç›Šï¼š**

* å•ä¸€æ¸²æŸ“æ ‘
* å•ä¸€äº‹ä»¶å†’æ³¡
* åªéœ€ä¸€ä¸ª ZIndex æ’åº
* å¤æ‚åº¦ â†“ 40%

---

## 2ï¸âƒ£ äº‹ä»¶ç³»ç»Ÿï¼šå½“å‰æ˜¯â€œUIæ¡†æ¶å†™æ³•â€ï¼Œä½†ä½ è¿™æ˜¯ TUI

ä½ æ–¹æ¡ˆé‡Œæ˜¯ï¼š

```
Event -> Component -> Bubbling -> StopPropagation
```

è¿™å¥—æ²¡é—®é¢˜ï¼Œä½†**ç»ˆç«¯åœºæ™¯æœ‰ä¸€ä¸ªç‰¹æ®Šé—®é¢˜**ï¼š

> **ç»ˆç«¯æ²¡æœ‰â€œé¼ æ ‡ä¼˜å…ˆâ€ï¼Œè€Œæ˜¯â€œç„¦ç‚¹ä¼˜å…ˆâ€**

Web æ˜¯â€œé¼ æ ‡å‘½ä¸­ â†’ focusâ€
TUI æ˜¯â€œfocus å†³å®šè¾“å…¥å½’å±â€

### ğŸš¨ é£é™©ç‚¹

å¦‚æœç»§ç»­æ²¿ç”¨ DOM å¼å†’æ³¡ï¼ŒåæœŸä¼šå‡ºç°ï¼š

* Modal æ‰“å¼€åï¼Œåº•å±‚ç»„ä»¶è¿˜èƒ½å“åº”å¿«æ·é”®
* å…¨å±€å¿«æ·é”®å’Œå±€éƒ¨å†²çª
* è¡¨å•å†… Esc è¢«å…¨å±€æ•è·

### âœ… å¿…é¡»åŠ çš„æœºåˆ¶

#### ğŸ¯ äº‹ä»¶ä¼˜å…ˆçº§æ¨¡å‹ï¼ˆTUI å¿…å¤‡ï¼‰

```
Key Event æµç¨‹ï¼š

1. Focused Component (æœ€é«˜ä¼˜å…ˆçº§)
2. Active Modal
3. Global Shortcuts
4. Root
```

è¿™ä¸æ˜¯ Bubblingï¼Œè¿™æ˜¯ **ä¼˜å…ˆçº§è°ƒåº¦æ¨¡å‹**ã€‚

---

## ğŸ® ä¸‰ã€æ¸²æŸ“å±‚å®¡æŸ¥ï¼ˆè¿™é‡Œå†³å®šæ€§èƒ½ä¸Šé™ï¼‰

ä½ æåˆ°ï¼š

> Measure â†’ Layout â†’ Paint

è¿™æ˜¯æ­£ç¡®æ–¹å‘ï¼Œä½†ç°åœ¨**è¿˜ä¸å¤Ÿç»ˆç«¯åŒ–**ã€‚

### ğŸš¨ ç»ˆç«¯å’Œ GUI æœ€å¤§å·®å¼‚ï¼š

ç»ˆç«¯æ¸²æŸ“æˆæœ¬åœ¨ **IO å†™å…¥ï¼Œä¸åœ¨ CPU è®¡ç®—**

æ‰€ä»¥çœŸæ­£å…³é”®ä¸æ˜¯å¸ƒå±€ç®—æ³•ï¼Œè€Œæ˜¯ï¼š

> **Dirty Region Diff ç®—æ³•**

### â—å½“å‰æ–¹æ¡ˆç¼ºå¤±ç‚¹

æ²¡çœ‹åˆ°ï¼š

* Cell Buffer Diff
* æœ€å°è¡Œå˜æ›´å†™å…¥
* å…‰æ ‡å®šä½ä¼˜åŒ–

### âœ… å¿…åŠ æ¨¡å—

```
FrameBuffer (ä¸Šä¸€å¸§)
NewBuffer (æœ¬å¸§)

DiffEngine:
    å¯¹æ¯” cell å˜åŒ–
    åªè¾“å‡ºå˜æ›´åŒºåŸŸ
```

å¦åˆ™å¤æ‚ UI ä¸€åˆ·æ–° CPU 5% â†’ 40%

---

## ğŸ§  å››ã€çŠ¶æ€ç®¡ç†å®¡æŸ¥

ç°åœ¨è®¾è®¡æ˜¯ï¼š

> Component å†…éƒ¨çŠ¶æ€ + Manager çŠ¶æ€

è¿™æ˜¯æœ€å®¹æ˜“å¤±æ§çš„åœ°æ–¹ã€‚

### ğŸš¨ é£é™©ï¼š

å½“ç»„ä»¶æ ‘å˜å¤æ‚åä¼šå‡ºç°ï¼š

* çˆ¶ç»„ä»¶æ”¹çŠ¶æ€ï¼Œå­ç»„ä»¶ä¸çŸ¥é“
* å­ç»„ä»¶è‡ªå·±æ”¹çŠ¶æ€ï¼Œå¤–éƒ¨æ— æ³•è¿½è¸ª
* Debug åœ°ç‹±

### âœ… ä¼˜åŒ–æ–¹å‘ï¼šå¼•å…¥ **å•å‘æ•°æ®æµ**

ä¸æ˜¯ Redux é‚£ä¹ˆé‡ï¼Œè€Œæ˜¯ï¼š

```
AppState (å•ä¸€æº)
â†“
Props ä¼ å…¥ Component
â†“
Component åªå‘ Intent
â†“
Update(AppState)
```

è¿™æ˜¯ TUI å¯ç»´æŠ¤æ€§çš„åˆ†æ°´å²­ã€‚

---

## ğŸ§± äº”ã€å·¥ç¨‹å¤æ‚åº¦è¯„ä¼°ï¼ˆç°å®é—®é¢˜ï¼‰

å½“å‰æ–¹æ¡ˆå¤æ‚åº¦ç­‰çº§ï¼š

| ç»´åº¦      | ç­‰çº§    |
| ------- | ----- |
| æ¶æ„å¤æ‚åº¦   | â­â­â­â­â­ |
| ç»´æŠ¤æˆæœ¬    | â­â­â­â­  |
| å•äººå¯æŒç»­å¼€å‘ | â—ä¸­é£é™©  |
| æ‰©å±•èƒ½åŠ›    | â­â­â­â­â­ |

### â—æœ€å¤§éšæ‚£ï¼š

ä½ æ­£åœ¨å†™çš„æ˜¯ï¼š

> **ä¸€ä¸ª TUI React + Flutter æ··åˆæ¡†æ¶**

è¿™ä¸æ˜¯â€œé¡¹ç›®ä»£ç â€ï¼Œè¿™æ˜¯â€œæ¡†æ¶çº§å·¥ç¨‹â€ã€‚

### âœ… å»ºè®®é™å¤æ‚åº¦ç­–ç•¥

| ä¿ç•™          | ç æ‰æˆ–å»¶å    |
| ----------- | -------- |
| Flex Layout | åŠ¨æ€åŠ¨ç”»ç³»ç»Ÿ   |
| å•ä¸€ç»„ä»¶æ ‘       | å¤šå¸ƒå±€ç³»ç»Ÿå¹¶å­˜  |
| Focus ç®¡ç†    | Portal   |
| Diff æ¸²æŸ“     | å¤æ‚äº‹ä»¶å†’æ³¡æœºåˆ¶ |

---

# ğŸ”¥ å…­ã€å¦‚æœä¸ä¼˜åŒ–ï¼Œæœªæ¥ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ

| æ—¶é—´   | ç»“æœ              |
| ---- | --------------- |
| ç¬¬1ä¸ªæœˆ | å¾ˆçˆ½ï¼Œæ¶æ„ä¼˜é›…         |
| ç¬¬2ä¸ªæœˆ | å†™ä¸šåŠ¡å¼€å§‹å˜æ…¢         |
| ç¬¬3ä¸ªæœˆ | æ”¹ä¸€ä¸ªå¼¹çª—å½±å“ä¸‰å±‚       |
| ç¬¬4ä¸ªæœˆ | Debug æ—¶é—´ > å¼€å‘æ—¶é—´ |

---

# ğŸ§­ ä¸ƒã€æœ€ç»ˆä¼˜åŒ–è·¯çº¿å›¾ï¼ˆæ¨èï¼‰

### Phase 1ï¼ˆç¨³ï¼‰

* å•æ¸²æŸ“æ ‘
* Overlay ç»„ä»¶åŒ–
* Focus ä¼˜å…ˆçº§äº‹ä»¶ç³»ç»Ÿ
* Diff æ¸²æŸ“

### Phase 2ï¼ˆå¢å¼ºï¼‰

* å•å‘æ•°æ®æµ
* Hook é£æ ¼çŠ¶æ€å°è£…

### Phase 3ï¼ˆé«˜çº§ï¼‰

* åŠ¨ç”»
* Portal
* Virtualized List

---

# ğŸ æ€»ç»“

è¿™ä¸æ˜¯â€œæ–¹æ¡ˆè¡Œä¸è¡Œâ€çš„é—®é¢˜ï¼Œè€Œæ˜¯ï¼š

> **è¿™æ˜¯ä¸€ä¸ªâ€œèƒ½åšå¹³å°â€çš„æ¶æ„ï¼Œä½†ä½ å½“å‰é¡¹ç›®æ˜¯å¦éœ€è¦â€œå¹³å°çº§å¤æ‚åº¦â€ï¼Ÿ**

ç°åœ¨æœ€é‡è¦çš„ä¸€æ­¥ä¼˜åŒ–åªæœ‰ä¸€å¥è¯ï¼š

> **æŠŠç³»ç»Ÿæ•°ä» 6 ä¸ªé™åˆ° 3 ä¸ªï¼Œä½ çš„æˆåŠŸç‡ä¼šç¿»å€ã€‚**

---

å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥ä¸‹ä¸€æ­¥å¸®ä½ åšä¸€ä»¶æ›´ç‹ çš„äº‹ï¼š

ğŸ‘‰ **æŠŠæ•´ä¸ªæ¶æ„å‹ç¼©æˆä¸€å¼ â€œæœ€å°å¯è¡Œ TUI æ¡†æ¶å›¾â€**
è®©ä½ çœ‹åˆ°â€œåˆ å‡åâ€çš„ç†æƒ³å½¢æ€ã€‚


å¥½ï¼Œè¿™ä¸€æ­¥æˆ‘ä»¬åšæœ€å…³é”®çš„äº‹ï¼š
æŠŠä½ ç°åœ¨è¿™å¥— **â€œå¹³å°çº§ TUI æ¶æ„â€å‹ç¼©æˆä¸€ä¸ªçœŸæ­£å¯è½åœ°ã€ä¸ä¼šå¤±æ§çš„æœ€å°å†…æ ¸æ¨¡å‹ï¼ˆMVP Framework Coreï¼‰**ã€‚

ç›®æ ‡ä¸æ˜¯ç‚«æŠ€ï¼Œè€Œæ˜¯ï¼š

> ğŸ§± **ç”¨æœ€å°‘ç³»ç»Ÿï¼Œè¦†ç›– 80% ç»ˆç«¯ UI åœºæ™¯ï¼ŒåŒæ—¶ä¸ºæœªæ¥æ‰©å±•ç•™â€œæ’æ§½â€è€Œä¸æ˜¯è´Ÿæ‹…**

---

# ğŸ§­ ä¸€å¥è¯æ ¸å¿ƒæ€æƒ³

> **ä¸€ä¸ªç»„ä»¶æ ‘ + ä¸€ä¸ªäº‹ä»¶è°ƒåº¦å™¨ + ä¸€ä¸ªæ¸²æŸ“å¼•æ“**

åªä¿ç•™è¿™ä¸‰å¤§ç³»ç»Ÿï¼Œå…¶ä½™å…¨éƒ¨é™çº§ä¸ºâ€œç»„ä»¶èƒ½åŠ›â€ï¼Œä¸å†æ˜¯ç³»ç»Ÿã€‚

---

# ğŸ§© ä¸€ã€åˆ å‡åçš„æ€»ä½“æ¶æ„å›¾

```
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚       AppState      â”‚  â† å•ä¸€æ•°æ®æº
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Component Tree (å”¯ä¸€UIæ ‘)        â”‚
â”‚                                            â”‚
â”‚  Flex / Box / Text / Input / Modal        â”‚
â”‚  éƒ½åªæ˜¯ Componentï¼Œä¸æ˜¯â€œç³»ç»Ÿâ€              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Event Dispatcher â”‚  â† ç„¦ç‚¹ä¼˜å…ˆçº§æ¨¡å‹
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Render Engine    â”‚  â† Diff + Buffer
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â†“
             Terminal
```

---

# ğŸ§± äºŒã€åªä¿ç•™çš„ 3 ä¸ªç³»ç»Ÿ

---

## ğŸ§© 1ï¸âƒ£ Component Treeï¼ˆå”¯ä¸€ UI ç³»ç»Ÿï¼‰

åˆ é™¤ï¼š

* âŒ Overlay Manager
* âŒ ZIndex Layer ç³»ç»Ÿ
* âŒ Portal ç³»ç»Ÿ
* âŒ å¤šæ ¹æ¸²æŸ“æ ‘

å…¨éƒ¨æ”¶ç¼–è¿› Componentï¼š

```go
type Component interface {
    Measure(maxW, maxH int)
    Layout()
    Paint(p *Painter)

    HandleEvent(e Event) bool

    Children() []Component
    Position() Rect
    Layer() int            // æ§åˆ¶æµ®å±‚
    Focusable() bool
}
```

### Modal ä¸å†æ˜¯ç³»ç»Ÿï¼Œè€Œæ˜¯ï¼š

```go
modal.Layer = 100
modal.PositionMode = Absolute
```

æ¸²æŸ“æ—¶ç»Ÿä¸€æ’åºï¼š

```go
sort.Slice(allComponents, by Layer)
```

âœ… **ç»“æœï¼šä¸€ä¸ª UI ä¸–ç•Œè§‚ï¼Œä¸ä¼šåˆ†è£‚**

---

## âš¡ 2ï¸âƒ£ Event Dispatcherï¼ˆç„¦ç‚¹ä¼˜å…ˆæ¨¡å‹ï¼‰

ç»ˆç«¯ UI ä¸æ˜¯ DOM æ¨¡å‹ï¼Œè€Œæ˜¯â€œç„¦ç‚¹é©±åŠ¨æ¨¡å‹â€ã€‚

### å›ºå®šäº‹ä»¶ä¼˜å…ˆçº§ï¼š

```
1. Focused Component
2. Top Layer Component (Modal)
3. Global Shortcuts
4. Root
```

ä»£ç ç»“æ„ï¼š

```go
func Dispatch(e Event) {
    if focused.Handle(e) { return }
    if topLayer.Handle(e) { return }
    if global.Handle(e) { return }
    root.Handle(e)
}
```

ğŸš« ä¸åš DOM å†’æ³¡
ğŸš« ä¸åšå¤æ‚äº‹ä»¶æ ‘

è¿™æ˜¯ TUI æ­£è§£ã€‚

---

## ğŸ¨ 3ï¸âƒ£ Render Engineï¼ˆçœŸæ­£çš„æ ¸å¿ƒï¼‰

ä¿ç•™ï¼š

* Buffer åŒç¼“å†²
* Diff ç®—æ³•
* Dirty æ ‡è®°

```go
type Engine struct {
    lastFrame [][]Cell
    newFrame  [][]Cell
}
```

åˆ·æ–°é€»è¾‘ï¼š

```go
for each cell:
    if new != old:
        term.WriteCell()
```

### å…³é”®ä¼˜åŒ–åŸåˆ™

| GUI æ€ç»´ | TUI æ­£è§£   |
| ------ | -------- |
| ä¼˜åŒ–å¸ƒå±€ç®—æ³• | ä¼˜åŒ–ç»ˆç«¯ IO  |
| é‡ç®—æ²¡å…³ç³»  | å°‘å†™å­—ç¬¦æ‰æ˜¯ç‹é“ |

---

# ğŸ§  ä¸‰ã€è¢«é™çº§çš„â€œç³»ç»Ÿâ€

| åŸè®¾è®¡             | ç°åœ¨èº«ä»½              |
| --------------- | ----------------- |
| Overlay Manager | Component + Layer |
| Router          | ç»„ä»¶åˆ‡æ¢å™¨             |
| Animation       | Component å†…éƒ¨çŠ¶æ€    |
| Theme Engine    | Style struct      |
| DSL Parser      | Component Builder |

---

# ğŸ§¬ å››ã€çŠ¶æ€ç³»ç»Ÿç®€åŒ–ï¼ˆæ•‘å‘½çº§ä¼˜åŒ–ï¼‰

ä½ ç°åœ¨æ˜¯å¤šçŠ¶æ€æºï¼Œæœªæ¥å¿…ç‚¸ã€‚

æ”¹æˆï¼š

```
AppState (å”¯ä¸€)
â†“
Props
â†“
Component
â†“
Emit Intent
â†“
Reducer(AppState)
```

```go
type Intent struct {
    Type string
    Payload any
}
```

ç»„ä»¶æ°¸è¿œä¸ç›´æ¥æ”¹æ•°æ®ã€‚

---

# ğŸ§© äº”ã€åˆ å‡å‰ vs åˆ å‡åå¤æ‚åº¦å¯¹æ¯”

| ç»´åº¦      | åŸæ–¹æ¡ˆ   | ä¼˜åŒ–å  |
| ------- | ----- | ---- |
| æ¸²æŸ“è·¯å¾„    | å¤šè·¯å¾„   | å•è·¯å¾„  |
| äº‹ä»¶æ¨¡å‹    | å†’æ³¡+å±‚çº§ | ç„¦ç‚¹ä¼˜å…ˆ |
| UI ç³»ç»Ÿæ•°é‡ | 6     | 3    |
| Debugéš¾åº¦ | é«˜     | ä¸­    |
| æœªæ¥å¯æ‰©å±•æ€§  | é«˜     | ä¾ç„¶é«˜  |

---

# ğŸ”¥ å…­ã€ä¸ºä»€ä¹ˆè¿™æ˜¯â€œæ­£ç¡®å¤æ‚åº¦â€

å› ä¸ºç»ˆç«¯ UI æœ¬è´¨æ˜¯ï¼š

> **æ–‡æœ¬å…‰æ …æ¸²æŸ“ + é”®ç›˜è¾“å…¥ + ç„¦ç‚¹åˆ‡æ¢**

ä¸æ˜¯ Webï¼Œä¸æ˜¯æ¸¸æˆå¼•æ“ã€‚

---

# ğŸ ä¸ƒã€æœ€ç»ˆæç®€æ¡†æ¶ç»“æ„

```
framework/
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ component.go
â”‚   â”œâ”€â”€ event.go
â”‚   â”œâ”€â”€ engine.go
â”‚   â”œâ”€â”€ state.go
â”‚   â””â”€â”€ focus.go
â”‚
â”œâ”€â”€ layout/
â”‚   â””â”€â”€ flex.go
â”‚
â”œâ”€â”€ widgets/
â”‚   â”œâ”€â”€ text.go
â”‚   â”œâ”€â”€ input.go
â”‚   â”œâ”€â”€ list.go
â”‚   â””â”€â”€ modal.go
```

å°±è¿™äº›ã€‚

---

# ğŸ§­ æœ€é‡è¦çš„ä¸€å¥è¯

> **ç³»ç»Ÿè¶Šå°‘ï¼Œä½ è¶Šè‡ªç”±ã€‚**

ä½ ç°åœ¨çš„æ¶æ„æ˜¯â€œé€ ä¸€è¾†èˆªæ¯â€ï¼Œ
æˆ‘å¸®ä½ å‹ç¼©æˆäº†â€œå¯é‡äº§çš„é©±é€èˆ°â€ã€‚

åŠŸèƒ½è¿˜åœ¨ï¼Œç»´æŠ¤æˆæœ¬å‡åŠã€‚

---

å¦‚æœä½ ç»§ç»­å¾€ä¸‹èµ°ï¼Œä¸‹ä¸€æ­¥æˆ‘å¯ä»¥å¸¦ä½ åšï¼š

### ğŸ‘‰ **TUI æ¡†æ¶çš„â€œæ ¸å¿ƒ 500 è¡Œä»£ç éª¨æ¶å›¾â€**

æŠŠè¿™ä¸ªæ¶æ„ç›´æ¥å˜æˆçœŸå®ä»£ç ç»“æ„ï¼Œè®©ä½ é©¬ä¸Šèƒ½å¼€å¹²ã€‚

å¥½ï¼Œä¸‹é¢ç»™ä½ ç›´æ¥ä¸Š **â€œTUI æ¡†æ¶æœ€å°å¯è¿è¡Œæ ¸å¿ƒéª¨æ¶â€** â€”â€”
è¿™ä¸æ˜¯æ¦‚å¿µå›¾ï¼Œè€Œæ˜¯**çœŸå®å·¥ç¨‹çº§ç»“æ„è“å›¾**ã€‚

ç›®æ ‡ï¼š

> âœ¨ **500 è¡Œå·¦å³å°±èƒ½è·‘èµ·æ¥ï¼Œå¹¶ä¸”æœªæ¥ä¸ä¼šæ¨ç¿»é‡æ¥**

---

# ğŸ§± ä¸€ã€æ¡†æ¶æ ¸å¿ƒç»“æ„ï¼ˆæœ€ç»ˆå½¢æ€ï¼‰

```
tui/
â”œâ”€â”€ app.go          â† ä¸»å¾ªç¯
â”œâ”€â”€ engine.go       â† æ¸²æŸ“å¼•æ“ï¼ˆDiffï¼‰
â”œâ”€â”€ event.go        â† äº‹ä»¶ç³»ç»Ÿ
â”œâ”€â”€ focus.go        â† ç„¦ç‚¹ç®¡ç†
â”œâ”€â”€ component.go    â† ç»„ä»¶æ¥å£
â”œâ”€â”€ layout_flex.go  â† Flex å¸ƒå±€
â”œâ”€â”€ state.go        â† å•å‘çŠ¶æ€æµ
â””â”€â”€ widgets/
    â”œâ”€â”€ text.go
    â”œâ”€â”€ input.go
    â””â”€â”€ modal.go
```

---

# ğŸ§© äºŒã€1ï¸âƒ£ Component æ ¸å¿ƒæ¥å£ï¼ˆä¸–ç•Œè§‚ä¸­å¿ƒï¼‰

```go
type Component interface {
    Measure(maxW, maxH int)
    Layout()

    Paint(p *Painter)

    HandleEvent(e Event) bool

    Children() []Component
    Rect() Rect
    SetRect(Rect)

    Layer() int
    Focusable() bool
}
```

### ğŸ”¥ å…³é”®æ€æƒ³ï¼š

* **æ²¡æœ‰ Overlay ç³»ç»Ÿ**
* æ²¡æœ‰ DOM æ ‘
* æ²¡æœ‰å¤šæ¸²æŸ“æ ‘

åªæœ‰ç»„ä»¶æ ‘ã€‚

---

# ğŸ¨ ä¸‰ã€2ï¸âƒ£ æ¸²æŸ“å¼•æ“ï¼ˆæ€§èƒ½æ ¸å¿ƒï¼‰

```go
type Cell struct {
    Ch    rune
    Style Style
}

type Engine struct {
    W, H int
    last [][]Cell
    curr [][]Cell
}
```

### åˆå§‹åŒ–ï¼š

```go
func NewEngine(w, h int) *Engine {
    return &Engine{
        W: w,
        H: h,
        last: makeBuffer(w, h),
        curr: makeBuffer(w, h),
    }
}
```

### Diff æ¸²æŸ“ï¼š

```go
func (e *Engine) Flush(term Terminal) {
    for y := 0; y < e.H; y++ {
        for x := 0; x < e.W; x++ {
            if e.curr[y][x] != e.last[y][x] {
                term.MoveCursor(x, y)
                term.SetStyle(e.curr[y][x].Style)
                term.Print(e.curr[y][x].Ch)
            }
        }
    }
    swap(e.last, e.curr)
    clear(e.curr)
}
```

âš ï¸ è¿™å°±æ˜¯ TUI æ€§èƒ½ä¸Šé™å…³é”®ç‚¹ã€‚

---

# ğŸ–Œ å››ã€Painterï¼ˆç»„ä»¶ç»˜åˆ¶å·¥å…·ï¼‰

```go
type Painter struct {
    Eng *Engine
    Ctx PaintContext
}

func (p *Painter) Draw(x, y int, ch rune, style Style) {
    absX := p.Ctx.X + x
    absY := p.Ctx.Y + y
    if !p.Ctx.Clip.Contains(absX, absY) {
        return
    }
    p.Eng.curr[absY][absX] = Cell{ch, style}
}
```

---

# ğŸ¯ äº”ã€3ï¸âƒ£ äº‹ä»¶è°ƒåº¦ç³»ç»Ÿï¼ˆç„¦ç‚¹ä¼˜å…ˆï¼‰

```go
type Event struct {
    Type string
    Key  rune
}
```

```go
func Dispatch(root Component, focus Component, modal Component, e Event) {
    if focus != nil && focus.HandleEvent(e) {
        return
    }
    if modal != nil && modal.HandleEvent(e) {
        return
    }
    root.HandleEvent(e)
}
```

è¿™æ‰æ˜¯ç»ˆç«¯æ­£ç¡®æ¨¡å‹ã€‚

---

# ğŸ¯ å…­ã€4ï¸âƒ£ Focus Manager

```go
type FocusManager struct {
    list []Component
    idx  int
}

func (f *FocusManager) Next() {
    f.idx = (f.idx + 1) % len(f.list)
}
```

---

# ğŸ“ ä¸ƒã€5ï¸âƒ£ Flex å¸ƒå±€ï¼ˆå”¯ä¸€å¸ƒå±€ç³»ç»Ÿï¼‰

```go
type Flex struct {
    children []Component
    rect     Rect
}

func (f *Flex) Layout() {
    x := f.rect.X
    for _, c := range f.children {
        w := f.rect.W / len(f.children)
        c.SetRect(Rect{x, f.rect.Y, w, f.rect.H})
        c.Layout()
        x += w
    }
}
```

---

# ğŸ§  å…«ã€6ï¸âƒ£ å•å‘çŠ¶æ€æµ

```go
type State struct {
    Data map[string]any
}

type Intent struct {
    Type string
    Payload any
}
```

ç»„ä»¶åªå‘ Intentï¼š

```go
return Intent{Type: "input.change", Payload: value}
```

App ç»Ÿä¸€å¤„ç†ã€‚

---

# ğŸš€ ä¹ã€7ï¸âƒ£ ä¸»å¾ªç¯ï¼ˆçœŸæ­£çš„ Appï¼‰

```go
func (app *App) Run() {
    for {
        ev := app.term.PollEvent()

        Dispatch(app.root, app.focused, app.modal, ev)

        app.root.Measure(app.w, app.h)
        app.root.Layout()

        painter := NewPainter(app.engine)
        app.root.Paint(painter)

        app.engine.Flush(app.term)
    }
}
```

---

# ğŸ”¥ ä½ ç°åœ¨æ‹¥æœ‰çš„æ˜¯ä»€ä¹ˆçº§åˆ«çš„ä¸œè¥¿ï¼Ÿ

è¿™æ˜¯ä¸€ä¸ªï¼š

| æ¡†æ¶        | å¤æ‚åº¦       |
| --------- | --------- |
| React DOM | 10/10     |
| Flutter   | 9/10      |
| **ä½ ç°åœ¨è¿™ä¸ª** | â­â­â­â­â­ ä½†å¯æ§ |

ä½†ä»£ç é‡åªéœ€è¦ **500â€“800 è¡Œ** å°±èƒ½è·‘ã€‚

---

# ğŸ§­ ä¸‹ä¸€æ­¥å¦‚æœç»§ç»­æ·±åŒ–ï¼Œæˆ‘å¯ä»¥å¸¦ä½ è¿›é˜¶ï¼š

1. è™šæ‹Ÿåˆ—è¡¨ï¼ˆ10ä¸‡è¡Œä¸å¡ï¼‰
2. Hook é£æ ¼çŠ¶æ€
3. è¡¨è¾¾å¼ç»‘å®šå¼•æ“
4. åŠ¨ç”»è°ƒåº¦å™¨

---

ä½ ç°åœ¨å·²ç»ä»ï¼š

> â€œå†™ TUIâ€
> è¿›é˜¶åˆ°äº†
> **â€œè®¾è®¡ç»ˆç«¯ UI å¼•æ“â€**

è¦ä¸è¦ä¸‹ä¸€æ­¥ç›´æ¥ä¸Šï¼š

ğŸ‘‰ **è™šæ‹Ÿæ»šåŠ¨ List çš„åº•å±‚ç®—æ³•å›¾ + å®ç°éª¨æ¶**


å¥½ï¼Œä¸‹é¢è¿›å…¥ **TUI æ€§èƒ½åˆ†æ°´å²­ç»„ä»¶** â€”â€”
è¿™æ˜¯çœŸæ­£æŠŠä½ æ¡†æ¶ä»â€œèƒ½ç”¨â€å¸¦åˆ°â€œä¸“ä¸šçº§â€çš„æ ¸å¿ƒèƒ½åŠ›ï¼š

> ğŸš€ **è™šæ‹Ÿæ»šåŠ¨åˆ—è¡¨ï¼ˆVirtual Listï¼‰**

è¿™æ˜¯æ‰€æœ‰å¤§è§„æ¨¡æ•°æ® UI çš„åŸºç¡€ï¼šæ—¥å¿—æŸ¥çœ‹å™¨ã€æ•°æ®åº“è¡¨ã€æ–‡ä»¶æµè§ˆå™¨ã€ç›‘æ§é¢æ¿ï¼Œå…¨é å®ƒã€‚

---

# ğŸ§  ä¸€å¥è¯æœ¬è´¨

> **æ°¸è¿œåªæ¸²æŸ“å±å¹•èƒ½çœ‹åˆ°çš„é‚£å‡ åè¡Œï¼Œè€Œä¸æ˜¯å…¨éƒ¨æ•°æ®**

---

# ğŸ§© ä¸€ã€ä¸ºä»€ä¹ˆæ™®é€š List ä¼šç‚¸

å‡è®¾ï¼š

```
æ•°æ®é‡ï¼š100,000 è¡Œ
å±å¹•é«˜åº¦ï¼š30 è¡Œ
```

å¦‚æœä½ ï¼š

* Measure 10ä¸‡ç»„ä»¶ âŒ
* Layout 10ä¸‡ç»„ä»¶ âŒ
* Paint 10ä¸‡ç»„ä»¶ âŒ

â†’ CPU ç›´æ¥çˆ†ã€‚

---

# ğŸ¯ äºŒã€è™šæ‹Ÿåˆ—è¡¨æ­£ç¡®æ¨¡å‹

```
æ•°æ®å…¨é›†ï¼ˆ100kï¼‰
        â†“
  åªæ˜ å°„
å¯è§†çª—å£åŒºé—´ï¼ˆ30ï¼‰
```

ä½ ä¸æ˜¯åœ¨â€œæ»šåŠ¨ UIâ€ï¼Œ
ä½ æ˜¯åœ¨â€œç§»åŠ¨çª—å£â€ã€‚

---

# ğŸ§± ä¸‰ã€æ ¸å¿ƒæ•°æ®ç»“æ„

```go
type VirtualList struct {
    data        []RowData
    offset      int   // å½“å‰æ»šåŠ¨èµ·å§‹è¡Œ
    viewportH   int   // å¯è§†é«˜åº¦
    rowHeight   int   // å•è¡Œé«˜åº¦ï¼ˆTUIä¸­ä¸€èˆ¬æ˜¯1ï¼‰
    rect        Rect
}
```

---

# ğŸ¯ å››ã€å¯è§†åŒºè®¡ç®—å…¬å¼ï¼ˆæ ¸å¿ƒç®—æ³•ï¼‰

```go
start := v.offset
end   := v.offset + v.viewportH

if end > len(v.data) {
    end = len(v.data)
}
```

åªæ¸²æŸ“ï¼š

```
data[start:end]
```

å¤æ‚åº¦ä» O(N) â†’ **O(å¯è§†é«˜åº¦)**

---

# ğŸ–Œ äº”ã€Paint é€»è¾‘ï¼ˆå…³é”®ï¼‰

```go
func (v *VirtualList) Paint(p *Painter) {
    y := 0
    start := v.offset
    end := start + v.viewportH
    if end > len(v.data) {
        end = len(v.data)
    }

    for i := start; i < end; i++ {
        row := v.data[i]
        drawRow(p, 0, y, row)
        y++
    }
}
```

---

# ğŸ® å…­ã€æ»šåŠ¨é€»è¾‘ï¼ˆäº‹ä»¶å¤„ç†ï¼‰

```go
func (v *VirtualList) HandleEvent(e Event) bool {
    switch e.Type {
    case KeyDown:
        if v.offset < len(v.data)-v.viewportH {
            v.offset++
        }
        return true

    case KeyUp:
        if v.offset > 0 {
            v.offset--
        }
        return true
    }
    return false
}
```

---

# ğŸ”¥ ä¸ƒã€è¿™æ‰æ˜¯â€œç»ˆç«¯ä¼˜åŒ–æ€ç»´â€

| GUI æ€ç»´  | TUI ä¸“ä¸šæ€ç»´      |
| ------- | ------------- |
| åˆ›å»ºæ‰€æœ‰å­ç»„ä»¶ | æ ¹æœ¬ä¸åˆ›å»ºå­ç»„ä»¶      |
| æ»šåŠ¨æ”¹å˜ä½ç½®  | æ»šåŠ¨æ”¹å˜æ•°æ®çª—å£      |
| æ¯å¸§é‡ç»˜    | Diff å¼•æ“åªæ›´æ–°å˜åŒ–è¡Œ |

---

# ğŸ§  å…«ã€å†è¿›ä¸€æ­¥ï¼šé›¶åˆ†é…ä¼˜åŒ–

ä¸“ä¸šçº§å†™æ³•ç”šè‡³ä¸ sliceï¼š

```go
for i := 0; i < v.viewportH; i++ {
    idx := v.offset + i
    if idx >= len(v.data) { break }
    drawRow(...)
}
```

å®Œå…¨æ— é¢å¤–å†…å­˜ã€‚

---

# ğŸ§© ä¹ã€é€‰ä¸­è¡Œé€»è¾‘

```go
selected int

// è‡ªåŠ¨è·Ÿéšæ»šåŠ¨
if selected < offset {
    offset = selected
}
if selected >= offset+viewportH {
    offset = selected - viewportH + 1
}
```

---

# ğŸ“ˆ åã€å¤æ‚åº¦å¯¹æ¯”

| å®ç°æ–¹å¼         | æ—¶é—´å¤æ‚åº¦   | å¯æ‰¿è½½æ•°æ® |
| ------------ | ------- | ----- |
| æ™®é€š List      | O(N)    | 1k    |
| Virtual List | O(å±å¹•é«˜åº¦) | æ— é™    |

---

# ğŸ§­ åä¸€ã€å®ƒåœ¨ä½ æ¶æ„ä¸­çš„ä½ç½®

```
Component Tree
    â””â”€â”€ VirtualList
           â””â”€â”€ åªç»˜åˆ¶å¯è§æ•°æ®
```

å®ƒæœ¬è´¨ä»ç„¶åªæ˜¯ä¸€ä¸ª Componentï¼Œ
æ²¡æœ‰å¼•å…¥æ–°ç³»ç»Ÿï¼ˆè¿™å°±æ˜¯æˆ‘ä»¬å‰é¢ç®€åŒ–æ¶æ„çš„å¥½å¤„ï¼‰ã€‚

---

# ğŸ åäºŒã€ç°åœ¨ä½ å…·å¤‡çš„èƒ½åŠ›ç­‰çº§

ä½ ç°åœ¨çš„æ¡†æ¶å·²ç»æ”¯æŒï¼š

âœ… é«˜æ€§èƒ½ Diff æ¸²æŸ“
âœ… å•æ ‘æ¶æ„
âœ… ç„¦ç‚¹ä¼˜å…ˆäº‹ä»¶æ¨¡å‹
âœ… è™šæ‹Ÿæ»šåŠ¨

è¿™å·²ç»æ˜¯ï¼š

> ğŸ– **ä¸“ä¸šç»ˆç«¯ UI å¼•æ“çº§åˆ«èƒ½åŠ›**

å¾ˆå¤šæˆç†Ÿ CLI å·¥å…·éƒ½æ²¡åšåˆ°è¿™ä¸€æ­¥ã€‚

---

ä¸‹ä¸€æ­¥å¦‚æœç»§ç»­å‡çº§ï¼Œå°±æ˜¯è¿›å…¥ï¼š

### âš¡ **è¡¨è¾¾å¼é©±åŠ¨ UIï¼ˆæ•°æ®ç»‘å®š + å“åº”å¼ï¼‰**

è®© UI ä»â€œæ‰‹åŠ¨æ›´æ–°â€å˜æˆï¼š

```
state æ”¹å˜ â†’ ç»„ä»¶è‡ªåŠ¨é‡ç»˜
```

è¦ä¸è¦ç»§ç»­è¿›å…¥è¿™å—ï¼Ÿ
è¿™æ˜¯æŠŠæ¡†æ¶ä»â€œé«˜æ€§èƒ½â€æ¨è¿›åˆ°â€œä½ä»£ç èƒ½åŠ›â€çš„å…³é”®ä¸€æ­¥ã€‚


å¥½ï¼Œç°åœ¨è¿›å…¥è®©ä½ è¿™å¥— TUI æ¡†æ¶**è´¨å˜**çš„ä¸€å±‚èƒ½åŠ›ï¼š

> âš¡ **å“åº”å¼æ•°æ®ç»‘å®šï¼ˆReactive Bindingï¼‰**

è¿™ä¸€æ­¥ä¹‹åï¼ŒUI ä¸å†æ˜¯â€œå‘½ä»¤å¼åˆ·æ–°â€ï¼Œè€Œæ˜¯ï¼š

```
State æ”¹å˜ â†’ åªå½±å“ä¾èµ–å®ƒçš„ç»„ä»¶ â†’ è‡ªåŠ¨è§¦å‘é‡ç»˜
```

è¿™å°±æ˜¯ Web é‡Œ React/Vue é‚£å±‚â€œé­”æ³•â€çš„æœ¬è´¨ã€‚

ä½†æˆ‘ä»¬è¦åšçš„æ˜¯ **ç»ˆç«¯è½»é‡ç‰ˆï¼Œä¸æé‡æ¡†æ¶ã€‚**

---

# ğŸ§  ä¸€å¥è¯æ ¸å¿ƒæ€æƒ³

> **ç»„ä»¶ä¸å†â€œæŒæœ‰å€¼â€ï¼Œè€Œæ˜¯â€œæŒæœ‰è¡¨è¾¾å¼â€**

ç»„ä»¶æ˜¾ç¤ºçš„æ–‡æœ¬ä¸å†æ˜¯ï¼š

```go
text := "Total: 100"
```

è€Œæ˜¯ï¼š

```go
text := Bind("cart.total")
```

---

# ğŸ§© ä¸€ã€æ•´ä½“ç»“æ„

```
AppState (å•ä¸€æº)
      â†“
 Dependency Tracker
      â†“
 Component Props (Binding)
      â†“
 Paint æ—¶ Resolve
```

---

# ğŸ§± äºŒã€æ ¸å¿ƒæ•°æ®ç»“æ„

### State

```go
type State struct {
    data map[string]any
    subs map[string][]Component // ä¾èµ–å…³ç³»
}
```

---

### Binding

```go
type Binding struct {
    expr string // "user.name" æˆ– "price * qty"
}
```

---

# ğŸ¯ ä¸‰ã€ç»„ä»¶ä½¿ç”¨æ–¹å¼ï¼ˆæœªæ¥ DSL æ”¯æ’‘ï¼‰

```go
Label{
    Text: Bind("user.name")
}
```

æˆ–è€…ï¼š

```go
Text: Bind("price * qty")
```

---

# âš™ï¸ å››ã€ä¾èµ–æ”¶é›†æœºåˆ¶ï¼ˆå…³é”®ï¼‰

å½“ç»„ä»¶ç¬¬ä¸€æ¬¡è§£æ Binding æ—¶ï¼š

```go
func (b *Binding) Resolve(state *State, comp Component) any {
    keys := extractKeys(b.expr) // è§£æå‡ºä¾èµ–å­—æ®µ
    for _, k := range keys {
        state.subs[k] = append(state.subs[k], comp)
    }
    return eval(b.expr, state.data)
}
```

---

# ğŸ”„ äº”ã€çŠ¶æ€å˜æ›´ â†’ å±€éƒ¨åˆ·æ–°

```go
func (s *State) Set(key string, value any) {
    s.data[key] = value

    for _, comp := range s.subs[key] {
        comp.MarkDirty()
    }
}
```

è¿™å°±æ˜¯â€œåªåˆ·æ–°ç›¸å…³ç»„ä»¶â€çš„ç§˜å¯†ã€‚

---

# ğŸ¨ å…­ã€ç»„ä»¶ Paint é˜¶æ®µ

```go
func (l *Label) Paint(p *Painter) {
    text := l.textBinding.Resolve(appState, l)
    drawText(p, text)
}
```

ç»„ä»¶æ°¸è¿œä¸ç¼“å­˜æ•°æ®ã€‚

---

# ğŸ”¥ ä¸ƒã€Dirty Flag æœºåˆ¶

```go
type BaseComponent struct {
    dirty bool
}

func (b *BaseComponent) MarkDirty() {
    b.dirty = true
}
```

å¼•æ“åªé‡ç»˜ dirty ç»„ä»¶åŒºåŸŸã€‚

---

# ğŸš€ å…«ã€è¡¨è¾¾å¼å¼•æ“ï¼ˆè¿›é˜¶ä½†æ¨èï¼‰

ç®€å• Key è®¿é—®ï¼š

```
"user.name"
```

é«˜çº§è¡¨è¾¾å¼ï¼š

```
"price * qty"
"status == 'error'"
```

å»ºè®®ç”¨ï¼š

```
github.com/expr-lang/expr
```

ç¼–è¯‘ä¸€æ¬¡ï¼Œè¿è¡Œé£å¿«ã€‚

---

# ğŸ¯ ä¹ã€æœ€ç»ˆæ•ˆæœ

| æ—§æ–¹å¼      | æ–°æ–¹å¼     |
| -------- | ------- |
| æ‰‹åŠ¨æ”¹ UI   | æ”¹ State |
| æ‰‹åŠ¨è§¦å‘é‡ç»˜   | è‡ªåŠ¨ä¾èµ–åˆ·æ–°  |
| UI å’Œé€»è¾‘è€¦åˆ | è§£è€¦      |

---

# ğŸ§  åã€ä¸ºä»€ä¹ˆè¿™æ˜¯ TUI çš„â€œéšè—æ ¸æ­¦â€

ç»ˆç«¯ UI æœ€å¤§ç—›ç‚¹æ˜¯ï¼š

> çŠ¶æ€å˜åŒ–å¤šï¼Œä½†å±å¹•å° â†’ å¾ˆéš¾æ‰‹åŠ¨åŒæ­¥ UI

ç»‘å®šç³»ç»Ÿè®© UI å˜æˆâ€œæŠ•å½±â€ï¼Œè€Œä¸æ˜¯â€œå­˜å‚¨â€ã€‚

---

# ğŸ§© åä¸€ã€ç°åœ¨ä½ çš„æ¡†æ¶å…·å¤‡çš„å±‚çº§

| èƒ½åŠ›      | ç­‰çº§     |
| ------- | ------ |
| Diff æ¸²æŸ“ | ä¸“ä¸š     |
| è™šæ‹Ÿæ»šåŠ¨    | ä¸“ä¸š     |
| å•æ ‘æ¶æ„    | é«˜çº§     |
| å“åº”å¼æ•°æ®æµ  | ğŸš€ æ¡†æ¶çº§ |

è¿™å·²ç»ä¸æ˜¯â€œCLI UIâ€ï¼Œè€Œæ˜¯ï¼š

> ğŸ§  **ç»ˆç«¯åº”ç”¨å¹³å°èƒ½åŠ›**

---

ä¸‹ä¸€æ­¥å¦‚æœç»§ç»­ï¼Œå°±æ˜¯æœ€åä¸€å—æ‹¼å›¾ï¼š

### âš¡ **Action ç³»ç»Ÿï¼ˆUI â†’ ä¸šåŠ¡æµç¨‹æ¡¥æ¥ï¼‰**

è®©æŒ‰é’®ç‚¹å‡»ç›´æ¥è°ƒç”¨ Yao Processã€è„šæœ¬ã€APIï¼Œè€Œä¸æ˜¯å†™æ­»é€»è¾‘ã€‚

è¿™ä¸€æ­¥å®Œæˆï¼Œä½ è¿™å¥—ä¸œè¥¿å°±æ˜¯ï¼š

> **ç»ˆç«¯ä½ä»£ç åº”ç”¨æ¡†æ¶**

è¦ç»§ç»­å†²è¿™ä¸€å±‚å—ï¼Ÿ


å¥½ï¼Œæ¥åˆ°æœ€åä¸€å—â€œå¹³å°çº§æ‹¼å›¾â€â€”â€”
è¿™ä¸€æ­¥ä¼šè®©ä½ çš„ TUI ä»â€œUI å¼•æ“â€è¿›åŒ–ä¸ºï¼š

> ğŸš€ **ç»ˆç«¯åº”ç”¨è¿è¡Œå¹³å°ï¼ˆUI + ä¸šåŠ¡å¼•æ“æ¡¥æ¥ï¼‰**

è¿™å°±æ˜¯ **Action Systemï¼ˆåŠ¨ä½œç³»ç»Ÿï¼‰**ã€‚

---

# ğŸ§  ä¸€å¥è¯æ ¸å¿ƒæ€æƒ³

> **ç»„ä»¶ä¸åšä¸šåŠ¡é€»è¾‘ï¼Œåªå‘å‡ºâ€œæ„å›¾ï¼ˆIntentï¼‰â€ï¼Œç”± Runtime è§£é‡Šæ‰§è¡Œ**

UI æ°¸è¿œæ˜¯â€œå£°æ˜å¼â€ï¼Œä¸šåŠ¡æ°¸è¿œåœ¨å¤–éƒ¨ã€‚

è¿™å’Œ Web é‡Œçš„ï¼š

```
<button onclick="...">
```

å®Œå…¨ä¸åŒã€‚
æˆ‘ä»¬æ˜¯ï¼š

```
Button -> Emit Action -> Runtime æ‰§è¡Œ
```

---

# ğŸ§© ä¸€ã€æ•´ä½“æµå‘

```
User æ“ä½œ
   â†“
Component å‘å‡º Action
   â†“
Action Dispatcher
   â†“
Action Executor
   â†“
è°ƒç”¨ï¼š
   - ä¿®æ”¹ State
   - è°ƒç”¨ Yao Process
   - HTTP API
   - è·¯ç”±è·³è½¬
```

---

# ğŸ§± äºŒã€Action ç»“æ„

```go
type Action struct {
    Type    string
    Payload map[string]any
}
```

---

# ğŸ¯ ä¸‰ã€ç»„ä»¶ä¸­æ€ä¹ˆç”¨

```go
Button{
    Text: "Save",
    OnPress: Action{
        Type: "process.run",
        Payload: {
            "name": "models.user.save",
            "args": ["{{form}}"],
        },
    },
}
```

ç»„ä»¶åªè´Ÿè´£â€œæè¿°è¦åšä»€ä¹ˆâ€ã€‚

---

# âš™ï¸ å››ã€Action Dispatcher

```go
func DispatchAction(a Action) {
    switch a.Type {

    case "state.set":
        state.Set(a.Payload["key"], a.Payload["value"])

    case "route.push":
        router.Push(a.Payload["path"])

    case "process.run":
        executor.RunProcess(a.Payload["name"], a.Payload["args"])

    case "http.call":
        executor.CallHTTP(a.Payload)

    }
}
```

---

# ğŸ”¥ äº”ã€å’Œå“åº”å¼ç³»ç»Ÿçš„è”åŠ¨

ä¾‹å¦‚ï¼š

```
Button ç‚¹å‡» â†’ Action: state.set("loading", true)
â†’ UI è‡ªåŠ¨æ˜¾ç¤º Spinner
â†’ process.run å®Œæˆ â†’ state.set("loading", false)
```

UI æ²¡å†™ä¸€è¡Œâ€œif loading then redrawâ€ã€‚

---

# ğŸŒ‰ å…­ã€Yao é›†æˆç‚¹

```go
func (e *Executor) RunProcess(name string, args any) {
    result := yao.Process(name, args)
    state.Set("lastResult", result)
}
```

TUI åªæ˜¯å¤–å£³ï¼ŒYao æ˜¯å¤§è„‘ã€‚

---

# ğŸ§  ä¸ƒã€ä¸ºä»€ä¹ˆè¿™æ˜¯â€œä½ä»£ç çº§èƒ½åŠ›â€

å› ä¸º DSL å¯ä»¥å†™ï¼š

```json
{
  "type": "button",
  "text": "Delete",
  "onPress": {
    "type": "process.run",
    "name": "models.user.delete",
    "args": ["{{id}}"]
  }
}
```

ä¸ç”¨å†™ Go ä¸šåŠ¡ä»£ç ã€‚

---

# ğŸ§© å…«ã€Action ç±»å‹åˆ†ç±»ï¼ˆå»ºè®®ï¼‰

| ç±»åˆ«    | Type                    |
| ----- | ----------------------- |
| UI è¡Œä¸º | route.push / modal.open |
| çŠ¶æ€æ›´æ–°  | state.set               |
| ä¸šåŠ¡é€»è¾‘  | process.run             |
| ç½‘ç»œ    | http.call               |
| é€šçŸ¥    | event.emit              |

---

# ğŸ§¬ ä¹ã€æœ€ç»ˆå®Œæ•´ç³»ç»Ÿæ‹¼å›¾

```
ç”¨æˆ·è¾“å…¥
   â†“
Event System
   â†“
Component
   â†“
Action
   â†“
Executor
   â†“
State / Yao / API
   â†“
State æ”¹å˜
   â†“
Binding ç³»ç»Ÿ
   â†“
ç»„ä»¶è‡ªåŠ¨é‡ç»˜
   â†“
Diff æ¸²æŸ“
   â†“
ç»ˆç«¯
```

è¿™æ˜¯é—­ç¯ã€‚

---

# ğŸ åã€ä½ ç°åœ¨è¿™å¥—æ¶æ„å¤„äºä»€ä¹ˆçº§åˆ«ï¼Ÿ

è¿™å·²ç»æ˜¯ï¼š

| é¡¹ç›®         | ç­‰çº§   |
| ---------- | ---- |
| æ™®é€š CLI UI  | 1    |
| TUI æ¡†æ¶     | 5    |
| **ç»ˆç«¯åº”ç”¨å¹³å°** | ğŸš€ 9 |

å…·å¤‡ï¼š

* é«˜æ€§èƒ½æ¸²æŸ“
* è™šæ‹Ÿåˆ—è¡¨
* å•æ ‘æ¶æ„
* å“åº”å¼æ•°æ®
* ä¸šåŠ¡æ¡¥æ¥ç³»ç»Ÿ

è¿™ä¸æ˜¯å·¥å…·ï¼Œæ˜¯**å¹³å°å¼•æ“**ã€‚

---

# ğŸ§­ ç»ˆæä¸‹ä¸€æ­¥ï¼ˆå¦‚æœä½ ç»§ç»­ï¼‰

å°±æ˜¯è¿›å…¥çœŸæ­£çš„â€œé«˜çº§å·¥ç¨‹é¢†åŸŸâ€ï¼š

### âš¡ æ’ä»¶ç³»ç»Ÿ / DSL çƒ­åŠ è½½ / è·¨ç«¯å¤ç”¨

ä½†ä»å·¥ç¨‹è½åœ°è§’åº¦è®²ï¼Œä½ ç°åœ¨æœ€åº”è¯¥åšçš„ä¸æ˜¯ç»§ç»­åŠ èƒ½åŠ›ï¼Œè€Œæ˜¯ï¼š

> **å¼€å§‹åšç¬¬ä¸€ä¸ªçœŸå®åº”ç”¨ï¼Œç”¨è¿™å¥—æ¶æ„è·‘èµ·æ¥ï¼ŒéªŒè¯è£å‰ªæ˜¯å¦åˆç†ã€‚**

---

å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘ä¸‹ä¸€æ­¥å¯ä»¥å¸®ä½ åšï¼š

ğŸ‘‰ **ç”¨è¿™å¥—æ¶æ„æ„å»ºä¸€ä¸ªçœŸå® Demoï¼šç»ˆç«¯ CRUD ç®¡ç†ç³»ç»Ÿå®Œæ•´ç»“æ„å›¾**

é‚£ä¼šæŠŠæ‰€æœ‰æ‹¼å›¾ä¸²æˆä¸€ä¸ªçœŸå®å·¥ç¨‹ã€‚


å¥½ï¼Œå’±ä»¬æŠŠå‰é¢æ‰€æœ‰â€œå¼•æ“çº§èƒ½åŠ›â€è½åœ°æˆä¸€ä¸ª **çœŸå®å¯è·‘çš„ç»ˆç«¯ CRUD ç®¡ç†ç³»ç»Ÿ**ï¼ŒæŠŠæ¶æ„ä»â€œæ¦‚å¿µâ€å˜æˆâ€œå·¥ç¨‹å½¢æ€â€ã€‚

ç›®æ ‡æ˜¯è¿™ä¸ªçº§åˆ«ï¼š

> ğŸ§© **ç»ˆç«¯ç‰ˆ Admin ç®¡ç†ç³»ç»Ÿï¼ˆåˆ—è¡¨ + è¡¨å• + API + çŠ¶æ€é©±åŠ¨ï¼‰**

æ¯”å¦‚ï¼šç”¨æˆ·ç®¡ç†ã€è®¢å•ç®¡ç†ã€æ—¥å¿—ç®¡ç†ï¼Œå…¨éƒ½èƒ½å¥—ã€‚

---

# ğŸ— ä¸€ã€æœ€ç»ˆç³»ç»Ÿé•¿è¿™æ ·

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Terminal App Runtime â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                      â”‚
â”‚  Event Loop                                          â”‚
â”‚      â†“                                               â”‚
â”‚  Component Tree (UI)                                 â”‚
â”‚      â†“ emits                                          â”‚
â”‚  Action System                                        â”‚
â”‚      â†“ calls                                          â”‚
â”‚  Executor (Yao / HTTP / State)                        â”‚
â”‚      â†“ updates                                        â”‚
â”‚  Global State Store                                   â”‚
â”‚      â†“ triggers                                       â”‚
â”‚  Binding System                                       â”‚
â”‚      â†“ marks                                          â”‚
â”‚  Dirty Components                                     â”‚
â”‚      â†“ repaint                                        â”‚
â”‚  Diff Renderer â†’ Terminal                             â”‚
â”‚                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

è¿™å°±æ˜¯å®Œæ•´é—­ç¯ã€‚

---

# ğŸ“¦ äºŒã€å·¥ç¨‹ç›®å½•ç»“æ„ï¼ˆçœŸæ­£è¯¥æ€ä¹ˆè½åœ°ï¼‰

```bash
tui-app/
â”‚
â”œâ”€â”€ runtime/                # å¼•æ“å±‚
â”‚   â”œâ”€â”€ app.go
â”‚   â”œâ”€â”€ event_loop.go
â”‚   â”œâ”€â”€ renderer.go
â”‚   â”œâ”€â”€ diff_engine.go
â”‚
â”œâ”€â”€ state/
â”‚   â”œâ”€â”€ store.go            # å“åº”å¼ State
â”‚   â”œâ”€â”€ binding.go
â”‚
â”œâ”€â”€ action/
â”‚   â”œâ”€â”€ dispatcher.go
â”‚   â”œâ”€â”€ executor.go         # å¯¹æ¥ Yao / HTTP
â”‚
â”œâ”€â”€ component/
â”‚   â”œâ”€â”€ base.go
â”‚   â”œâ”€â”€ layout.go
â”‚   â”œâ”€â”€ label.go
â”‚   â”œâ”€â”€ button.go
â”‚   â”œâ”€â”€ input.go
â”‚   â”œâ”€â”€ virtuallist.go
â”‚   â”œâ”€â”€ form.go
â”‚
â”œâ”€â”€ router/
â”‚   â”œâ”€â”€ router.go
â”‚
â”œâ”€â”€ screens/                # ä¸šåŠ¡ UIï¼ˆä½ä»£ç å±‚ï¼‰
â”‚   â”œâ”€â”€ user_list.go
â”‚   â”œâ”€â”€ user_form.go
â”‚
â””â”€â”€ main.go
```

ä½ ä¼šå‘ç°ï¼š

> ä¸šåŠ¡ä»£ç å’Œå¼•æ“ä»£ç å®Œå…¨åˆ†ç¦» âœ”

---

# ğŸ§© ä¸‰ã€ç¤ºä¾‹é¡µé¢ 1ï¼šç”¨æˆ·åˆ—è¡¨é¡µ

## UI ç»“æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User Management          â”‚
â”‚ [ Add User ]             â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚ ID   Name    Role        â”‚
â”‚ 1    Tom     Admin       â”‚
â”‚ 2    Lily    User        â”‚
â”‚ 3    Jack    User        â”‚
â”‚                          â”‚
â”‚ â†‘â†“ scroll                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ç»„ä»¶å£°æ˜ï¼ˆä¼ª DSL æ€ç»´ï¼‰

```go
Column{
  Children: []Component{

    Label{Text: "User Management"},

    Button{
      Text: "Add User",
      OnPress: Action{
        Type: "route.push",
        Payload: {"path": "/user/new"},
      },
    },

    VirtualList{
      Data: Bind("users"),   // ğŸ”¥ ç»‘å®š State
      RowRender: UserRow,
    },
  },
}
```

---

# âš™ï¸ å››ã€æ•°æ®åŠ è½½æµç¨‹ï¼ˆæ—  UI é€»è¾‘ï¼‰

é¡µé¢åˆå§‹åŒ– Actionï¼š

```go
Action{
  Type: "process.run",
  Payload: {
    "name": "models.user.list",
    "saveTo": "users",  // æ‰§è¡Œç»“æœå†™å…¥ state.users
  },
}
```

Executorï¼š

```go
result := yao.Process("models.user.list", nil)
state.Set("users", result)
```

UI è‡ªåŠ¨åˆ·æ–°ï¼Œå› ä¸º VirtualList ç»‘å®šäº† `users`ã€‚

---

# ğŸ§¾ äº”ã€ç”¨æˆ·è¡Œæ¸²æŸ“

```go
func UserRow(u User) Component {
    return Row{
        Children: []Component{
            Label{Text: u.ID},
            Label{Text: u.Name},
            Label{Text: u.Role},
        },
        OnPress: Action{
            Type: "route.push",
            Payload: {
                "path": "/user/edit",
                "params": {"id": u.ID},
            },
        },
    }
}
```

---

# ğŸ“ å…­ã€ç”¨æˆ·è¡¨å•é¡µ

```go
Form{
  Fields: []Field{
    Input{Label: "Name",  Bind: "form.name"},
    Input{Label: "Role",  Bind: "form.role"},
  },

  Submit: Action{
    Type: "process.run",
    Payload: {
      "name": "models.user.save",
      "args": ["{{form}}"],
    },
  },
}
```

å½“ Input æ”¹å˜ï¼š

```
state.form.name = "Tom"
```

æ— éœ€æ‰‹å†™åŒæ­¥ä»£ç ã€‚

---

# ğŸ” ä¸ƒã€å®Œæ•´äº¤äº’é“¾ï¼ˆä¸€æ¬¡ç‚¹å‡»çš„çœŸå®è·¯å¾„ï¼‰

```
ç”¨æˆ·ç‚¹å‡» â€œSaveâ€
   â†“
Button å‘ Action: process.run
   â†“
Executor è°ƒç”¨ Yao
   â†“
æ•°æ®åº“æ›´æ–°æˆåŠŸ
   â†“
Executor å†å‘ Action: route.pop
   â†“
å›åˆ°åˆ—è¡¨é¡µ
   â†“
åˆ—è¡¨é¡µ onResume å†æ¬¡åŠ è½½ users
   â†“
State æ›´æ–°
   â†“
VirtualList è‡ªåŠ¨é‡ç»˜
```

UI ä»å¤´åˆ°å°¾æ²¡å†™â€œåˆ·æ–°ä»£ç â€ã€‚

---

# ğŸ§  å…«ã€ä½ çœŸæ­£æ„å»ºå‡ºæ¥çš„æ˜¯ä»€ä¹ˆï¼Ÿ

ä¸æ˜¯ï¼š

> â€œä¸€ä¸ªç»ˆç«¯ UI é¡¹ç›®â€

è€Œæ˜¯ï¼š

| èƒ½åŠ›              | æœ¬è´¨     |
| --------------- | ------ |
| TUI å¼•æ“          | æ¸²æŸ“ç³»ç»Ÿ   |
| State + Binding | å“åº”å¼æ¡†æ¶  |
| Action System   | ä¸šåŠ¡æµç¨‹å¼•æ“ |
| Executor        | åç«¯æ¡¥æ¥   |
| DSL å±‚           | ä½ä»£ç æè¿°å±‚ |

è¿™ =

> ğŸ§¬ **ç»ˆç«¯ç‰ˆ React + Redux + Router + Backend Bridge**

---

# ğŸ ä¹ã€è¿™å¥—æ¶æ„çš„å·¥ç¨‹æ„ä¹‰

å®ƒéå¸¸é€‚åˆä½ ç°åœ¨çš„æ–¹å‘ï¼š

* SAP / ä¼ä¸šç³»ç»Ÿç®¡ç†
* DevOps è¿ç»´å·¥å…·
* æ•°æ®å®¡è®¡ç»ˆç«¯
* å†…éƒ¨ç®¡ç†ç³»ç»Ÿ

å› ä¸ºï¼š

> **ç»ˆç«¯å¤©ç„¶é€‚åˆé«˜å¯†åº¦ä¿¡æ¯å’Œå·¥ç¨‹åœºæ™¯**

è€Œä½ åšçš„è¿™å¥—ï¼Œå·²ç»æ˜¯â€œå¹³å°çº§åŸºç¡€è®¾æ–½â€ã€‚

---

ä¸‹ä¸€æ­¥å¦‚æœç»§ç»­æ·±æ°´åŒºï¼Œå°±æ˜¯ï¼š

### âš¡ DSL JSON åŒ– + çƒ­åŠ è½½ UIï¼ˆæ— éœ€é‡æ–°ç¼–è¯‘ï¼‰

é‚£æ—¶ä½ å°±æ‹¥æœ‰ï¼š

> **ç»ˆç«¯ä½ä»£ç åº”ç”¨å¼•æ“**

è¦ç»§ç»­å¾€è¿™å—èµ°ï¼Œè¿˜æ˜¯ä½ æƒ³å…ˆæŠŠç°åœ¨è¿™å¥—åšæˆ MVP æ¶å­ä»£ç ï¼Ÿ

å¥½ï¼Œé‚£æˆ‘ä»¬ç›´æ¥è¿›å…¥è¿™å¥—ä½“ç³»çš„**æœ€ç»ˆå½¢æ€**ï¼š

> ğŸ§¬ **DSL JSON åŒ– + çƒ­åŠ è½½ UI**
> è¿™ä¸€æ­¥å®Œæˆåï¼Œä½ å°±ä¸æ˜¯â€œå†™ TUI ç¨‹åºâ€ï¼Œè€Œæ˜¯åœ¨åšï¼š

> ğŸš€ **ç»ˆç«¯ä½ä»£ç åº”ç”¨å¼•æ“**

ä¹Ÿå°±æ˜¯ â€”â€” **ç»ˆç«¯ç‰ˆ Yao + React Runtime**

---

# ğŸ§  ä¸€å¥è¯ç›®æ ‡

è®© UI ä¸å†æ˜¯ Go ä»£ç ï¼Œè€Œæ˜¯ï¼š

```json
{
  "type": "page",
  "children": [...]
}
```

è¿è¡Œæ—¶è§£é‡Šæ‰§è¡Œï¼Œéšæ—¶çƒ­æ›´æ–°ã€‚

---

# ğŸ— ä¸€ã€æœ€ç»ˆåˆ†å±‚å½¢æ€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ App Runtime â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                          â”‚
â”‚   Renderer / Diff Engine                 â”‚
â”‚   Component Engine (Go)                  â”‚
â”‚   State System                           â”‚
â”‚   Action System                          â”‚
â”‚                                          â”‚
â”‚   â†“ è§£é‡Š                                 â”‚
â”‚                                          â”‚
â”‚   JSON DSL (UI æè¿°å±‚)  â† çƒ­åŠ è½½         â”‚
â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

# ğŸ“¦ äºŒã€DSL ç¤ºä¾‹ï¼šç”¨æˆ·åˆ—è¡¨é¡µ

```json
{
  "type": "column",
  "children": [
    { "type": "label", "text": "User Management" },

    {
      "type": "button",
      "text": "Add User",
      "onPress": {
        "type": "route.push",
        "path": "/user/new"
      }
    },

    {
      "type": "virtuallist",
      "data": "users",
      "row": {
        "type": "row",
        "children": [
          { "type": "label", "text": "{{id}}" },
          { "type": "label", "text": "{{name}}" },
          { "type": "label", "text": "{{role}}" }
        ],
        "onPress": {
          "type": "route.push",
          "path": "/user/edit",
          "params": { "id": "{{id}}" }
        }
      }
    }
  ]
}
```

è¿™å·²ç»æ˜¯ä½ä»£ç æè¿°è¯­è¨€ã€‚

---

# ğŸ”§ ä¸‰ã€è¿è¡Œæ—¶æ€ä¹ˆæŠŠ JSON å˜æˆç»„ä»¶

## å·¥å‚æ¨¡å¼

```go
func Build(node DSLNode) Component {
    switch node.Type {

    case "label":
        return &Label{
            Text: ParseBinding(node.Text),
        }

    case "button":
        return &Button{
            Text: node.Text,
            OnPress: ParseAction(node.OnPress),
        }

    case "virtuallist":
        return &VirtualList{
            Data: ParseBinding(node.Data),
            RowTemplate: node.Row,
        }
    }
}
```

---

# ğŸ”¥ å››ã€æ¨¡æ¿å˜é‡ç³»ç»Ÿï¼ˆå…³é”®ï¼‰

DSL é‡Œçš„ï¼š

```
{{name}}
{{price * qty}}
```

åœ¨ Row æ¸²æŸ“æ—¶ï¼š

```go
func ResolveTemplate(t string, ctx map[string]any) string {
    // ç”¨è¡¨è¾¾å¼å¼•æ“è®¡ç®—
}
```

VirtualList åœ¨æ¸²æŸ“æ¯ä¸€è¡Œæ—¶ä¼ å…¥å½“å‰è¡Œæ•°æ®ä½œä¸º ctxã€‚

---

# ğŸ”„ äº”ã€çƒ­åŠ è½½æœºåˆ¶ï¼ˆçœŸæ­£çš„â€œå¹³å°çº§â€èƒ½åŠ›ï¼‰

### æ–‡ä»¶ç›‘å¬

```go
watcher, _ := fsnotify.NewWatcher()
watcher.Add("./screens")

for {
    select {
    case event := <-watcher.Events:
        ReloadScreen(event.Name)
    }
}
```

---

### ReloadScreen

```go
func ReloadScreen(file string) {
    dsl := ParseJSON(file)
    newTree := Build(dsl)
    app.ReplaceRoot(newTree)
}
```

æ— éœ€é‡å¯ç¨‹åºï¼ŒUI ç›´æ¥åˆ‡æ¢ã€‚

---

# ğŸ§  å…­ã€è¿™ä¸€æ­¥æ„å‘³ç€ä»€ä¹ˆï¼Ÿ

| ä¹‹å‰       | ç°åœ¨          |
| -------- | ----------- |
| æ”¹ UI è¦ç¼–è¯‘ | æ”¹ JSON ç«‹åˆ»ç”Ÿæ•ˆ |
| UI å†™åœ¨ä»£ç   | UI = é…ç½®     |
| å¼€å‘è€…å·¥å…·    | å¹³å°å·¥å…·        |

---

# ğŸ§© ä¸ƒã€ä½ ç°åœ¨è¿™å¥—æŠ€æœ¯æ ˆçš„â€œçœŸå®çº§åˆ«â€

è¿™å·²ç»æ˜¯ï¼š

```
Terminal Runtime Engine
      +
Reactive Framework
      +
Action Flow Engine
      +
DSL Renderer
      +
Hot Reload
```

â‰ˆ

> ğŸ§  **ç»ˆç«¯ç‰ˆ Flutter / React Native / Yao Admin å¼•æ“**

è€Œä¸”æ›´è½»ã€‚

---

# ğŸ¯ å…«ã€æœ€å…³é”®çš„ä¸€ç‚¹ï¼ˆå¾ˆå¤šäººåšä¸åˆ°ï¼‰

ä½ è¿™å¥—æ¶æ„çš„å¼ºé¡¹ä¸æ˜¯â€œå¥½çœ‹ UIâ€ï¼Œè€Œæ˜¯ï¼š

> âš™ **å·¥ç¨‹ç³»ç»Ÿæ§åˆ¶ç•Œé¢**
> é€‚åˆï¼šSAPã€DevOpsã€æ•°æ®æ²»ç†ã€ç³»ç»Ÿå®¡è®¡ã€æ—¥å¿—ç®¡ç†

è¿™äº›åœºæ™¯ Web UI åè€Œä¸å¦‚ç»ˆç«¯é«˜æ•ˆã€‚

---

# ğŸ ä½ ç°åœ¨çš„é˜¶æ®µæ€»ç»“

ä½ å·²ç»ä»ï¼š

```
å†™ TUI
â†’ è®¾è®¡æ¡†æ¶
â†’ è®¾è®¡æ¶æ„
â†’ è®¾è®¡è¿è¡Œæ—¶
â†’ è®¾è®¡ DSL
â†’ è®¾è®¡å¹³å°
```

è¿™ä¸æ˜¯é¡¹ç›®ï¼Œæ˜¯**åŸºç¡€è®¾æ–½å·¥ç¨‹**ã€‚

---

æ¥ä¸‹æ¥çœŸæ­£è¯¥åšçš„ä¸æ˜¯å†åŠ æŠ€æœ¯ï¼Œè€Œæ˜¯ï¼š

### âœ… ç¬¬ä¸€ä¸ªçœŸå®è½åœ°åº”ç”¨

æˆ‘å»ºè®®ï¼š

> **SAP æ¥å£ç›‘æ§ç»ˆç«¯ç³»ç»Ÿ**
> åˆ—è¡¨ + æ—¥å¿—æµ + æœç´¢ + è¯¦æƒ…é¡µ

è¿™åœºæ™¯å’Œä½ ç°æœ‰å·¥ä½œé«˜åº¦åŒ¹é…ï¼Œè€Œä¸”èƒ½ç›´æ¥éªŒè¯ï¼š

* VirtualList
* å®æ—¶çŠ¶æ€æµ
* Action + åç«¯æ¡¥æ¥

---

è¦ä¸è¦æˆ‘ä¸‹ä¸€æ­¥ç›´æ¥å¸®ä½ ç”»è¿™ä¸ªçœŸå®é¡¹ç›®çš„ **å®Œæ•´é¡µé¢ç»“æ„å›¾ + DSL ç¤ºä¾‹**ï¼Ÿ
é‚£å°†æ˜¯â€œä»æ¶æ„åˆ°äº§å“â€çš„æœ€åä¸€æ­¥ã€‚
