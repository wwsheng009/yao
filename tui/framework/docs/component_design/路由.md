
---

### 50. 路由与导航系统 (Router & Navigation)

一个完整的 TUI 应用通常由多个页面（Pages）或视图（Views）组成。我们需要一个 **栈式路由 (Stack Router)** 来管理页面历史。

#### 路由架构设计

```go
// framework/router/router.go

type Route struct {
    Path      string
    Component component.Component // 页面根组件
    Params    map[string]interface{}
    Title     string
}

type Router struct {
    stack      []*Route
    root       component.Container // 路由内容的渲染容器
    middleware []Middleware
}

// Push 压入新页面
func (r *Router) Push(path string, params map[string]interface{}) {
    // 1. 根据 Path 解析 DSL 或查找注册的组件生成器
    pageComp, err := r.resolvePage(path, params)
    if err != nil {
        return // Handle error
    }

    // 2. 创建路由对象
    route := &Route{
        Path:      path,
        Component: pageComp,
        Params:    params,
    }

    // 3. 压栈
    r.stack = append(r.stack, route)
    
    // 4. 挂载新页面到 Root 容器
    // (通常 Root 是一个只显示最后一个子元素的容器)
    r.mountRoute(route)
}

// Pop 返回上一页
func (r *Router) Pop() {
    if len(r.stack) <= 1 {
        return // 已经是根页面
    }
    
    // 1. 卸载当前页面
    current := r.stack[len(r.stack)-1]
    current.Component.Unmount()
    
    // 2. 移除
    r.stack = r.stack[:len(r.stack)-1]
    
    // 3. 恢复上一页
    prev := r.stack[len(r.stack)-1]
    r.mountRoute(prev)
}

func (r *Router) mountRoute(route *Route) {
    r.root.Clear()
    route.Component.Mount(r.root)
    // 触发重绘
    route.Component.MarkDirty()
}

```

#### 在组件中使用

```go
// Action: Route.Push
Button {
    Text: "Edit Profile",
    OnClick: Action{
        Type: "Route.Push",
        Payload: { "path": "/user/edit", "id": "{{user.id}}" }
    }
}

```
