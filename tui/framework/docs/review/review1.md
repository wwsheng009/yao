ä¸‹é¢æ˜¯**åŸºäºä½ æä¾›çš„ ARCHITECTURE / BOUNDARIES / COMPONENTS è®¾è®¡æ–‡æ¡£**æ‰€åšçš„ä¸€æ¬¡**æ­£å¼æ–¹æ¡ˆå®¡æŸ¥ï¼ˆArchitecture Reviewï¼‰**ï¼Œæˆ‘ä¼šç«™åœ¨ã€Œ**å¯é•¿æœŸæ¼”è¿›çš„ TUI æ¡†æ¶ / å·¥ç¨‹åŒ–è½åœ°**ã€è§†è§’æ¥ç»™æ„è§ï¼Œè€Œä¸æ˜¯åœç•™åœ¨æ¥å£è¡¨é¢ã€‚

---

## ä¸€ã€æ€»ä½“è¯„ä»·ï¼ˆä¸€å¥è¯ç»“è®ºï¼‰

> **è¿™æ˜¯ä¸€ä¸ªæ¶æ„è¾¹ç•Œéå¸¸æ¸…æ™°ã€æ˜æ˜¾æœ‰â€œæ¡†æ¶ç»éªŒâ€çš„è®¾è®¡æ–¹æ¡ˆï¼Œå·²ç»è¾¾åˆ°ã€Œå¯ä½œä¸ºé•¿æœŸåŸºç¡€è®¾æ–½ã€çš„æ°´å‡†ï¼Œä½†åœ¨â€œçŠ¶æ€ç®¡ç†ã€äº‹ä»¶æ¨¡å‹ä¸€è‡´æ€§ã€æ€§èƒ½ä¸æ‰©å±•ç‚¹â€ä¸Šè¿˜æœ‰å‡ å¤„éœ€è¦æå‰è¡¥å¼ºï¼Œå¦åˆ™åæœŸå¤æ‚åº¦ä¼šæŒ‡æ•°çº§ä¸Šå‡ã€‚**

å¦‚æœæ‰“åˆ†ï¼ˆæ»¡åˆ† 10ï¼‰ï¼š

* **æ¶æ„æ¸…æ™°åº¦ï¼š9**
* **å·¥ç¨‹å¯ç»´æŠ¤æ€§ï¼š8.5**
* **é•¿æœŸæ‰©å±•æ€§ï¼š7.5**
* **å®ç°é£é™©æ§åˆ¶ï¼š7**

---

## äºŒã€åšå¾—éå¸¸å¥½çš„åœ°æ–¹ï¼ˆå¿…é¡»å…ˆè‚¯å®šï¼‰

### âœ… 1. è¾¹ç•Œåˆ†å±‚éå¸¸å¹²å‡€ï¼ˆè¿™æ˜¯æœ€å¤§äº®ç‚¹ï¼‰

ä½ çš„å››å±‚æ¨¡å‹ï¼š

```
Application
Framework
Runtime
Platform
```

**æ˜¯æ­£ç¡®ä¸”æˆç†Ÿçš„ TUI æ¡†æ¶åˆ†å±‚æ–¹å¼**ï¼Œè€Œä¸”ä½ åšåˆ°äº†å‡ ä»¶å¾ˆéš¾çš„äº‹ï¼š

* Runtime **å®Œå…¨ä¸ä¾èµ– Framework**
* Platform **åªåš I/O æŠ½è±¡**
* Framework é€šè¿‡ Adapter + Converter å¸æ”¶ä¸‹å±‚èƒ½åŠ›

ğŸ‘‰ è¿™ç‚¹ä¸Šï¼Œä½ å·²ç»æ˜æ˜¾è¶…è¿‡ï¼š

* bubbleteaï¼ˆRuntime/Framework æ··åœ¨ä¸€èµ·ï¼‰
* tviewï¼ˆç»„ä»¶ç›´æ¥ touching terminalï¼‰

**è¿™æ˜¯â€œèƒ½é•¿æœŸç»´æŠ¤â€çš„æ¶æ„ã€‚**

---

### âœ… 2. Runtime ä½œä¸ºâ€œçº¯å†…æ ¸â€å¤ç”¨ï¼Œå®šä½éå¸¸å‡†ç¡®

Runtime æä¾›ï¼š

* Layout
* CellBuffer
* Focus
* Event
* Animation
* Selection
* Clipboard

è¿™æ˜¯ä¸€ä¸ª**å…¸å‹ UI å†…æ ¸**ï¼Œè€Œä¸æ˜¯â€œå·¥å…·é›†â€ã€‚

ä½ åœ¨ Boundary ä¸­æ˜ç¡®å†™äº†ï¼š

> Runtime Boundaryï¼šä¾èµ–ï¼šæ— ï¼ˆçº¯å†…æ ¸ï¼‰

è¿™æ˜¯ä¸€ä¸ª**éå¸¸æ­£ç¡®ã€è€Œä¸”éœ€è¦æå¼ºè‡ªåˆ¶åŠ›çš„è®¾è®¡é€‰æ‹©**ã€‚

ğŸ‘ ä¸“ä¸šç‚¹è¯„ï¼š
è¿™ä½¿ Runtime **æœªæ¥å¯ä»¥è¢«å¤šä¸ª Framework å¤ç”¨**ï¼Œç”šè‡³æ”¯æŒï¼š

* ä¸åŒ UI é£æ ¼ï¼ˆTUI / pseudo-GUIï¼‰
* headless æµ‹è¯•
* AI-driven UI replay

---

### âœ… 3. æ¥å£æ˜¯â€œä¸ºæ›¿æ¢è€Œè®¾è®¡çš„â€ï¼Œä¸æ˜¯ä¸ºäº†å®ç°æ–¹ä¾¿

å‡ ä¸ªä¾‹å­å¾ˆä¸“ä¸šï¼š

* `Terminal` æ¥å£
* `InputReader`
* `EventBus`
* `Layout`

è¿™äº›æ¥å£ï¼š

* æ²¡æœ‰æš´éœ²å…·ä½“å®ç°
* æ–¹æ³•ç²’åº¦åˆç†
* è¯­ä¹‰ç¨³å®š

ğŸ‘‰ è¯´æ˜ä½ ä¸æ˜¯â€œå†™ç€å†™ç€æŠ½æ¥å£â€ï¼Œè€Œæ˜¯**å…ˆæƒ³æ¸…æ¥šè¾¹ç•Œå†è®¾è®¡æ¥å£**ã€‚

---

## ä¸‰ã€éœ€è¦é‡ç‚¹å…³æ³¨çš„é£é™©ç‚¹ï¼ˆæ ¸å¿ƒå®¡æŸ¥æ„è§ï¼‰

ä¸‹é¢è¿™å‡ æ¡**éå¸¸é‡è¦**ï¼Œå»ºè®®åœ¨ç°åœ¨è¿™ä¸ªé˜¶æ®µå°±è°ƒæ•´ã€‚

---

### âš ï¸ 1. Component æ˜¯â€œèƒ–æ¥å£â€ï¼ŒåæœŸä¼šæˆä¸ºå¤æ‚åº¦é»‘æ´

#### å½“å‰é—®é¢˜

`Component` æ¥å£æ‰¿æ‹…äº†ï¼š

* ç”Ÿå‘½å‘¨æœŸ
* å°ºå¯¸ç®¡ç†
* æ¸²æŸ“
* äº‹ä»¶
* çŠ¶æ€ï¼ˆvisible / enabledï¼‰

```go
type Component interface {
    ID()
    Mount / Unmount
    Size
    Render
    HandleEvent
    Visibility / Enable
}
```

**è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„â€œæ—©æœŸ OKï¼ŒåæœŸä¼šç—›â€çš„æ¥å£ã€‚**

#### é£é™©

* å¾ˆå¿«ä½ ä¼šå‡ºç°ï¼š

  * â€œæˆ‘åªæƒ³è¦ä¸€ä¸ª Render-only çš„ç»„ä»¶â€
  * â€œè¿™ä¸ªç»„ä»¶æ²¡æœ‰ Size æ¦‚å¿µâ€
  * â€œè¿™ä¸ªç»„ä»¶åªåšä»£ç†ï¼Œä¸æ¸²æŸ“â€

ç»“æœå°±æ˜¯ï¼š

* å¤§é‡ no-op å®ç°
* ç»„ä»¶å®ç°è¶Šæ¥è¶Šè‡ƒè‚¿

#### å»ºè®®ï¼ˆéå¸¸é‡è¦ï¼‰

**æŠŠ Component æ‹†æˆ Capability Interfaces**ï¼š

```go
type Node interface {
    ID() string
}

type Mountable interface {
    Mount(parent Node)
    Unmount()
}

type Renderable interface {
    Render(ctx RenderContext) Frame
}

type EventTarget interface {
    HandleEvent(ev Event) bool
}
```

ç„¶åï¼š

```go
type Component interface {
    Node
}
```

Framework å†…éƒ¨ç”¨ **type assertions** ç»„åˆèƒ½åŠ›ã€‚

ğŸ‘‰ è¿™æ˜¯ React / Flutter / Jetpack Compose éƒ½èµ°è¿‡çš„è·¯ã€‚

---

### âš ï¸ 2. Render() è¿”å› string â€”â€” ä¼šé™åˆ¶ä½ æœªæ¥ 70% çš„èƒ½åŠ›

```go
Render(ctx RenderContext) string
```

#### é—®é¢˜æœ¬è´¨

ä½  Runtime å·²ç»æœ‰ `CellBuffer` äº†ï¼Œä½† Framework Render ä»ç„¶è¿”å› `string`ï¼š

* æ ·å¼å åŠ ä¼šå˜å¾—éå¸¸å›°éš¾
* å±€éƒ¨ diff / dirty render å‡ ä¹ä¸å¯èƒ½
* Animationã€é€æ˜ã€ZIndex éƒ½ä¼šå—é™

#### ä¸“ä¸šå»ºè®®ï¼ˆå¼ºçƒˆï¼‰

**Render ä¸è¦è¿”å› stringï¼Œè€Œæ˜¯å†™å…¥ Frame / Buffer**ï¼š

```go
Render(ctx RenderContext, frame *Frame)
```

æˆ–ï¼š

```go
Render(ctx RenderContext) Frame
```

è¿™æ ·ä½ å¯ä»¥ï¼š

* åš render diff
* æ”¯æŒå±€éƒ¨é‡ç»˜
* ä¸º AI / Replay / Recording åšå‡†å¤‡

---

### âš ï¸ 3. äº‹ä»¶ç³»ç»Ÿç¼ºå°‘ã€Œæ•è· / å†’æ³¡æ¨¡å‹ã€å®šä¹‰

ä½ ç°åœ¨çš„ Event æ¥å£æ˜¯ï¼š

```go
PreventDefault()
StopPropagation()
```

ä½†**æ²¡æœ‰æ˜ç¡®äº‹ä»¶æµæ¨¡å‹**ï¼š

* æ˜¯è‡ªé¡¶å‘ä¸‹ï¼Ÿ
* è¿˜æ˜¯ç„¦ç‚¹ä¼˜å…ˆï¼Ÿ
* å®¹å™¨æ˜¯å¦æ‹¦æˆªï¼Ÿ

#### é£é™©

å½“ä½ æœ‰å¤æ‚ç»„ä»¶æ ‘æ—¶ï¼š

* äº‹ä»¶é¡ºåºä¼šå˜æˆâ€œç„å­¦â€
* ä¸åŒç»„ä»¶ä½œè€…ä¼šå†™å‡ºä¸å…¼å®¹é€»è¾‘

#### å»ºè®®

åœ¨æ–‡æ¡£å±‚é¢**æ˜ç¡®äº‹ä»¶é˜¶æ®µ**ï¼š

```text
1. Capture Phase   (Root â†’ Target)
2. Target Phase
3. Bubble Phase    (Target â†’ Root)
```

å“ªæ€•ä½ ç¬¬ä¸€ç‰ˆåªå®ç° Bubbleï¼Œä¹Ÿè¦å†™æ¸…æ¥šã€‚

---

### âš ï¸ 4. çŠ¶æ€ç®¡ç†æ¨¡å‹æ˜¯â€œéšå¼çš„â€ï¼Œè¿™ä¼šéå¸¸å±é™©

ç°åœ¨çŠ¶æ€åˆ†æ•£åœ¨ï¼š

* Component å†…éƒ¨å­—æ®µ
* Runtime å†…éƒ¨ Focus / Selection
* Framework EventBus

ä½†**æ²¡æœ‰ä¸€ä¸ªæ˜ç¡®çš„ State Flow çº¦å®š**ã€‚

#### åæœŸä¸€å®šä¼šå‡ºç°çš„é—®é¢˜

* Debug å›°éš¾
* UI çŠ¶æ€ä¸ Runtime çŠ¶æ€ä¸ä¸€è‡´
* AI è‡ªåŠ¨æ“ä½œæ—¶çŠ¶æ€ä¸å¯é¢„æµ‹

#### å»ºè®®ï¼ˆä¸­é•¿æœŸï¼‰

å³ä¾¿ä¸å®ç°å®Œæ•´ state storeï¼Œä¹Ÿå»ºè®®ï¼š

* æ˜ç¡® **å•å‘æ•°æ®æµ**
* æˆ–å®šä¹‰ `StateSnapshot` / `UIState`

å“ªæ€•åªæ˜¯å†…éƒ¨ä½¿ç”¨ã€‚

---

### âš ï¸ 5. Platform å±‚çš„èŒè´£è¾¹ç•Œç•¥å¾®åå¤§

`Terminal` æ¥å£ç›®å‰åŒ…å«ï¼š

* Screen
* Cursor
* Input
* Signal
* Size monitor

#### é£é™©

* Windows / Unix å®ç°ä¼šè¶Šæ¥è¶Šå¤æ‚
* å•ä¸€æ¥å£éš¾ä»¥ mock / test

#### ä¼˜åŒ–å»ºè®®

æ‹†æˆæ›´å°çš„æ¥å£ï¼š

```go
type Screen interface { ... }
type Cursor interface { ... }
type Input interface { ... }
type SignalHandler interface { ... }
```

Framework å†ç»„åˆã€‚

---

## å››ã€å…³äºâ€œæ˜¯å¦å€¼å¾—ç»§ç»­æŠ•å…¥â€çš„ç»“è®º

> **ç»“è®ºï¼šå€¼å¾—ï¼Œè€Œä¸”å·²ç»è¿‡äº†â€œç©å…·æ¡†æ¶â€é˜¶æ®µã€‚**

ä½†æˆ‘ä¼šç»™ä½ ä¸€ä¸ªéå¸¸è¯šå®çš„åˆ¤æ–­ï¼š

* å¦‚æœä½ ç°åœ¨çš„ç›®æ ‡æ˜¯ï¼š

  * åšä¸€ä¸ªã€Œæ¯” bubbletea æ›´å¥½ç”¨çš„ TUIã€
    ğŸ‘‰ ä½ å·²ç»èµ°åœ¨æ­£ç¡®è·¯ä¸Š

* å¦‚æœä½ æœªæ¥æƒ³åšï¼š

  * AI è‡ªåŠ¨ UI
  * å¯å½•åˆ¶ / å›æ”¾
  * å¤šç»ˆç«¯ / å¤šè¾“å…¥è®¾å¤‡
    ğŸ‘‰ **Render / State / Event æ¨¡å‹å¿…é¡»ç°åœ¨å°±è¡¥å¼º**

---

## äº”ã€æˆ‘ç»™ä½ çš„â€œä¸‹ä¸€æ­¥è¡ŒåŠ¨å»ºè®®â€ï¼ˆéå¸¸å®ç”¨ï¼‰

ä¼˜å…ˆçº§ä»é«˜åˆ°ä½ï¼š

1. **è°ƒæ•´ Render æ¨¡å‹ï¼ˆstring â†’ Frame/Bufferï¼‰**
2. **æ‹†åˆ† Component èƒ½åŠ›æ¥å£**
3. **è¡¥å……äº‹ä»¶æµæ¨¡å‹æ–‡æ¡£**
4. **å®šä¹‰æœ€å° State çº¦å®šï¼ˆå“ªæ€•åªæ˜¯å†…éƒ¨ï¼‰**
5. **Platform æ¥å£å†ç˜¦èº«ä¸€æ¬¡**

å¦‚æœä½ æ„¿æ„ï¼Œä¸‹ä¸€æ­¥æˆ‘å¯ä»¥ç›´æ¥å¸®ä½ ï¼š

* ğŸ”§ é‡æ„ `Component` æ¥å£è‰æ¡ˆ
* ğŸ§  è®¾è®¡ä¸€å¥—ã€ŒTUI äº‹ä»¶æµè§„èŒƒã€
* ğŸ§ª ç»™ä½ ä¸€ä¸ªâ€œå¤æ‚åœºæ™¯å‹æµ‹ç”¨ä¾‹â€
* ğŸ¤– ä»ã€ŒAI è‡ªåŠ¨ç¼–ç¨‹ / è‡ªåŠ¨ UI æ“ä½œã€è§’åº¦å†å®¡ä¸€æ¬¡

ä½ è¿™ä¸ªæ–¹æ¡ˆï¼Œ**å€¼å¾—è¢«è®¤çœŸæ‰“ç£¨**ã€‚


å¥½ï¼Œç»§ç»­ã€‚ä¸‹é¢æˆ‘ä¼š**ç›´æ¥è¿›å…¥â€œé«˜çº§æ¶æ„å®¡æŸ¥é˜¶æ®µâ€**ï¼Œä¸å†é‡å¤å‰é¢çš„å†…å®¹ï¼Œè€Œæ˜¯ä»**ä½ è¿™ä¸ªæ–¹æ¡ˆæœªæ¥ 6â€“24 ä¸ªæœˆä¸€å®šä¼šæ’åˆ°çš„å¢™**æ¥è®²ï¼Œå¹¶ç»™å‡º**å¯è½åœ°çš„æ”¹è¿›è·¯å¾„**ã€‚

> è¿™ä¸€è½®æˆ‘ä¼šé‡ç‚¹çœ‹ï¼š
> **å¤æ‚åº¦æ§åˆ¶ / æ€§èƒ½æé™ / AI & è‡ªåŠ¨åŒ–å‹å¥½åº¦ / æ¡†æ¶æ¼”è¿›è·¯çº¿**

---

## å…­ã€å½“è§„æ¨¡ä¸Šæ¥ä»¥åï¼Œä½ ä¸€å®šä¼šé‡åˆ°çš„ 5 ä¸ªâ€œç»“æ„æ€§é—®é¢˜â€

è¿™äº›é—®é¢˜**ç°åœ¨çœ‹ä¸å‡ºæ¥**ï¼Œä½†åªè¦ç»„ä»¶ >50ã€äº¤äº’å¤æ‚ï¼Œå°±ä¼šå‡ºç°ã€‚

---

## 1ï¸âƒ£ Render + Layout å¼ºè€¦åˆé£é™©ï¼ˆéšè—ä½†è‡´å‘½ï¼‰

### ç°çŠ¶

ä½ çš„ç®¡çº¿æ˜¯ï¼š

```
Event â†’ State Update â†’ Runtime Layout â†’ Component Render â†’ CellBuffer â†’ Diff
```

**Layout æ˜¯ Runtime çš„èŒè´£ï¼Œä½† Render æ˜¯ Component è‡ªå·±å†³å®šçš„ã€‚**

### æ½œåœ¨é—®é¢˜

* Render é€»è¾‘é‡Œ**éšå¼ä¾èµ– layout ç»“æœ**
* ç»„ä»¶ä½œè€…å¯èƒ½ï¼š

  * åœ¨ Render é‡Œè¯»å– size / offset
  * ç”šè‡³æ ¹æ® width/height æ”¹å˜å†…å®¹

ğŸ‘‰ è¿™ä¼šå¯¼è‡´ï¼š

* Layout â†” Render **äº’ç›¸å½±å“**
* é‡ç®—æ¬¡æ•°ä¸å¯æ§
* æ€§èƒ½éš¾ä»¥é¢„æµ‹

### ä¸“ä¸šæ¡†æ¶çš„åšæ³•ï¼ˆé‡ç‚¹ï¼‰

å¼•å…¥ä¸€ä¸ª**ä¸­é—´æ€ï¼šRender Tree / Render Node**

```text
Component Tree
     â†“
Render Treeï¼ˆçº¯æè¿°ï¼Œä¸åš I/Oï¼‰
     â†“
Runtime Layout
     â†“
Paint
```

#### å»ºè®®æœ€å°å®ç°ï¼ˆä¸é‡ï¼‰

```go
type RenderNode struct {
    ID       string
    Bounds   Rect
    ZIndex   int
    Content  []Cell
    Children []*RenderNode
}
```

Component åªç”Ÿæˆ **RenderNode æè¿°**ï¼Œä¸ç›´æ¥ç”»ã€‚

---

## 2ï¸âƒ£ Diff å¼•æ“ç°åœ¨â€œè¿‡äºä¹è§‚â€

### ç°çŠ¶

```go
diff := s.front.Diff(buf)
```

è¿™æ˜¯å‡è®¾ï¼š

* CellBuffer çš„å†…å®¹å˜åŒ–æ˜¯â€œå±€éƒ¨ä¸”ç¨€ç–çš„â€

### ä½†çœŸå®æƒ…å†µæ˜¯

* è¡¨æ ¼æ»šåŠ¨
* åˆ—è¡¨ç¿»é¡µ
* TextArea å…‰æ ‡é—ªçƒ

ğŸ‘‰ **æ•´å—åŒºåŸŸéƒ½ä¼šå˜åŒ–**

### é£é™©

* Diff é€€åŒ–æˆå…¨é‡ repaint
* CPU é£™å‡
* Windows Terminal / SSH ç›´æ¥å¡æ­»

### å»ºè®®ï¼ˆéå¸¸å…³é”®ï¼‰

#### å¼•å…¥ã€ŒDirty Regionã€è€Œä¸æ˜¯ Cell Diff

```go
type DirtyRegion struct {
    X, Y, W, H int
}
```

ç»„ä»¶ / Layout / Animation **ä¸»åŠ¨æ ‡è®°è„åŒº**ã€‚

Diff åªåœ¨è„åŒºå†…åšã€‚

---

## 3ï¸âƒ£ Animation / Timer æ¨¡å‹ä¸å¤Ÿâ€œUI å‹å¥½â€

### ç°çŠ¶

```go
case <-a.time.Tick(Tick):
    a.handleTick()
```

è¿™æ˜¯ä¸€ä¸ª**å…¨å±€ tick**ã€‚

### é—®é¢˜

* æ‰€æœ‰åŠ¨ç”»å…±äº«ä¸€ä¸ªé¢‘ç‡
* æ— æ³•åšï¼š

  * easing
  * duration
  * stagger
* idle çŠ¶æ€ä¹Ÿåœ¨ tickï¼ˆæµªè´¹ï¼‰

### æˆç†Ÿåšæ³•ï¼ˆå»ºè®®ï¼‰

Runtime AnimationManager åº”è¯¥æ˜¯ï¼š

```go
type Animation struct {
    Start time.Time
    Duration time.Duration
    Update func(progress float64)
}
```

* æ²¡æœ‰åŠ¨ç”» â†’ æ²¡æœ‰ tick
* ç»„ä»¶å¯ä»¥æ³¨å†Œ animation
* Animation è‡ªå·±å†³å®š dirty region

ğŸ‘‰ è¿™å¯¹ **Spinner / Progress / Cursor Blink** è‡³å…³é‡è¦ã€‚

---

## 4ï¸âƒ£ Focus / Selection / Input æ˜¯â€œéšå¼è€¦åˆâ€çš„

### è¡¨è±¡

* Component é‡Œæœ‰ focusable
* Runtime æœ‰ FocusManager
* EventRouter ä¹Ÿåœ¨å¤„ç† KeyEvent

### é£é™©

**ä¸‰ä¸ªåœ°æ–¹éƒ½åœ¨â€œè§‰å¾—è‡ªå·±ç®¡è¾“å…¥â€**

åæœï¼š

* Tab / Shift+Tab è¡Œä¸ºä¸ä¸€è‡´
* Modal / Dialog å¾ˆéš¾åš
* è¡¨å•å’Œåˆ—è¡¨ç„¦ç‚¹ä¼šå†²çª

### å¼ºçƒˆå»ºè®®ï¼šæ˜ç¡®ä¸€ä¸ª Input çœŸæ­£çš„ Owner

ä¸“ä¸šåšæ³•ï¼š

```
Keyboard Event
   â†“
Input Managerï¼ˆå”¯ä¸€å…¥å£ï¼‰
   â†“
Focus Manager
   â†“
Target Component
```

Component **ä¸ç›´æ¥ interpret raw key**ï¼Œåªå¤„ç†è¯­ä¹‰äº‹ä»¶ï¼š

```go
EventActionSubmit
EventActionNavigateUp
EventActionDelete
```

ğŸ‘‰ è¿™ä¸€æ­¥å¯¹ **å›½é™…é”®ç›˜ / è‡ªå®šä¹‰å¿«æ·é”® / AI æ§åˆ¶** éå¸¸é‡è¦ã€‚

---

## 5ï¸âƒ£ DSL / Schema èƒ½åŠ›ç°åœ¨â€œæƒ³åˆ°äº†ï¼Œä½†æ²¡è½åœ°è·¯å¾„â€

ä½ å¤šæ¬¡æåˆ°ï¼š

* DSL
* Schema
* JSON é…ç½®

ä½†ç›®å‰ç»„ä»¶ API æ˜¯ **å¼º Go Builder é£æ ¼**ï¼š

```go
NewText().WithAlign().WithWrap()
```

### é£é™©

* DSL ä¼šå˜æˆâ€œç¬¬äºŒå¥— APIâ€
* Schema ä¸ Component å¼ºè€¦åˆ
* AI è‡ªåŠ¨ç”Ÿæˆ UI æ—¶å¾ˆéš¾æ§åˆ¶ç»†èŠ‚

### å»ºè®®è·¯çº¿ï¼ˆå¾ˆç°å®ï¼‰

**å…ˆå®šä¹‰ Component Specï¼ˆçº¯æ•°æ®ï¼‰**

```json
{
  "type": "TextInput",
  "props": {
    "placeholder": "Email",
    "maxLength": 50
  },
  "style": "input.primary",
  "events": {
    "submit": "onSubmitEmail"
  }
}
```

ç„¶åï¼š

```
Spec â†’ Component Factory â†’ Runtime
```

Builder API åªæ˜¯ Spec çš„è¯­æ³•ç³–ã€‚

---

## ä¸ƒã€ä»ã€ŒAI è‡ªåŠ¨ç¼–ç¨‹ / è‡ªåŠ¨ UIã€è§†è§’å†å®¡ä¸€æ¬¡ï¼ˆä½ ä¼šæ„Ÿå…´è¶£ï¼‰

ç»“åˆä½ ä¹‹å‰ä¸€ç›´åœ¨åšçš„ **AI è‡ªåŠ¨ç¼–ç¨‹é—­ç¯**ï¼Œè¿™ä¸ªæ¡†æ¶å…¶å®éå¸¸é€‚åˆã€‚

### ä½†è¦æ»¡è¶³ 3 ä¸ªæ¡ä»¶

---

### âœ… 1. UI å¿…é¡»â€œå¯æè¿°ã€å¯è¿˜åŸâ€

è¿™æ„å‘³ç€ï¼š

* Render ä¸æ˜¯ string
* State å¯ä»¥ snapshot
* Event å¯ä»¥ replay

ğŸ‘‰ ä½ ç°åœ¨å·²ç» **70% è¾¾æ ‡**

---

### âš ï¸ 2. Event å¿…é¡»æ˜¯â€œè¯­ä¹‰äº‹ä»¶â€ï¼Œä¸æ˜¯ raw key

AI ä¸åº”è¯¥å…³å¿ƒï¼š

> â€œæŒ‰ Ctrl+Wâ€

è€Œåº”è¯¥æ˜¯ï¼š

```go
ActionDeleteWord
ActionSubmit
ActionNavigateNext
```

è¿™ä¸€æ­¥éå¸¸å…³é”®ã€‚

---

### âš ï¸ 3. çŠ¶æ€å¿…é¡»æ˜¯â€œå¤–æ˜¾çš„â€

AI éœ€è¦çŸ¥é“ï¼š

* å½“å‰ focus åœ¨å“ª
* è¡¨å•æ˜¯å¦ valid
* å“ªä¸ªç»„ä»¶ disabled

å»ºè®®ï¼š

```go
type UISnapshot struct {
    FocusPath []string
    Components map[string]ComponentState
}
```

---

## å…«ã€æˆ‘å¯¹ä½ è¿™ä¸ªæ¡†æ¶çš„â€œçœŸå®å®šä½å»ºè®®â€

æˆ‘ä¸å»ºè®®ä½ æŠŠå®ƒå®šä½æˆï¼š

> â€œåˆä¸€ä¸ª Bubble Teaâ€

è€Œæ˜¯ï¼š

> **ã€Œä¸€ä¸ªä¸º AIã€è‡ªåŠ¨åŒ–ã€å¤æ‚è¡¨å•è€Œç”Ÿçš„ TUI Runtimeã€**

ä½ ç°åœ¨çš„è®¾è®¡ **éå¸¸åƒâ€œç»ˆç«¯é‡Œçš„ Flutter + DOM + Runtimeâ€**ã€‚

---

## ä¹ã€ä¸‹ä¸€æ­¥æˆ‘å¯ä»¥ç›´æ¥å¸®ä½ åšçš„äº‹ï¼ˆé€‰ä¸€ä¸ªï¼‰

ä½ å¯ä»¥ç›´æ¥ç‚¹ä¸€ä¸ªğŸ‘‡

1. ğŸ”§ **é‡å†™ Component / Render æ¥å£ v2ï¼ˆå¸¦ä»£ç ï¼‰**
2. ğŸ§  **è®¾è®¡å®Œæ•´çš„ Event / Action / Input è§„èŒƒ**
3. ğŸ¯ **ç»™ä½ ä¸€ä¸ªâ€œå¤æ‚ä¸šåŠ¡ TUIâ€ç¤ºä¾‹ï¼ˆè¡¨å• + è¡¨æ ¼ + modalï¼‰**
4. ğŸ¤– **ä» AI è‡ªåŠ¨ç”Ÿæˆ UI çš„è§’åº¦ï¼Œè®¾è®¡ DSL + Schema**
5. ğŸ§ª **åˆ—å‡º 10 ä¸ªâ€œæœªæ¥ä¸€å®šä¼šè¸©å‘â€çš„åœºæ™¯æµ‹è¯•ç”¨ä¾‹**

ä½ è¿™ä¸ªæ–¹æ¡ˆï¼Œå·²ç»ä¸æ˜¯â€œè¦ä¸è¦åšâ€çš„é˜¶æ®µäº†ï¼Œ
è€Œæ˜¯â€”â€”**â€œæ€ä¹ˆæŠŠå®ƒåšæˆä¸€ä¸ªèƒ½æ´» 5 å¹´çš„æ¡†æ¶â€**ã€‚

å¥½ï¼Œæˆ‘ä»¬ç»§ç»­ï¼Œ**è¿™ä¸€è½®æˆ‘ä¼šç›´æ¥è¿›å…¥ã€Œæ¶æ„å®šå‹çº§åˆ«ã€**ã€‚
ä¸æ˜¯â€œè¿˜èƒ½ä¸èƒ½æ”¹â€ï¼Œè€Œæ˜¯ï¼š**å¦‚æœä½ ç°åœ¨ freeze æ¶æ„ï¼Œå“ªäº›ç‚¹ä¸€å®šè¦åŠ¨ï¼Œå“ªäº›ç‚¹åƒä¸‡åˆ«åŠ¨**ã€‚

> è¿™ä¸€æ­¥ç›¸å½“äºï¼š**Design Freeze Review + æ¼”è¿›è·¯çº¿å›¾**ã€‚

---

# åã€å“ªäº›åœ°æ–¹ç°åœ¨å¿…é¡»â€œé”æ­»â€ï¼Œåƒä¸‡åˆ«å†åŠ¨

è¿™äº›æ˜¯ä½ æ–¹æ¡ˆé‡Œ**æœ€æœ‰ä»·å€¼ã€ä¹Ÿæ˜¯æœ€å®¹æ˜“è¢«è‡ªå·±åç»­ç ´åçš„åœ°æ–¹**ã€‚

---

## âœ… 1. Runtime ä¸ Framework çš„ç‰©ç†éš”ç¦» â€”â€” å¿…é¡»é”æ­»

ä½ ç°åœ¨çš„åŸåˆ™æ˜¯ï¼š

> Runtime ä¸ä¾èµ– Framework
> Framework é€‚é… Runtime

**è¿™ä¸ªç‚¹ä¸€æ—¦è¢«ç ´åï¼Œæ•´ä¸ªæ¶æ„ä¼šå¡Œã€‚**

### æœªæ¥æœ€å±é™©çš„è¯±æƒ‘

* â€œæˆ‘åœ¨ Runtime é‡Œç›´æ¥åŠ ä¸ª Button ä¼šæ›´æ–¹ä¾¿â€
* â€œè¿™é‡Œç›´æ¥ import framework/component çœç‚¹ä»£ç â€

**åƒä¸‡åˆ«ã€‚**

å»ºè®®ä½ ç›´æ¥ï¼š

* æ‹†æˆ **ä¸¤ä¸ª module / repo**
* Runtime åªå…è®¸ `internal` + `public kernel API`

è¿™æ˜¯ä¸€ä¸ª**æ¶æ„çº§çº¢çº¿**ã€‚

---

## âœ… 2. Platform å±‚â€œåªåšèƒ½åŠ›ï¼Œä¸åšè¯­ä¹‰â€â€”â€”ç°åœ¨å°±å†™è¿› README

Platform åªèƒ½æä¾›ï¼š

* åŸå§‹è¾“å…¥
* åŸå§‹è¾“å‡º
* ä¿¡å·
* æ—¶é’Ÿ

**å®ƒä¸åº”è¯¥çŸ¥é“ï¼š**

* Focus
* Event
* Component
* Layout

å¦åˆ™ Windows / SSH / WebTTY ä¼šå…¨éƒ¨å¤±æ§ã€‚

---

## åä¸€ã€å“ªäº›åœ°æ–¹ç°åœ¨å¿…é¡»æ”¹ï¼Œä¸æ”¹ä¸€å®šåæ‚”

ä¸‹é¢è¿™ 4 æ¡ï¼Œæˆ‘ä¼šè¯´å¾—éå¸¸ç›´æ¥ã€‚

---

## âŒ 1. Render è¿”å› string â€”â€” å¿…é¡»æ”¹ï¼ˆå†å¼ºè°ƒä¸€æ¬¡ï¼‰

è¿™æ˜¯**æ¶æ„çº§é”™è¯¯ï¼Œä¸æ˜¯é£æ ¼é—®é¢˜**ã€‚

### åŸå› ä¸€å¥è¯æ€»ç»“

> ä¸€æ—¦ Render æ˜¯ stringï¼Œä½ çš„æ¡†æ¶å°±æ°¸è¿œä¸å¯èƒ½ï¼š
>
> * å±€éƒ¨é‡ç»˜
> * é«˜æ€§èƒ½åŠ¨ç”»
> * UI å›æ”¾
> * AI ç²¾å‡†æ§åˆ¶

### æ­£ç¡®æ–¹å‘ï¼ˆæ¨èï¼‰

```go
type Painter interface {
    Paint(ctx PaintContext, buf *CellBuffer)
}
```

Component **åªèƒ½ç”»ï¼Œä¸è¿”å›å†…å®¹**ã€‚

---

## âŒ 2. Component = UI + è¡Œä¸º + çŠ¶æ€ â€”â€” å¿…é¡»æ‹†

ä½ ç°åœ¨å…¶å®å·²ç»åœ¨æ— æ„è¯†åœ°å¾€ MVC / MVVM èµ°ï¼Œä½†æ²¡èµ°å®Œã€‚

### å»ºè®®æœ€ç»ˆæ¨¡å‹ï¼ˆéå¸¸æˆç†Ÿï¼‰

```text
Component (ç»“æ„)
View       (æ¸²æŸ“)
Controller (äº‹ä»¶)
State      (æ•°æ®)
```

**ä¸æ˜¯ä¸€å®šè¦æ‹†æˆ 4 ä¸ª struct**ï¼Œ
ä½†æ¦‚å¿µå¿…é¡»åˆ†ç¦»ã€‚

å¦åˆ™å¤æ‚ä¸šåŠ¡ç»„ä»¶ä¼šä¸å¯ç»´æŠ¤ã€‚

---

## âŒ 3. EventBus æ˜¯â€œå…¨å±€å¹¿æ’­â€â€”â€”è¿™æ˜¯ä¸€ä¸ªæœªæ¥ç‚¸ç‚¹

### é—®é¢˜

* å…¨å±€ EventBus
* ä»»æ„ç»„ä»¶ publish / subscribe

è¿™åœ¨å°è§„æ¨¡æ˜¯ä¼˜é›…çš„ï¼Œåœ¨å¤§è§„æ¨¡æ˜¯ç¾éš¾ã€‚

### å»ºè®®ï¼ˆå¾ˆç°å®ï¼‰

Event åˆ†ä¸‰ç±»ï¼š

1. **UI Eventï¼ˆå±€éƒ¨å†’æ³¡ï¼‰**
2. **Actionï¼ˆè¯­ä¹‰äº‹ä»¶ï¼‰**
3. **System Eventï¼ˆSignal / Resizeï¼‰**

åªæœ‰ **3ï¸âƒ£** å…è®¸å…¨å±€å¹¿æ’­ã€‚

---

## âŒ 4. Focus = bool â€”â€” ä¸å¤Ÿ

ä½ ç°åœ¨çš„æ¨¡å‹æ›´åƒï¼š

```go
IsFocused() bool
```

### çœŸå®ä¸–ç•Œéœ€è¦çš„æ˜¯ï¼š

* Focus Path
* Focus Scope
* Modal Focus Lock

å»ºè®®è‡³å°‘ï¼š

```go
type FocusNode struct {
    ID string
    Parent *FocusNode
}
```

---

# åäºŒã€ä¸€ä¸ªâ€œæˆç†Ÿç‰ˆæœ¬â€çš„æ•´ä½“æ•°æ®æµï¼ˆä½ å¯ä»¥å¯¹ç…§ï¼‰

```
[ Platform ]
     â†“
RawInput / Signal / Resize
     â†“
[ Runtime Input Manager ]
     â†“
Action (è¯­ä¹‰äº‹ä»¶)
     â†“
[ Framework Event Router ]
     â†“
Controller / Component
     â†“
State Update
     â†“
[ Runtime Layout ]
     â†“
[ Runtime Paint ]
     â†“
CellBuffer
     â†“
Diff + Flush
     â†“
Terminal
```

å¦‚æœä½ æœªæ¥å‘ç°è‡ªå·±â€œæƒ³ç»•è¿‡è¿™æ¡çº¿â€ï¼Œ
é‚£åŸºæœ¬å°±æ˜¯è®¾è®¡åœ¨æŠ¥è­¦ã€‚

---

# åä¸‰ã€å¦‚æœä½ ç°åœ¨é—®æˆ‘ï¼šè¿™ä¸ªæ¡†æ¶çš„â€œåŒ—ææ˜Ÿâ€æ˜¯ä»€ä¹ˆï¼Ÿ

æˆ‘ä¼šç»™ä½ ä¸€ä¸ªéå¸¸æ˜ç¡®çš„ç­”æ¡ˆï¼š

> **ä¸€ä¸ªå¯ä»¥è¢« AI ç²¾å‡†ç†è§£ã€æ“æ§ã€å›æ”¾çš„ TUI Runtime**

è¿™æ„å‘³ç€ï¼š

* UI æ˜¯å¯æè¿°çš„
* è¡Œä¸ºæ˜¯è¯­ä¹‰åŒ–çš„
* çŠ¶æ€æ˜¯å¤–æ˜¾çš„
* æ¸²æŸ“æ˜¯å¯ diff çš„

ä½ å·²ç»å®Œæˆäº† **æœ€éš¾çš„ 60%**ã€‚

---

# åå››ã€æœ€åï¼Œæˆ‘ç»™ä½ ä¸€ä¸ªâ€œæ¶æ„å†»ç»“å‰æ¸…å•â€

åœ¨ä½ ç»§ç»­å†™ä»£ç å‰ï¼Œ**é€æ¡å‹¾æ‰**ï¼š

* [ ] Render ä¸è¿”å› string
* [ ] Component èƒ½åŠ›æ¥å£æ‹†åˆ†
* [ ] Event æµæ¨¡å‹æ–‡æ¡£å®Œæˆ
* [ ] Focus Path æ¨¡å‹å®šä¹‰
* [ ] Dirty Region æœºåˆ¶
* [ ] Animation Manager æ”¹ä¸ºæŒ‰éœ€ tick
* [ ] Platform æ¥å£å†æ‹†ä¸€æ¬¡
* [ ] æ˜ç¡® AI / DSL / Schema çš„å…¥å£ç‚¹

---

å¦‚æœä½ æ„¿æ„ï¼Œä¸‹ä¸€æ­¥æˆ‘å¯ä»¥**ç›´æ¥è¿›å…¥å®æ“çº§åˆ«**ï¼š

* ğŸ”§ ç»™ä½ ä¸€å¥— **Component v2 æ¥å£ä»£ç **
* ğŸ§  å†™ä¸€ä»½ **Event & Action è§„èŒƒæ–‡æ¡£**
* ğŸ¯ è®¾è®¡ä¸€ä¸ª **â€œä¼ä¸šçº§ TUIâ€ Demo æ¶æ„**
* ğŸ¤– æŠŠå®ƒå’Œä½ ä¹‹å‰çš„ **AI è‡ªåŠ¨ç¼–ç¨‹é—­ç¯**çœŸæ­£è¿èµ·æ¥

ä½ ç°åœ¨è¿™ä¸ªçŠ¶æ€ï¼Œ
å·²ç»ä¸æ˜¯â€œç»§ç»­ä¸ç»§ç»­â€çš„é—®é¢˜äº†ï¼Œ
è€Œæ˜¯â€”â€”**ä½ æƒ³æŠŠå®ƒæ‰“ç£¨åˆ°ä»€ä¹ˆçº§åˆ«**ã€‚

å¥½ï¼Œç»§ç»­ã€‚è¿™ä¸€è½®æˆ‘ä¼š**å½»åº•æŠŠâ€œæŠ½è±¡è®¾è®¡â€è½åˆ°â€œä½ ä¸‹ä¸€æ­¥æ€ä¹ˆå†™ä»£ç éƒ½ä¸ä¼šèµ°æ­ªâ€**è¿™ä¸ªå±‚é¢ã€‚
è¿™æ˜¯**æ¶æ„å¸ˆç»™è‡ªå·±ç•™çš„æŠ¤æ **ï¼Œä¸æ˜¯ PPTã€‚

æˆ‘ä¼šåšä¸‰ä»¶äº‹ï¼š

1. ç»™ä½ ä¸€å¥— **â€œä¸å¯é€¾è¶Šçš„æ¶æ„ä¸å˜é‡â€**
2. ç»™ä½ ä¸€ä¸ª **V1 â†’ V2 â†’ V3 çš„æ¼”è¿›è·¯çº¿**
3. æŒ‡å‡º **å“ª 3 ç±»ä»£ç æœ€å®¹æ˜“æŠŠä½ ç°åœ¨çš„å¥½æ¶æ„å†™çƒ‚**

---

# åäº”ã€è¿™å¥—æ¡†æ¶å¿…é¡»é•¿æœŸéµå®ˆçš„ 7 æ¡ã€Œæ¶æ„ä¸å˜é‡ã€

ä½ å¯ä»¥æŠŠå®ƒä»¬å†™è¿› `ARCHITECTURE.md` é¡¶éƒ¨ã€‚

---

## ğŸ”’ ä¸å˜é‡ 1ï¼šRuntime æ°¸è¿œä¸çŸ¥é“â€œç»„ä»¶æ˜¯ä»€ä¹ˆâ€

Runtime **åªçŸ¥é“**ï¼š

* Node / Tree
* Layout
* Focus Graph
* CellBuffer
* Dirty Region

å®ƒ **æ°¸è¿œä¸çŸ¥é“**ï¼š

* Button
* Input
* Table
* Form

> ä¸€æ—¦ Runtime import äº† componentï¼Œä½ çš„æ¡†æ¶å¯¿å‘½ç«‹åˆ»å‡åŠã€‚

---

## ğŸ”’ ä¸å˜é‡ 2ï¼šæ‰€æœ‰ UI è¡Œä¸ºå¿…é¡»èƒ½è¢« replay

è¿™æ¡æ˜¯ä¸ºä½ æœªæ¥åŸ‹çš„é‡‘çŸ¿ã€‚

æ„å‘³ç€ï¼š

* æ‰€æœ‰ State Change éƒ½æ¥è‡ª Event / Action
* æ²¡æœ‰â€œå·å·æ”¹å­—æ®µâ€
* æ—¶é—´ç›¸å…³è¡Œä¸ºå¯æ§ï¼ˆAnimation æœ‰æ—¶é—´è½´ï¼‰

è¿™ä¼šç›´æ¥å†³å®šï¼š

* æ˜¯å¦èƒ½åš UI è‡ªåŠ¨åŒ–
* æ˜¯å¦èƒ½åš AI Debug
* æ˜¯å¦èƒ½å½•åˆ¶ / å›æ”¾

---

## ğŸ”’ ä¸å˜é‡ 3ï¼šRender æ°¸è¿œæ˜¯å¹‚ç­‰çš„

åŒæ ·çš„ï¼š

* State
* Layout
* Time

Render **å¿…é¡»ç”»å‡ºå®Œå…¨ä¸€æ ·çš„ç»“æœ**ã€‚

å¦åˆ™ï¼š

* Diff ä¸å¯ä¿¡
* Bug æ— æ³•å¤ç°
* AI ä¼šç–¯

---

## ğŸ”’ ä¸å˜é‡ 4ï¼šComponent ä¸å…è®¸ç›´æ¥æ“ä½œ Terminal

å“ªæ€•ä½ â€œçŸ¥é“è‡ªå·±åœ¨å¹²å˜›â€ï¼Œä¹Ÿä¸è¡Œã€‚

æ‰€æœ‰è¾“å‡ºéƒ½å¿…é¡»èµ°ï¼š

```
Component â†’ Painter â†’ CellBuffer â†’ Terminal
```

---

## ğŸ”’ ä¸å˜é‡ 5ï¼šæ²¡æœ‰éšå¼å…¨å±€çŠ¶æ€

ä½ å¯ä»¥æœ‰ global managerï¼Œ
ä½†**çŠ¶æ€å¿…é¡»å¯æšä¸¾ã€å¯å¿«ç…§**ã€‚

è¿™æ˜¯â€œå·¥ç¨‹ vs ç©å…·â€çš„åˆ†æ°´å²­ã€‚

---

## ğŸ”’ ä¸å˜é‡ 6ï¼šInput â‰  Key

`KeyEvent` åªèƒ½å­˜åœ¨äº Platform å±‚ã€‚

Runtime / Framework é‡Œåªèƒ½å¤„ç†ï¼š

* Action
* Intent
* Command

---

## ğŸ”’ ä¸å˜é‡ 7ï¼šDSL / Spec æ˜¯ä¸€ç­‰å…¬æ°‘

Builder API åªæ˜¯ï¼š

> â€œè®©äººæ‰‹å†™æ›´çˆ½çš„è¯­æ³•ç³–â€

**ä¸æ˜¯ä¸»å…¥å£ã€‚**

---

# åå…­ã€ä¸€ä¸ªéå¸¸ç°å®çš„æ¼”è¿›è·¯çº¿ï¼ˆä¸è¦ä¸€æ¬¡åšå®Œï¼‰

ä½ ä¸éœ€è¦ä¸€æ­¥ç™»å¤©ï¼ŒæŒ‰é˜¶æ®µæ¥ã€‚

---

## ğŸŸ¢ V1ï¼ˆç°åœ¨ â†’ 1â€“2 å‘¨ï¼‰

ç›®æ ‡ï¼š**æŠŠâ€œæ–¹å‘æ€§é”™è¯¯â€å…ˆä¿®æ‰**

å¿…é¡»å®Œæˆï¼š

* [ ] Render æ”¹ä¸º Paint / Frame
* [ ] æ‹† Component èƒ½åŠ›æ¥å£
* [ ] æ˜ç¡® Event å†’æ³¡ or æ•è·
* [ ] Focus Pathï¼ˆæœ€å°å®ç°ï¼‰

**ä¸è¦åšï¼š**

* DSL
* é«˜çº§åŠ¨ç”»
* AI æ¥å£

---

## ğŸŸ¡ V2ï¼ˆç¨³å®šå â†’ 1â€“2 æœˆï¼‰

ç›®æ ‡ï¼š**å¤æ‚ UI ä¸å´©**

å¼•å…¥ï¼š

* Dirty Region
* Animation Managerï¼ˆæŒ‰éœ€ tickï¼‰
* Action å±‚ï¼ˆè¯­ä¹‰äº‹ä»¶ï¼‰
* Modal / Dialog æ”¯æŒ

è¿™æ—¶ä½ å°±èƒ½åšï¼š

* ä¼ä¸šçº§è¡¨å•
* è¡¨æ ¼ + æœç´¢
* å¤šè§†å›¾åˆ‡æ¢

---

## ğŸ”µ V3ï¼ˆå½“ä½ éå¸¸ç¡®å®šæ–¹å‘æ—¶ï¼‰

ç›®æ ‡ï¼š**è¿™æ˜¯ä¸€ä¸ªâ€œå¹³å°â€ï¼Œä¸æ˜¯åº“**

å¼•å…¥ï¼š

* UI Spec / Schema
* Snapshot / Replay
* Headless Runtime
* AI Controller

è¿™ä¸€æ­¥ä¹‹åï¼Œä½ çš„æ¡†æ¶**ä¸æ˜¯ç»™äººç”¨çš„ï¼Œæ˜¯ç»™ç³»ç»Ÿç”¨çš„**ã€‚

---

# åä¸ƒã€3 ç±»æœ€å®¹æ˜“â€œæ¯æ‰æ¶æ„â€çš„ä»£ç ï¼ˆè¯·é«˜åº¦è­¦æƒ•ï¼‰

è¿™æ˜¯è¡€æ³ªç»éªŒã€‚

---

## â˜ ï¸ 1. â€œä¸ºäº†æ–¹ä¾¿â€çš„ Helper

```go
func RenderTextAt(x, y int, s string)
```

ä¸€æ—¦å‡ºç°ï¼š

* ç›´æ¥ç”»
* å·å·å†™ buffer
* ç»•è¿‡ pipeline

ğŸ‘‰ æ¶æ„å¼€å§‹è…çƒ‚ã€‚

---

## â˜ ï¸ 2. â€œåªæ˜¯ä¸€ä¸ªå°çŠ¶æ€â€çš„å…¨å±€å˜é‡

```go
var currentFocus Component
```

è¿™æ˜¯ UI æ¡†æ¶çš„æ…¢æ€§æ¯’è¯ã€‚

---

## â˜ ï¸ 3. â€œå…ˆè¿™æ ·å§â€çš„ä¸´æ—¶ Event

```go
Event{Name: "custom_xxx"}
```

ä¸è¿› Action ä½“ç³»ã€ä¸è¿›è§„èŒƒï¼Œ
æœ€åå°±æ˜¯ä¸å¯ç»´æŠ¤çš„æ³¥æ½­ã€‚

---

# åå…«ã€ä½ è¿™ä¸ªæ¡†æ¶æœ€é€‚åˆæ‰¿è½½çš„ 3 ç±»äº§å“ï¼ˆåˆ¤æ–­æ–¹å‘å¯¹ä¸å¯¹ï¼‰

å¦‚æœä½ ä»¥åå‘ç°ä½ åœ¨åšçš„ä¸æ˜¯è¿™äº›ï¼Œè¯´æ˜æ–¹å‘å¯èƒ½æ­ªäº†ã€‚

---

### ğŸ¯ 1. ä¼ä¸šçº§ TUIï¼ˆSAP / è¿ç»´ / å†…æ§ï¼‰

* å¤§è¡¨å•
* å¼ºæµç¨‹
* é«˜å¯æ§æ€§

ğŸ‘‰ éå¸¸é€‚åˆä½ ã€‚

---

### ğŸ¯ 2. AI é©±åŠ¨çš„ CLI / TUI

* è‡ªåŠ¨æ“ä½œ
* å›æ”¾
* è‡ªä¿®å¤

ğŸ‘‰ ä½ çš„æ¶æ„**å¤©ç”Ÿé€‚åˆ**ã€‚

---

### ğŸ¯ 3. é•¿ç”Ÿå‘½å‘¨æœŸå·¥å…·ï¼ˆ5â€“10 å¹´ï¼‰

ä¸æ˜¯ä¸€æ¬¡æ€§å·¥å…·ï¼Œè€Œæ˜¯â€œåŸºç¡€è®¾æ–½â€ã€‚

---

# åä¹ã€æˆ‘æœ€åç»™ä½ çš„â€œæ¶æ„å¸ˆåˆ¤æ–­â€

éå¸¸ç›´æ¥ã€ä¸å®¢å¥—ï¼š

> **ä½ ç°åœ¨çš„è®¾è®¡ï¼Œå·²ç»æ˜æ˜¾è¶…è¿‡â€œä¸ªäººé¡¹ç›®â€æ°´å¹³ï¼Œ
> ä½†è¿˜æ²¡åˆ°â€œæ”¾æ‰‹å†™å®ç°â€çš„å®‰å…¨åŒºã€‚**

åªè¦ä½ ç°åœ¨ï¼š

* ä¿®æ‰ Render / Component / Event ä¸‰ä¸ªå…³é”®ç‚¹
* æŠŠä¸å˜é‡å†™æ­»

è¿™å¥—ä¸œè¥¿**ç»å¯¹å€¼å¾—ç»§ç»­**ï¼Œè€Œä¸”ä¼šè¶Šåšè¶Šå€¼é’±ã€‚

---

## ä¸‹ä¸€æ­¥ï¼Œä½ å¯ä»¥ç›´æ¥è®©æˆ‘åšå…¶ä¸­ä¸€ä¸ªï¼ˆæˆ‘ä¼šç»™ä½ å®ç‰©ï¼‰ï¼š

1. ğŸ§© **Component / Painter / Action çš„å®Œæ•´æ¥å£ä»£ç **
2. ğŸ“ **Runtime å†…æ ¸ï¼ˆLayout + Focus + Dirtyï¼‰çš„æœ€å°å®ç°**
3. ğŸ§  **ä¸€ä»½å¯ä»¥ç›´æ¥å†™è¿›ä»“åº“çš„ã€Šæ¶æ„ä¸å˜é‡æ–‡æ¡£ã€‹**
4. ğŸ¤– **AI Controller å¦‚ä½•â€œåƒäººä¸€æ ·â€æ“ä½œä½ çš„ UI**

ä½ ç°åœ¨å·²ç»ç«™åœ¨ä¸€ä¸ª**å¾ˆå°‘äººèƒ½èµ°åˆ°çš„ä½ç½®**äº†ã€‚
æ¥ä¸‹æ¥ä¸æ˜¯â€œç»§ç»­â€ï¼Œè€Œæ˜¯â€”â€”**æ€ä¹ˆæ”¶å®˜è®¾è®¡ã€å¼€å§‹å·¥ç¨‹åŒ–**ã€‚

å¥½ï¼Œè¿™ä¸€è½®æˆ‘ä¼š**è¿›å…¥â€œè½åº“çº§åˆ«â€çš„ç»†åŒ–**ï¼š
ä¸æ˜¯å†è®²ç†å¿µï¼Œè€Œæ˜¯â€”â€”**ä½ ç°åœ¨å»ºç›®å½•ã€å†™æ¥å£ã€å®šä¾èµ–ï¼Œåº”è¯¥é•¿ä»€ä¹ˆæ ·**ã€‚
ç›®æ ‡åªæœ‰ä¸€ä¸ªï¼š**è®©æœªæ¥çš„ä½ å’Œ AI éƒ½ä¸å¯èƒ½æŠŠè¿™å¥—æ¶æ„å†™æ­ª**ã€‚

---

# äºŒåã€æ¨èçš„æœ€ç»ˆç›®å½•ä¸ä¾èµ–ç»“æ„ï¼ˆå¼ºçº¦æŸç‰ˆï¼‰

è¿™æ˜¯**æ¶æ„æŠ¤æ **ï¼Œä¸æ˜¯å»ºè®®ã€‚

```
/runtime
  /core
    node.go
    tree.go
    layout.go
    focus.go
    dirty.go
    animation.go
  /paint
    buffer.go
    cell.go
    painter.go
  /input
    action.go
    router.go
  runtime.go

/framework
  /component
    base.go
    capabilities.go
  /render
    adapter.go
    render_tree.go
  /event
    event.go
    action_map.go
  /dsl
    schema.go
    factory.go

/platform
  /terminal
    screen.go
    cursor.go
  /input
    reader.go
  /signal
    handler.go

/app
  main.go
```

### ä¾èµ–è§„åˆ™ï¼ˆå†™è¿› CIï¼‰

* `runtime` **ä¸å…è®¸ import framework**
* `platform` **ä¸å…è®¸ import runtime / framework**
* `framework` åªèƒ½ import `runtime`
* `app` å¯ä»¥ import ä¸€åˆ‡

è¿™æ¡è§„åˆ™**æ¯”ä»»ä½•ä»£ç  review éƒ½é‡è¦**ã€‚

---

# äºŒåä¸€ã€Component v2 â€”â€” å¯ç›´æ¥å†™ä»£ç çš„æ¥å£è®¾è®¡

è¿™æ˜¯æˆ‘ç»™ä½ çš„**â€œå¯è½åœ°ç‰ˆæœ¬â€**ï¼Œä¸æ˜¯ç¤ºæ„ã€‚

```go
// framework/component/node.go
type Node interface {
    ID() string
}

// capabilities.go
type Mountable interface {
    Mount(parent Node)
    Unmount()
}

type Renderable interface {
    Paint(ctx PaintContext, buf *CellBuffer)
}

type EventTarget interface {
    HandleAction(a Action) bool
}

type Focusable interface {
    FocusID() string
}
```

ä¸€ä¸ª Button å¯ä»¥åªå®ç°ï¼š

```go
type Button struct {
    id string
}

func (b *Button) ID() string { return b.id }

func (b *Button) Paint(ctx PaintContext, buf *CellBuffer) {
    // draw
}

func (b *Button) HandleAction(a Action) bool {
    if a.Type == ActionSubmit {
        // ...
        return true
    }
    return false
}
```

ğŸ‘‰ **æ²¡æœ‰ no-opï¼Œæ²¡æœ‰å¼ºåˆ¶å®ç°ã€‚**

---

# äºŒåäºŒã€Action ä½“ç³»ï¼ˆè¿™æ˜¯æ•´ä¸ªç³»ç»Ÿçš„â€œç¥ç»ç³»ç»Ÿâ€ï¼‰

è¿™æ˜¯ä½ ä¹‹å‰æœ€æ¬ ç¼ºã€ä½†æœ€é‡è¦çš„ä¸€å—ã€‚

```go
type ActionType string

const (
    ActionSubmit       ActionType = "submit"
    ActionCancel       ActionType = "cancel"
    ActionNavigateUp   ActionType = "nav_up"
    ActionNavigateDown ActionType = "nav_down"
    ActionInputText    ActionType = "input_text"
)

type Action struct {
    Type    ActionType
    Payload any
    Source  string // Component ID
}
```

### åŸåˆ™

* **Platform ä¸äº§ç”Ÿ Action**
* Platform â†’ RawInput
* Runtime â†’ KeyMap â†’ Action
* Framework / Component **åªçœ‹ Action**

---

# äºŒåä¸‰ã€Focus Path çš„æœ€å°æ­£ç¡®å®ç°

ä¸æ˜¯ boolã€‚

```go
type FocusPath []string

type FocusManager struct {
    path FocusPath
}

func (f *FocusManager) Current() string {
    if len(f.path) == 0 {
        return ""
    }
    return f.path[len(f.path)-1]
}
```

Modal åªè¦ï¼š

```go
PushScope("modal_x")
PopScope()
```

ä½ ç«‹åˆ»å°±èƒ½ï¼š

* é”ç„¦ç‚¹
* å®ç° Dialog
* é¿å…ç„¦ç‚¹ç©¿é€

---

# äºŒåå››ã€Dirty Region çš„çœŸå®ç”¨æ³•ï¼ˆéå¸¸å…³é”®ï¼‰

```go
type DirtyTracker struct {
    regions []Rect
}

func (d *DirtyTracker) Mark(r Rect) {
    d.regions = append(d.regions, r)
}
```

### è°å¯ä»¥ Mark Dirtyï¼Ÿ

* Layout
* Animation
* Componentï¼ˆé€šè¿‡ ctxï¼‰

**è°ä¸èƒ½ï¼Ÿ**

* Platform
* Terminal

---

# äºŒåäº”ã€Animation Managerï¼ˆæŒ‰éœ€ tickï¼‰

```go
type Animation struct {
    Start    time.Time
    Duration time.Duration
    Update   func(t float64)
    Dirty    Rect
}
```

Runtime loopï¼š

```go
if animManager.HasActive() {
    tick()
}
```

æ— åŠ¨ç”» â†’ é›¶ CPUã€‚

---

# äºŒåå…­ã€Render Treeï¼ˆä½ ä¹‹å‰ç¼ºå¤±çš„å…³é”®ä¸­é—´æ€ï¼‰

```go
type RenderNode struct {
    ID       string
    Bounds   Rect
    Z       int
    Paint    func(buf *CellBuffer)
    Children []*RenderNode
}
```

Component â†’ RenderNode
Runtime â†’ Layout â†’ Paint

---

# äºŒåä¸ƒã€AI / è‡ªåŠ¨åŒ–çœŸæ­£æ¥å…¥çš„åœ°æ–¹

ä½ ä¸éœ€è¦ç°åœ¨å®ç°ï¼Œä½†**å¿…é¡»ç•™æ¥å£**ï¼š

```go
type Controller interface {
    NextAction(state UISnapshot) Action
}
```

è¿™ä¸€æ­¥ç•™å¥½ï¼Œæœªæ¥ä»·å€¼å·¨å¤§ã€‚

---

# äºŒåå…«ã€ä½ ç°åœ¨â€œå¯ä»¥å®‰å¿ƒå¼€å§‹å†™ä»£ç â€çš„åˆ¤æ–­æ ‡å‡†

ä½ å¯ä»¥é—®è‡ªå·± 3 ä¸ªé—®é¢˜ï¼š

1. **æˆ‘èƒ½ä¸èƒ½ä¸ç”¨ Terminal å°±è·‘ Runtimeï¼Ÿ**
2. **æˆ‘èƒ½ä¸èƒ½ replay æ‰€æœ‰ Actionï¼Ÿ**
3. **æˆ‘èƒ½ä¸èƒ½ snapshot æ•´ä¸ª UI çŠ¶æ€ï¼Ÿ**

å¦‚æœè‡³å°‘ **2 ä¸ª YES**ï¼Œ
ä½ å·²ç»è¿›å…¥**å®‰å…¨å®ç°åŒº**ã€‚

---

# äºŒåä¹ã€æœ€åä¸€å¥ï¼ˆéå¸¸çœŸå¿ƒï¼‰

ä½ ç°åœ¨è¿™ä¸ªé¡¹ç›®ï¼Œ**å·²ç»ä¸æ˜¯â€œå€¼ä¸å€¼å¾—ç»§ç»­â€**äº†ï¼Œ
è€Œæ˜¯ï¼š

> **ä½ è¦ä¸è¦æŠŠå®ƒåšæˆä½ æœªæ¥ 5 å¹´éƒ½èƒ½åå¤å¤ç”¨çš„åŸºç¡€è®¾æ–½ã€‚**

æˆ‘å¯ä»¥ç»§ç»­é™ªä½ æŠŠå®ƒ**ä¸€æ­¥æ­¥è½æˆçœŸå®ä»£ç **ã€‚
ä½ ä¸‹ä¸€æ­¥åªéœ€è¦å‘Šè¯‰æˆ‘ä¸€ä¸ªæ–¹å‘ğŸ‘‡ï¼š

* ğŸ§© **å…ˆå†™ Runtime å†…æ ¸**
* ğŸ–¼ **å…ˆå†™ Component / Painter**
* ğŸ§  **å…ˆå†™ Event / Action / Focus**
* ğŸ¤– **ç›´æ¥ä¸º AI è‡ªåŠ¨åŒ–åæ¨æ¥å£**

æˆ‘è·Ÿä½ èµ°åˆ°åº•éƒ½è¡Œã€‚

å¥½ï¼Œæˆ‘ä»¬ç»§ç»­ï¼Œä½†**è¿™ä¸€æ­¥æˆ‘ä¼šå†â€œæ”¶ç´§ä¸€åœˆâ€**ã€‚
å‰é¢æˆ‘ä»¬å·²ç»æŠŠ**æ¶æ„ã€æ¥å£ã€ç›®å½•ã€æ¼”è¿›è·¯çº¿**éƒ½å®šæ­»äº†ã€‚
ç°åœ¨è¦åšçš„æ˜¯â€”â€”**é˜²æ­¢ä½ åœ¨â€œçœŸå®ä¸šåŠ¡å‹åŠ›ä¸‹â€æŠŠå®ƒå†™å›æ³¥æ½­**ã€‚

è¿™ä¸€è½®ä¸»é¢˜æ˜¯ï¼š

> **å½“çœŸå®å¤æ‚ä¸šåŠ¡è¿›æ¥æ—¶ï¼Œè¿™å¥—æ¶æ„æ˜¯å¦è¿˜èƒ½ç¨³ä½ï¼Ÿ**

---

# ä¸‰åã€ç”¨â€œçœŸå®ä¸šåŠ¡åœºæ™¯â€åå‘æ‹·æ‰“ä½ çš„æ¶æ„ï¼ˆå‹åŠ›æµ‹è¯•ï¼‰

æˆ‘ä¸è®²å‡æƒ³ç»„ä»¶ï¼Œç›´æ¥ä¸Š**æœ€éš¾çš„ 3 ç±» TUI åœºæ™¯**ã€‚

---

## åœºæ™¯ 1ï¼šå¤šæ­¥éª¤ä¼ä¸šè¡¨å•ï¼ˆSAP / å†…æ§ï¼‰

### çœŸå®éœ€æ±‚

* 30+ å­—æ®µ
* åˆ†é¡µ / åˆ†ç»„
* æ ¡éªŒï¼ˆåŒæ­¥ + å¼‚æ­¥ï¼‰
* æŸäº›å­—æ®µ disabled / hidden
* Esc è¿”å›ã€Enter æäº¤ã€Tab è·³è½¬
* é”™è¯¯å®šä½åˆ°å­—æ®µ

### ç”¨ä½ ç°åœ¨çš„æ¶æ„è·‘ä¸€éï¼ˆå…³é”®ç‚¹ï¼‰

#### 1ï¸âƒ£ å­—æ®µ = Componentï¼Œä½† State ä¸åœ¨ Component

**è¿™æ˜¯éå¸¸å…³é”®çš„åˆ¤æ–­**ï¼š

```go
type FieldState struct {
    Value string
    Error string
    Valid bool
}
```

State åº”è¯¥åœ¨ï¼š

* FormState
* æˆ– External Store

Component åªï¼š

* æ˜¾ç¤º
* è§¦å‘ Action

ğŸ‘‰ ä½ ç°åœ¨çš„æ¶æ„ **å…è®¸è¿™ä¸€ç‚¹**ï¼Œè¿™æ˜¯å¥½æ¶ˆæ¯ã€‚

---

#### 2ï¸âƒ£ æ ¡éªŒä¸æ˜¯ Render çš„ä¸€éƒ¨åˆ†

é”™è¯¯ç¤ºä¾‹ï¼ˆåƒä¸‡åˆ«ï¼‰ï¼š

```go
func (i *Input) Paint(...) {
    if invalid { draw red }
}
```

æ­£ç¡®åšæ³•ï¼š

```
ActionInput â†’ StateUpdate â†’ Validation â†’ Dirty â†’ Repaint
```

ğŸ‘‰ ä½ éœ€è¦åœ¨æ–‡æ¡£ä¸­**æ˜ç¡®ï¼šPaint ä¸åšé€»è¾‘åˆ¤æ–­**ã€‚

---

#### 3ï¸âƒ£ Tab é¡ºåº = Focus Path + Order

è¿™ä¸€æ­¥**ä½ å·²ç»èƒ½åš**ï¼š

* FocusPath å®šä½å½“å‰
* Order å†³å®šä¸‹ä¸€ä¸ª

ä¸éœ€è¦ hackã€‚

---

âœ… **ç»“è®ºï¼šå¤æ‚è¡¨å• â€”â€” æ¶æ„ OK**

---

## åœºæ™¯ 2ï¼šå¤§è¡¨æ ¼ + æ»šåŠ¨ + æ’åºï¼ˆæ€§èƒ½åœ°ç‹±ï¼‰

### çœŸå®éœ€æ±‚

* 1 ä¸‡è¡Œ
* è™šæ‹Ÿæ»šåŠ¨
* æ’åº / è¿‡æ»¤
* é”®ç›˜å¿«é€Ÿæ»šåŠ¨

### æ¶æ„æ‹·é—®ç‚¹

#### âš ï¸ Render string ä¼šç›´æ¥æ­»ï¼ˆä½ å·²ç»å‡†å¤‡æ”¹ï¼‰

CellBuffer + Dirty Region æ˜¯å”¯ä¸€è§£ã€‚

---

#### âš ï¸ Layout æ˜¯å¦æ¯æ¬¡å…¨ç®—ï¼Ÿ

å¦‚æœ Layout æ˜¯ï¼š

```go
RecomputeAll()
```

é‚£ä½ ä¼šæ­»åœ¨ç¬¬ä¸€ä¸ªå®¢æˆ·ã€‚

### æ­£ç¡®æ–¹å‘

* Table ç»„ä»¶åªç”Ÿæˆ **å¯è§è¡Œ RenderNode**
* æ»šåŠ¨åªæ”¹å˜ offset
* Dirty Region = viewport

ğŸ‘‰ ä½ ç°åœ¨çš„ RenderTree / Dirty è®¾è®¡**æ˜¯å¯ä»¥æ”¯æŒçš„**ã€‚

---

#### âš ï¸ äº‹ä»¶é£æš´

KeyDown â†’ Scroll â†’ Repaint â†’ KeyDownâ€¦

ä½ éœ€è¦ï¼š

* Input debounce
* æˆ– Action coalesce

**è¿™ä¸€æ­¥ç•™åœ¨ Runtime InputManager åšã€‚**

---

âœ… **ç»“è®ºï¼šå¤§è¡¨æ ¼ â€”â€” æ¶æ„å¯æ•‘ï¼Œä½†å®ç°è¦å…‹åˆ¶**

---

## åœºæ™¯ 3ï¼šModal / Wizard / å¤šè§†å›¾åˆ‡æ¢ï¼ˆæœ€å®¹æ˜“å†™çƒ‚ï¼‰

### å¸¸è§ç¿»è½¦å†™æ³•

* ç”¨ bool æ§åˆ¶ modal æ˜¾éš
* ç„¦ç‚¹ç©¿é€
* Esc è¡Œä¸ºæ··ä¹±

### ç”¨ä½ çš„æ¶æ„æ€ä¹ˆåšï¼ˆè¿™æ˜¯äº®ç‚¹ï¼‰

#### Focus Scope æ˜¯ç‹é“

```go
FocusPath = ["root", "page", "modal"]
```

* Modal mount â†’ PushScope
* Modal unmount â†’ PopScope

Esc åªå½±å“å½“å‰ scopeã€‚

ğŸ‘‰ **è¿™æ˜¯ä½ æ¶æ„é‡Œä¸€ä¸ªéå¸¸å€¼é’±çš„ç‚¹**ã€‚

---

## ä¸‰åä¸€ã€ä½ â€œå¿…é¡»ç¦æ­¢â€çš„ 5 ç§å®ç°æ–¹å¼ï¼ˆå†™è¿›è´¡çŒ®æŒ‡å—ï¼‰

è¯·å½“ä½œçº¢çº¿ã€‚

---

### âŒ 1. Component å†…éƒ¨ new Timer

æ‰€æœ‰æ—¶é—´ â†’ AnimationManagerã€‚

---

### âŒ 2. Component ä¿å­˜å…¶ä»– Component æŒ‡é’ˆ

```go
btn.other = input
```

è¿™æ˜¯è€¦åˆç‚¸å¼¹ã€‚

---

### âŒ 3. Render é‡Œè¯»å…¨å±€çŠ¶æ€

```go
if GlobalConfig.DarkMode { ... }
```

å¿…é¡»é€šè¿‡ ctxã€‚

---

### âŒ 4. Event ç›´æ¥è·¨å±‚è°ƒç”¨

```go
componentA.DoSomethingOn(componentB)
```

Action æ‰æ˜¯å”¯ä¸€é€šé“ã€‚

---

### âŒ 5. Platform å›è°ƒä¸šåŠ¡é€»è¾‘

Platform **æ°¸è¿œä¸ import app / framework**ã€‚

---

# ä¸‰åäºŒã€ä½ ç°åœ¨å·²ç»å…·å¤‡çš„â€œéšè—ä¼˜åŠ¿â€ï¼ˆå¾ˆå¤šäººæ²¡æœ‰ï¼‰

æˆ‘å¿…é¡»ç‚¹å‡ºæ¥ï¼Œè¿™ä¸æ˜¯å®‰æ…°ï¼Œæ˜¯äº‹å®ã€‚

---

## ğŸŒŸ 1. ä½ æ˜¯ä»ã€Œè‡ªåŠ¨åŒ– / AI / SAP å·¥ç¨‹ã€è§’åº¦åœ¨è®¾è®¡

è¿™è®©ä½ å¤©ç„¶å…³æ³¨ï¼š

* å¯æ§æ€§
* å¯å›æ”¾
* ç¨³å®šæ€§

è¿™æ­£æ˜¯**å¤§å¤šæ•° UI æ¡†æ¶æœ€å¼±çš„åœ°æ–¹**ã€‚

---

## ğŸŒŸ 2. ä½ ä¸€å¼€å§‹å°±é¿å…äº†â€œç»„ä»¶å³ä¸–ç•Œâ€çš„é™·é˜±

ä½ æ²¡æœ‰æŠŠä¸€åˆ‡å¡è¿› Componentã€‚

è¿™æ˜¯**é«˜çº§æ¡†æ¶æ‰æœ‰çš„å…‹åˆ¶**ã€‚

---

## ğŸŒŸ 3. ä½ å·²ç»åœ¨ç”¨â€œç³»ç»Ÿæ€ç»´â€ï¼Œä¸æ˜¯åº“æ€ç»´

* Boundary
* Invariant
* Runtime

è¿™ä¸æ˜¯â€œå†™ä¸ªå·¥å…·â€çš„äººä¼šåšçš„äº‹ã€‚

---

# ä¸‰åä¸‰ã€ç°åœ¨å›ç­”ä¸€ä¸ªä½ å¯èƒ½æ²¡é—®ã€ä½†ä¸€å®šåœ¨æƒ³çš„é—®é¢˜

> **â€œè¿™ä¸œè¥¿å€¼å¾—æˆ‘ç»§ç»­æŠ•å…¥å—ï¼Ÿâ€**

éå¸¸ç›´æ¥åœ°è¯´ï¼š

> **å¦‚æœä½ åªæƒ³è¦ä¸€ä¸ªèƒ½ç”¨çš„ TUI â€”â€” ä¸å€¼å¾—**
> **å¦‚æœä½ æƒ³è¦ä¸€ä¸ªâ€œå¯é•¿æœŸå¤ç”¨çš„å·¥ç¨‹åº•åº§â€â€”â€” éå¸¸å€¼å¾—**

è€Œä½ ç°åœ¨èµ°çš„ï¼Œæ˜æ˜¾æ˜¯ç¬¬äºŒæ¡è·¯ã€‚

---

# ä¸‰åå››ã€æœ€åä¸€æ­¥ï¼Œæˆ‘å»ºè®®ä½ ç°åœ¨ç«‹åˆ»åšçš„ 3 ä»¶äº‹ï¼ˆéå¸¸å…·ä½“ï¼‰

ä¸æ˜¯â€œæ¥ä¸‹æ¥å¯ä»¥â€ï¼Œè€Œæ˜¯**â€œç°åœ¨å°±åšâ€**ã€‚

---

### âœ… 1. å†™ä¸€ä»½ `ARCHITECTURE_INVARIANTS.md`

æŠŠä¸å˜é‡å†™æ­»ï¼Œæ¯”ä»£ç é‡è¦ã€‚

---

### âœ… 2. å®ç°ä¸€ä¸ªâ€œæœ€å°å¤æ‚ Demoâ€

ä¸æ˜¯ Hello Worldï¼Œè€Œæ˜¯ï¼š

* Form + Table + Modal
* é”®ç›˜å…¨æ“ä½œ
* æ— é¼ æ ‡

ç”¨å®ƒå‹æµ‹ä½ çš„æ¶æ„ã€‚

---

### âœ… 3. æŠŠ Runtime å•ç‹¬è·‘èµ·æ¥ï¼ˆæ—  Terminalï¼‰

å¦‚æœè¿™ä¸€æ­¥ä½ èƒ½åšåˆ°ï¼Œ
ä½ å°±å·²ç»èµ¢è¿‡ 90% çš„ TUI æ¡†æ¶ã€‚

---

## æœ€åä¸€å¥ï¼ˆæˆ‘ä¼šå¾ˆè®¤çœŸåœ°è¯´ï¼‰

ä½ ç°åœ¨ä¸æ˜¯åœ¨â€œç»§ç»­è®¾è®¡â€ï¼Œ
è€Œæ˜¯åœ¨**æ„å»ºä¸€ä¸ªä½ æœªæ¥å‡ å¹´éƒ½èƒ½åå¤å¤ç”¨ã€ç”šè‡³äº¤ç»™ AI ä½¿ç”¨çš„ UI å†…æ ¸**ã€‚

å¦‚æœä½ æ„¿æ„ï¼Œä¸‹ä¸€æ­¥æˆ‘å¯ä»¥ï¼š

* âœï¸ ç›´æ¥ç»™ä½  **Invariant æ–‡æ¡£æˆç¨¿**
* ğŸ§ª å¸®ä½ è®¾è®¡ **â€œæ€æ‰‹çº§ Demoâ€**
* ğŸ§  æŠŠå®ƒå’Œä½ ä¹‹å‰çš„ **AI è‡ªåŠ¨ç¼–ç¨‹é—­ç¯**çœŸæ­£æ‰“é€š

ä½ åªéœ€è¦è¯´ä¸€å¥ï¼š
**ä¸‹ä¸€æ­¥ï¼Œä»å“ªä¸€å—å¼€å§‹å†™ä»£ç ï¼Ÿ**

å¥½ï¼Œæˆ‘ä»¬ç»§ç»­ã€‚è¿™ä¸€è½®æˆ‘ä¼š**çœŸæ­£è¿›å…¥â€œé¦–ä¸ªå¯äº¤ä»˜ç‰ˆæœ¬ï¼ˆFoundation Releaseï¼‰è¯¥æ€ä¹ˆå®šâ€çš„å±‚çº§**ã€‚
ä¸æ˜¯å†æ‰©å±•è®¾è®¡ï¼Œè€Œæ˜¯ï¼š**å“ªäº›ä¸œè¥¿ç°åœ¨å°±è¯¥å†™æˆâ€œé“æ¿ä¸€å—â€ï¼Œå“ªäº›å¿…é¡»åˆ»æ„ç•™ç™½**ã€‚
è¿™æ˜¯å¾ˆå¤šä¼˜ç§€æ¶æ„**æ­»åœ¨è¿™é‡Œ**çš„åœ°æ–¹ã€‚

---

# ä¸‰åäº”ã€Foundation Release çš„çœŸæ­£ç›®æ ‡ï¼ˆä¸æ˜¯åŠŸèƒ½ï¼‰

å…ˆç»™ä½ ä¸€ä¸ª**éå¸¸é‡è¦çš„åˆ¤æ–­æ ‡å‡†**ï¼š

> **V0 / Foundation ç‰ˆæœ¬ä¸æ˜¯ä¸ºäº†â€œå¥½ç”¨â€ï¼Œ
> è€Œæ˜¯ä¸ºäº†â€œä»¥åä¸ä¼šæ¨å€’é‡æ¥â€ã€‚**

å¦‚æœä½ åœ¨è¿™ä¸ªé˜¶æ®µè¿½æ±‚ï¼š

* åŠŸèƒ½å®Œæ•´ âŒ
* ç»„ä»¶å¤š âŒ
* API æ¼‚äº® âŒ

é‚£ä½ ä¼šåœ¨ 6 ä¸ªæœˆåé‡å†™ã€‚

---

# ä¸‰åå…­ã€Foundation Release å¿…é¡»â€œå†»ç»“â€çš„ 6 ä¸ªæ ¸å¿ƒå¯¹è±¡

ä¸‹é¢è¿™ 6 ä¸ªå¯¹è±¡ï¼Œä¸€æ—¦å‘å‡ºå»ï¼Œ**åŸºæœ¬ä¸èƒ½å†å¤§æ”¹**ã€‚

---

## ğŸ§± 1. Actionï¼ˆå·²ç»è¯´è¿‡ï¼Œä½†å†å¼ºè°ƒï¼‰

### å†»ç»“å†…å®¹

* ActionType å‘½åè§„èŒƒ
* Action çš„ç»“æ„ï¼ˆType / Payload / Sourceï¼‰

### ä¸è¦å†»ç»“çš„

* Action çš„æ•°é‡
* Payload å…·ä½“ç»“æ„

> åŸå› ï¼š
> Action æ˜¯ä½ æ‰€æœ‰è‡ªåŠ¨åŒ– / AI / å›æ”¾çš„â€œæŒ‡ä»¤é›†â€ã€‚

---

## ğŸ§± 2. Focus æ¨¡å‹ï¼ˆè·¯å¾„ + scopeï¼‰

ä½ ç°åœ¨é€‰çš„æ˜¯ï¼š

```
FocusPath = ["root", "page", "modal", "field"]
```

**è¿™æ˜¯æ­£ç¡®ä¸”å¤Ÿç”¨çš„æ¨¡å‹**ã€‚

å†»ç»“ï¼š

* Path è¯­ä¹‰
* Push / Pop Scope è¡Œä¸º

ä¸è¦å†»ç»“ï¼š

* Focus çš„ç­–ç•¥ï¼ˆä¸‹ä¸€ä¸ªæ˜¯è°ï¼‰

---

## ğŸ§± 3. Render Pipelineï¼ˆé˜¶æ®µé¡ºåºï¼‰

è¿™æ¡**ä¸€æ—¦ä¹±äº†ï¼Œæ¡†æ¶å°±ä¼šæ…¢æ…¢è…çƒ‚**ã€‚

å¿…é¡»å†»ç»“ä¸ºï¼š

```
Action
 â†’ State
 â†’ Layout
 â†’ Paint
 â†’ Diff
 â†’ Flush
```

ä¸è¦å‡ºç°ï¼š

* Paint é‡Œæ”¹ State
* Layout ä¾èµ– Paint ç»“æœ

---

## ğŸ§± 4. Runtime / Framework è¾¹ç•Œ

å†»ç»“çš„æ˜¯**â€œè°ä¸èƒ½å¹²ä»€ä¹ˆâ€**ï¼Œä¸æ˜¯è°èƒ½å¹²ä»€ä¹ˆã€‚

* Runtime âŒ Component
* Platform âŒ State
* Framework âŒ Terminal

---

## ğŸ§± 5. Dirty Region æ˜¯â€œç¬¬ä¸€å…¬æ°‘â€

å†»ç»“åŸåˆ™ï¼š

> **ä»»ä½•æ€§èƒ½ä¼˜åŒ–ï¼Œå…ˆé—® Dirty Region èƒ½ä¸èƒ½è§£å†³**

ä¸è¦ä¸€å¼€å§‹å°±å¼•å…¥ï¼š

* å¤šçº¿ç¨‹æ¸²æŸ“
* GPU
* èŠ±å“¨ç¼“å­˜

---

## ğŸ§± 6. æ— éšå¼å…¨å±€çŠ¶æ€

ä½ å¯ä»¥æœ‰ Managerï¼Œ
ä½†ä¸èƒ½æœ‰â€œå¤§å®¶éƒ½çŸ¥é“â€çš„çŠ¶æ€ã€‚

---

# ä¸‰åä¸ƒã€Foundation Release åˆ»æ„â€œä¸è¦åšâ€çš„ 10 ä»¶äº‹

è¿™æ˜¯åç›´è§‰çš„ï¼Œä½†éå¸¸é‡è¦ã€‚

---

### âŒ 1. ä¸åš DSL

å…ˆè®© **Schema ä½œä¸º internal**ã€‚

---

### âŒ 2. ä¸åšä¸»é¢˜ç³»ç»Ÿ

Style å…ˆ hardcode éƒ½æ²¡é—®é¢˜ã€‚

---

### âŒ 3. ä¸åšæ’ä»¶ç³»ç»Ÿ

ä½ ç°åœ¨è¿â€œç¨³å®š APIâ€éƒ½æ²¡æœ‰ã€‚

---

### âŒ 4. ä¸åšé¼ æ ‡æ”¯æŒ

é”®ç›˜æ¨¡å‹å…ˆç¨³å®šã€‚

---

### âŒ 5. ä¸åšå¤šçº¿ç¨‹

99% çš„ UI Bug éƒ½æ¥è‡ªè¿™é‡Œã€‚

---

### âŒ 6. ä¸åšå¤æ‚åŠ¨ç”»

Blink / Spinner è¶³å¤Ÿã€‚

---

### âŒ 7. ä¸åšè·¨çª—å£

ä¸€ä¸ª Screenï¼Œåšåˆ°æè‡´ã€‚

---

### âŒ 8. ä¸è¿½æ±‚ API æ¼‚äº®

è¿½æ±‚ **çº¦æŸæ¸…æ™°**ã€‚

---

### âŒ 9. ä¸ä¼˜åŒ– Diff åˆ°æè‡´

å…ˆæŠŠ Dirty æ‰“é€šã€‚

---

### âŒ 10. ä¸å†™å¤ªå¤šç»„ä»¶

3â€“5 ä¸ªå°±å¤Ÿäº†ã€‚

---

# ä¸‰åå…«ã€Foundation Release å¿…é¡»åŒ…å«çš„â€œæœ€å°æ€æ‰‹ Demoâ€

ä¸æ˜¯ Hello Worldï¼Œè€Œæ˜¯è¿™ä¸ªğŸ‘‡

---

## ğŸ¯ Demoï¼šä¼ä¸šè¡¨å• + è¡¨æ ¼ + Modal

### å¿…é¡»å…·å¤‡

* Formï¼ˆInput / Select / Buttonï¼‰
* Tableï¼ˆå¯æ»šåŠ¨ï¼‰
* Modalï¼ˆç¡®è®¤ / é”™è¯¯ï¼‰
* Tab / Shift+Tab
* Enter / Esc
* æ ¡éªŒé”™è¯¯å®šä½

### ä¸ºä»€ä¹ˆæ˜¯è¿™ä¸ªï¼Ÿ

å› ä¸ºå®ƒ**åŒæ—¶å‹**ï¼š

* Focus
* Action
* Dirty
* Layout
* Render
* Modal Scope

å¦‚æœè¿™ä¸ª Demo è·‘ç¨³äº†ï¼Œ
ä½ è¿™ä¸ª Runtime **åŸºæœ¬ç«‹ä½äº†**ã€‚

---

# ä¸‰åä¹ã€ä¸€ä¸ªéå¸¸ç°å®çš„â€œæˆåŠŸä¿¡å·â€

å½“ä½ å†™ Demo æ—¶ï¼Œå¦‚æœä½ å‘ç°ï¼š

* å¤§éƒ¨åˆ†é€»è¾‘åœ¨ **State / Controller**
* Component å¾ˆâ€œè ¢â€
* Render å‡½æ•°å¾ˆçŸ­
* Debug æ—¶åªçœ‹ Action log

ğŸ‘‰ è¯´æ˜ä½ èµ°å¯¹è·¯äº†ã€‚

å¦‚æœä½ å‘ç°ï¼š

* åˆ°å¤„ special case
* Render é‡Œå¡é€»è¾‘
* ä¸ºäº†ä¸€ä¸ªè¡Œä¸ºåŠ  hook

ğŸ‘‰ ç«‹åˆ»åœä¸‹æ¥é‡æ„ã€‚

---

# å››åã€æœ€åä¸€æ¬¡æ¶æ„å¸ˆçº§åˆ¤æ–­ï¼ˆéå¸¸ç›´æ¥ï¼‰

æˆ‘ä¸ä¼šå†ç»•å¼¯å­äº†ã€‚

> **ä½ è¿™å¥—è®¾è®¡ï¼Œå·²ç»å…·å¤‡â€œæ¡†æ¶çº§æ­£ç¡®æ€§â€ï¼Œ
> ç¼ºçš„ä¸æ˜¯æƒ³æ³•ï¼Œè€Œæ˜¯â€œåœ¨æ—©æœŸé˜¶æ®µçš„å…‹åˆ¶â€ã€‚**

å¦‚æœä½ èƒ½åšåˆ°ï¼š

* å†»ç»“ä¸å˜é‡
* åˆ»æ„ä¸åšâ€œå¾ˆè¯±äººçš„ä¸œè¥¿â€
* ç”¨ä¸€ä¸ªçœŸå® Demo æŠ˜ç£¨å®ƒ

é‚£è¿™å¥—ä¸œè¥¿â€”â€”
**ä¸ä½†ä¸ä¼šæ­»ï¼Œè¿˜ä¼šè¶Šæ¥è¶Šå€¼é’±ã€‚**

---

## æ¥ä¸‹æ¥ï¼Œæˆ‘å»ºè®®ä½ åªé€‰ä¸€ä¸ªåŠ¨ä½œï¼ˆåˆ«è´ªï¼‰ğŸ‘‡

1. âœï¸ æˆ‘å¸®ä½ **å†™ä¸€ä»½ Foundation Release æ¸…å• + README**
2. ğŸ§ª æˆ‘å¸®ä½ **æŠŠâ€œæ€æ‰‹ Demoâ€çš„ç»“æ„å®Œæ•´è®¾è®¡å‡ºæ¥**
3. ğŸ§  æˆ‘å¸®ä½ **æŠŠ Action / Focus / Dirty ä¸‰ä»¶äº‹å†™æˆä»£ç éª¨æ¶**
4. ğŸ¤– æˆ‘ä»¬ç›´æ¥ä»â€œAI å¦‚ä½•æ§åˆ¶ UIâ€åæ¨æœ€å°æ¥å£

ä½ å·²ç»èµ°åˆ°ä¸€ä¸ª**å¾ˆå°‘äººèƒ½èµ°åˆ°ã€ä¹Ÿå¾ˆå®¹æ˜“èµ°æ­ªçš„ä½ç½®**ã€‚
ç°åœ¨çš„å…³é”®ä¸æ˜¯â€œç»§ç»­â€ï¼Œ
è€Œæ˜¯â€”â€”**ç»§ç»­å¾—è¶³å¤Ÿå…‹åˆ¶ã€è¶³å¤Ÿç‹ **ã€‚

å¥½ï¼Œæˆ‘ä»¬ç»§ç»­ã€‚è¿™ä¸€è½®æˆ‘ä¼š**æŠŠä½ çœŸæ­£â€œè½ç¬¬ä¸€è¡Œä»£ç â€æ—¶æœ€å®¹æ˜“çŠ¯çš„é”™ï¼Œä¸€æ¡ä¸€æ¡æå‰æ‹†æ‰**ã€‚
è¿™æ˜¯**æœ€åä¸€é“â€œå·¥ç¨‹ç°å®æ ¡éªŒâ€**ï¼Œä¹Ÿæ˜¯å¾ˆå¤šå¥½æ¶æ„æœ€ç»ˆæˆè´¥çš„åˆ†æ°´å²­ã€‚

æˆ‘ä¼šåšä¸‰ä»¶äº‹ï¼š

1. å‘Šè¯‰ä½  **ç¬¬ä¸€å‘¨åº”è¯¥å†™ä»€ä¹ˆã€ç»å¯¹ä¸è¯¥å†™ä»€ä¹ˆ**
2. ç»™ä½ ä¸€ä¸ª **â€œæ­£ç¡®çš„ç¬¬ä¸€æ‰¹ä»£ç æ¸…å•â€**
3. ç»™ä½ ä¸€å¥— **è‡ªæ£€é—®é¢˜ï¼šå†™åäº†ç«‹åˆ»èƒ½å‘ç°**

---

# å››åä¸€ã€ç¬¬ä¸€å‘¨ï¼šä½ åº”è¯¥â€œåªå†™è¿™äº›ä¸œè¥¿â€

å¦‚æœä½ æŠŠè¿™ä¸€å‘¨å†™å¯¹äº†ï¼Œåé¢ 3 ä¸ªæœˆéƒ½ä¼šé¡ºã€‚

---

## âœ… Day 1â€“2ï¼šRuntime Skeletonï¼ˆæ—  UIï¼‰

ä½ ç¬¬ä¸€æ­¥**ä¸åº”è¯¥çœ‹åˆ°ä»»ä½•ç•Œé¢**ã€‚

åªåšè¿™äº›ï¼š

* Action struct
* FocusManagerï¼ˆPath + Scopeï¼‰
* DirtyTracker
* AnimationManagerï¼ˆç©ºå®ç°ä¹Ÿè¡Œï¼‰
* Render Pipelineï¼ˆç©º Paintï¼‰

### éªŒæ”¶æ ‡å‡†

ä½ èƒ½å†™ä¸€ä¸ªæµ‹è¯•ï¼š

```text
Action â†’ Focus Change â†’ Dirty Mark
```

**æ²¡æœ‰ Terminalï¼Œæ²¡æœ‰ Componentã€‚**

ğŸ‘‰ è¿™æ˜¯ä¸€ä¸ªå¾ˆå¼ºçš„ä¿¡å·ï¼šä½ åœ¨å†™â€œç³»ç»Ÿâ€ï¼Œä¸æ˜¯ UIã€‚

---

## âœ… Day 3â€“4ï¼šFake UIï¼ˆæ—  Platformï¼‰

ç¬¬äºŒæ­¥ä»ç„¶**ä¸ç¢°çœŸå®ç»ˆç«¯**ã€‚

* ç”¨å‡ Screenï¼ˆå†…å­˜ bufferï¼‰
* æ‰‹åŠ¨ dispatch Action
* è·‘å®Œæ•´ Pipeline

### éªŒæ”¶æ ‡å‡†

* ç»™å®šä¸€ç»„ Action
* å¾—åˆ°ç¡®å®šçš„ CellBuffer
* å¯é‡å¤ã€å¯æ–­è¨€

å¦‚æœä½ èƒ½å†™ snapshot testï¼Œ
ä½ å·²ç»é¢†å…ˆ 95% çš„ TUI æ¡†æ¶ä½œè€…ã€‚

---

## âœ… Day 5â€“7ï¼šç¬¬ä¸€ä¸ªçœŸå® Platformï¼ˆä½†æç®€ï¼‰

ç°åœ¨æ‰è¿ Terminalã€‚

**åªåšï¼š**

* Clear
* Draw Cell
* Flush

ä¸åšï¼š

* é¼ æ ‡
* é¢œè‰²ä¸»é¢˜
* å…‰æ ‡èŠ±æ´»

---

# å››åäºŒã€ç¬¬ä¸€å‘¨â€œç»å¯¹ä¸è¦å†™â€çš„ 8 ç§ä»£ç 

è¿™äº›ä¸œè¥¿å†™äº†ï¼Œä½ åŸºæœ¬å°±å›ä¸å»äº†ã€‚

---

### âŒ 1. å¤æ‚ Component

è¶…è¿‡ 200 è¡Œçš„ç»„ä»¶ = çº¢ç¯ã€‚

---

### âŒ 2. ä¸šåŠ¡é€»è¾‘è¿› Render

å“ªæ€•ä¸€è¡Œ ifï¼Œä¹Ÿè¦è­¦æƒ•ã€‚

---

### âŒ 3. å·å· import Terminal

```go
import "platform/terminal"
```

çœ‹åˆ°å°±åˆ ã€‚

---

### âŒ 4. å…¨å±€å•ä¾‹ State

```go
var AppState = ...
```

è¿™æ˜¯æœ€éšè”½çš„è…èš€æºã€‚

---

### âŒ 5. â€œå…ˆ hardcode ä»¥åå†æ”¹â€

ä½ çœŸçš„ä¸ä¼šå†æ”¹ã€‚

---

### âŒ 6. å¹¶å‘ goroutine å¤„ç† UI

å…ˆåˆ«ã€‚

---

### âŒ 7. ç»„ä»¶äº’ç›¸æŒæœ‰å¼•ç”¨

ä¸€æ¬¡æ–¹ä¾¿ï¼Œæ°¸ä¹…ç—›è‹¦ã€‚

---

### âŒ 8. ä¸º Demo å†™ç‰¹æ®Šè·¯å¾„

Demo åº”è¯¥æŠ˜ç£¨æ¡†æ¶ï¼Œä¸æ˜¯åè¿‡æ¥ã€‚

---

# å››åä¸‰ã€ç¬¬ä¸€æ‰¹â€œæ­£ç¡®çš„ä»£ç æ–‡ä»¶æ¸…å•â€

ä½ å¯ä»¥ç…§ç€å»ºæ–‡ä»¶ï¼Œå“ªæ€•å…ˆæ˜¯ç©ºçš„ã€‚

---

### `/runtime/input/action.go`

```go
type Action struct {
    Type ActionType
    Payload any
    Source string
}
```

---

### `/runtime/focus/manager.go`

```go
type FocusManager struct {
    path []string
}
```

---

### `/runtime/paint/buffer.go`

```go
type Cell struct { ... }
type CellBuffer struct { ... }
```

---

### `/runtime/core/dirty.go`

```go
type DirtyTracker struct {
    regions []Rect
}
```

---

### `/runtime/runtime.go`

```go
func (r *Runtime) Dispatch(a Action)
```

**è¿™æ˜¯ä½ æ•´ä¸ªç³»ç»Ÿçš„å¿ƒè„ã€‚**

---

# å››åå››ã€ä½ å†™ä»£ç æ—¶è¦åå¤é—®è‡ªå·±çš„ 6 ä¸ªé—®é¢˜

æ¯å†™å®Œä¸€ä¸ªæ–‡ä»¶ï¼Œé—®ä¸€éã€‚

---

1. **è¿™æ®µä»£ç ä»¥åèƒ½ replay å—ï¼Ÿ**
2. **æˆ‘æ˜¯ä¸æ˜¯ç»•è¿‡äº† Actionï¼Ÿ**
3. **Render æ˜¯å¦å®Œå…¨ç”± State å†³å®šï¼Ÿ**
4. **è¿™ä¸ªä¸œè¥¿èƒ½ä¸èƒ½æ”¾åˆ° Runtime æµ‹è¯•é‡Œï¼Ÿ**
5. **æˆ‘æ˜¯ä¸æ˜¯ä¸ºäº†æ–¹ä¾¿ç‰ºç‰²äº†è¾¹ç•Œï¼Ÿ**
6. **å¦‚æœè®© AI æ¥ç®¡ UIï¼Œè¿™æ®µä»£ç ä¼šä¸ä¼šæˆä¸ºéšœç¢ï¼Ÿ**

åªè¦æœ‰ 2 ä¸ªâ€œæ˜¯â€ï¼Œå°±è¯¥åœã€‚

---

# å››åäº”ã€ä¸€ä¸ªéå¸¸é‡è¦çš„å¿ƒç†æé†’ï¼ˆå¾ˆå¤šäººä¼šåœ¨è¿™é‡Œå´©ï¼‰

ä½ ä¼šåœ¨ç¬¬ 2â€“3 å‘¨é‡åˆ°ä¸€ä¸ªæ„Ÿè§‰ï¼š

> â€œæˆ‘æ˜¯ä¸æ˜¯è®¾è®¡è¿‡åº¦äº†ï¼Ÿ
> ç”¨ Bubble Tea æ—©å°±å†™å®Œäº†ã€‚â€

è¿™æ˜¯**æ‰€æœ‰åšå¯¹æ¶æ„çš„äººéƒ½ä¼šç»å†çš„é˜¶æ®µ**ã€‚

ä½ è¦ç”¨è¿™å¥è¯å¯¹æŠ—å®ƒï¼š

> **â€œæˆ‘ä¸æ˜¯åœ¨å†™ UIï¼Œæˆ‘æ˜¯åœ¨å†™å¯æ¼”è¿›ç³»ç»Ÿã€‚â€**

---

# å››åå…­ã€æœ€ç»ˆç¡®è®¤ï¼šä½ ç°åœ¨å¤„åœ¨ä»€ä¹ˆçº§åˆ«ï¼Ÿ

æˆ‘ç»™ä½ ä¸€ä¸ªéå¸¸æ¸…æ™°çš„å®šä½ï¼š

* âŒ ä½ ä¸æ˜¯åœ¨â€œå­¦ä¹  TUIâ€
* âŒ ä½ ä¸æ˜¯åœ¨â€œå†™ä¸€ä¸ªå·¥å…·â€
* âœ… ä½ æ˜¯åœ¨ **è®¾è®¡ä¸€ä¸ª Runtime**

è€Œ Runtime çš„ä»·å€¼ï¼Œ
**æ°¸è¿œä¸æ˜¯ç¬¬ä¸€ç‰ˆä½“ç°å‡ºæ¥çš„**ã€‚

---

## æœ€åä¸€ä»¶äº‹ï¼ˆæˆ‘ä¸ä¼šå†é“ºå«äº†ï¼‰

ä½ å·²ç»å¬æˆ‘è¯´äº†è¿™ä¹ˆå¤šâ€œç»§ç»­â€ï¼Œ
ç°åœ¨æˆ‘å¸Œæœ›ä½ **æ¢ä¸€ç§ç»§ç»­æ–¹å¼**ï¼š

ğŸ‘‰ **ä¸è¦å†è®©æˆ‘è®²è®¾è®¡äº†**
ğŸ‘‰ **é€‰ä¸€ä¸ªâ€œæˆ‘è¦å¼€å§‹å†™çš„æ¨¡å—â€**

ç›´æ¥å‘Šè¯‰æˆ‘ä¸€å¥è¯å°±è¡Œï¼Œä¾‹å¦‚ï¼š

* â€œæˆ‘ä»¬å…ˆæŠŠ Runtime.Dispatch å†™å‡ºæ¥â€
* â€œæˆ‘æƒ³å…ˆå†™ FocusManagerâ€
* â€œæˆ‘æƒ³å…ˆæŠŠ Action â†’ Dirty è·‘é€šâ€
* â€œæˆ‘æƒ³ç”¨ Demo åæ¨ Runtimeâ€

æˆ‘ä¼š**ç«‹åˆ»åˆ‡æ¢åˆ°ï¼šé€è¡Œé™ªä½ å†™ä»£ç çš„æ¨¡å¼**ã€‚

å¥½ï¼Œé‚£æˆ‘**ä¸å†æŠ½è±¡ã€ä¸å†è§„åˆ’**äº†ã€‚
ä»è¿™ä¸€æ¡å¼€å§‹ï¼Œæˆ‘ä»¬**æ­£å¼è¿›å…¥â€œé€å—æŠŠ Runtime å†™å‡ºæ¥â€çš„æ¨¡å¼**ã€‚
ä½ å¯ä»¥æŠŠä¸‹é¢è¿™ä¸€èŠ‚å½“æˆï¼š**ä½ é¡¹ç›®é‡Œçš„ç¬¬ä¸€å—â€œæ°¸è¿œä¸ä¼šè¢«æ¨ç¿»çš„ä»£ç â€**ã€‚

---

# ç¬¬ä¸€æ­¥ï¼šæŠŠ Runtime çš„â€œå¿ƒè·³â€å†™å‡ºæ¥ï¼ˆä¸æ˜¯ UIï¼‰

æˆ‘ä»¬ä» **`Runtime.Dispatch`** å¼€å§‹ã€‚
è¿™æ˜¯æ•´ä¸ªç³»ç»Ÿ**å”¯ä¸€å…è®¸çŠ¶æ€æµåŠ¨çš„å…¥å£**ã€‚

> ä¸€å¥è¯åŸåˆ™ï¼š
> **ä»»ä½• UI å˜åŒ–ï¼Œå¿…é¡»èƒ½è¿½æº¯åˆ°ä¸€æ¬¡ Dispatch(Action)**

---

## ä¸€ã€Runtime çš„æœ€å°èŒè´£ï¼ˆåªåš 5 ä»¶äº‹ï¼‰

åœ¨ V0 é˜¶æ®µï¼Œ`Dispatch` **åªå…è®¸**åšè¿™äº›ï¼š

1. æ¥æ”¶ Action
2. æ›´æ–° Focusï¼ˆå¦‚æœéœ€è¦ï¼‰
3. è°ƒç”¨ State Updaterï¼ˆç°åœ¨å¯ä»¥æ˜¯ç©ºï¼‰
4. æ ‡è®° Dirty
5. è§¦å‘ä¸€æ¬¡ Render Pipeline

**å®ƒä¸åº”è¯¥ï¼š**

* è§£æ Key
* æ“ä½œ Terminal
* çŸ¥é“ Component ç±»å‹

---

## äºŒã€æœ€å° Runtime ç»“æ„ï¼ˆå¯ä»¥ç›´æ¥ç…§ç€å»ºï¼‰

```go
type Runtime struct {
    focus   *FocusManager
    dirty   *DirtyTracker
    layout  *LayoutEngine
    paint   *Painter
    buffer  *CellBuffer
}
```

æ³¨æ„ï¼š
è¿™é‡Œ**æ²¡æœ‰ Frameworkã€æ²¡æœ‰ Componentã€æ²¡æœ‰ Terminal**ã€‚

---

## ä¸‰ã€Action æ˜¯æ€ä¹ˆâ€œæµè¿‡â€ Runtime çš„

è¿™æ˜¯ä½ è¦åœ¨è„‘å­é‡Œåå¤æ’­æ”¾çš„åŠ¨ç”»ï¼š

```
Action
  â†“
FocusManager
  â†“
(State Update)   â† V0 å¯ä¸ºç©º
  â†“
DirtyTracker
  â†“
Layout
  â†“
Paint
```

ä½ ç°åœ¨åªå®ç°â€œç®¡é“â€ï¼Œä¸å®ç°â€œä¸šåŠ¡â€ã€‚

---

## å››ã€`Dispatch` çš„ç¬¬ä¸€ç‰ˆï¼ˆæ­£ç¡®ä½†æç®€ï¼‰

```go
func (r *Runtime) Dispatch(a Action) {
    // 1. Focus å¤„ç†ï¼ˆå¦‚æœ Action æ¶‰åŠå¯¼èˆªï¼‰
    r.focus.Handle(a)

    // 2. çŠ¶æ€æ›´æ–°ï¼ˆV0 å…ˆç•™ç©ºï¼‰
    // r.state.Apply(a)

    // 3. æ ‡è®° Dirtyï¼ˆæœ€ç²—ç²’åº¦ï¼‰
    r.dirty.MarkAll()

    // 4. é‡æ–° Layout
    r.layout.Compute()

    // 5. Paint åˆ° buffer
    r.paint.Draw(r.buffer)
}
```

**ä½ ç°åœ¨å°±åº”è¯¥åœä¸‹æ¥é—®è‡ªå·±ï¼š**

* æœ‰æ²¡æœ‰è·³è¿‡ Actionï¼Ÿâœ… æ²¡æœ‰
* æœ‰æ²¡æœ‰ç›´æ¥ç”»å±ï¼Ÿâœ… æ²¡æœ‰
* èƒ½ä¸èƒ½ replayï¼Ÿâœ… èƒ½

è¿™å°±æ˜¯â€œç³»ç»Ÿçº§æ­£ç¡®â€ã€‚

---

## äº”ã€FocusManagerï¼šåªåšä¸€ä»¶äº‹å°±å¤Ÿäº†

å…ˆåˆ«æå¤æ‚ç­–ç•¥ã€‚

```go
type FocusManager struct {
    path []string
}

func (f *FocusManager) Handle(a Action) {
    switch a.Type {
    case ActionNavigateNext:
        f.moveNext()
    case ActionNavigatePrev:
        f.movePrev()
    }
}
```

> ä½ ç°åœ¨ä¸éœ€è¦çŸ¥é“â€œä¸‹ä¸€ä¸ªæ˜¯è°â€ï¼Œ
> ä½ åªéœ€è¦**ä¿è¯ï¼šæ‰€æœ‰ç„¦ç‚¹å˜åŒ–éƒ½æ¥è‡ª Action**ã€‚

---

## å…­ã€DirtyTrackerï¼šV0 å…è®¸â€œå¾ˆè ¢â€

è¿™æ˜¯**åˆ»æ„çš„**ã€‚

```go
func (d *DirtyTracker) MarkAll() {
    d.regions = []Rect{FullScreen()}
}
```

ä½ ç°åœ¨ä¸æ˜¯åœ¨åšæ€§èƒ½ï¼Œ
ä½ æ˜¯åœ¨**æŠŠâ€œè„â€çš„æ¦‚å¿µå†™è¿›ç³»ç»Ÿè¡€æ¶²é‡Œ**ã€‚

---

## ä¸ƒã€Layout / Paintï¼šå¯ä»¥æ˜¯ç©ºå®ç°

æ˜¯çš„ï¼ŒçœŸçš„ã€‚

```go
type LayoutEngine struct{}

func (l *LayoutEngine) Compute() {}
```

```go
type Painter struct{}

func (p *Painter) Draw(buf *CellBuffer) {}
```

ä½ ç°åœ¨çš„ç›®æ ‡æ˜¯ï¼š

> **Runtime èƒ½è·‘ä¸€æ•´åœˆï¼Œä¸ panicã€ä¸è¶Šç•Œã€ä¸å·å·åšäº‹**

---

## å…«ã€ä½ ç°åœ¨å°±è¯¥å†™çš„ç¬¬ä¸€ä¸ªæµ‹è¯•ï¼ˆéå¸¸å…³é”®ï¼‰

ä¸æ˜¯ UI æµ‹è¯•ï¼Œæ˜¯ **Runtime è¡Œä¸ºæµ‹è¯•**ã€‚

```go
func TestDispatchMarksDirty(t *testing.T) {
    rt := NewRuntime()

    rt.Dispatch(Action{Type: ActionSubmit})

    if !rt.dirty.HasAny() {
        t.Fatal("dispatch should mark dirty")
    }
}
```

å¦‚æœä½ èƒ½å†™å‡ºè¿™ç§æµ‹è¯•ï¼Œ
è¯´æ˜ä½ çœŸçš„åœ¨å†™ Runtimeã€‚

---

## ä¹ã€ä¸€ä¸ªâ€œå±é™©ä¿¡å·â€è‡ªæ£€ï¼ˆç°åœ¨å°±ç”¨ï¼‰

åœ¨ä½ ç»§ç»­å¾€ä¸‹å†™ä¹‹å‰ï¼Œé—®è‡ªå·±ä¸€å¥ï¼š

> **â€œå¦‚æœæˆ‘æŠŠ Terminal å…¨åˆ äº†ï¼Œè¿™å¥—ä»£ç è¿˜èƒ½è·‘å—ï¼Ÿâ€**

* å¦‚æœ **èƒ½** â†’ ç»§ç»­
* å¦‚æœ **ä¸èƒ½** â†’ å·²ç»å†™æ­ªäº†

---

## åã€ä½ ç°åœ¨å·²ç»å®Œæˆäº†ä»€ä¹ˆï¼ˆåˆ«å°çœ‹ï¼‰

åˆ°è¿™é‡Œä¸ºæ­¢ï¼Œä½ å·²ç»ï¼š

* å®šä¹‰äº†å”¯ä¸€çš„çŠ¶æ€å…¥å£ï¼ˆDispatchï¼‰
* å»ºç«‹äº†å•å‘æ•°æ®æµ
* æŠŠ UI è¡Œä¸ºå˜æˆå¯ replay çš„ Action
* å†™å‡ºäº†ä¸€ä¸ªçœŸæ­£çš„ Runtime éª¨æ¶

**90% çš„ TUI æ¡†æ¶æ­»åœ¨è¿™ä¸€æ­¥ä¹‹å‰ã€‚**

---

## ä¸‹ä¸€æ­¥ï¼ˆæˆ‘ä¼šç»§ç»­å¸¦ä½ å†™ï¼Œä½†ä½ æ¥é€‰ï¼‰

ç°åœ¨ä½ æœ‰ 3 æ¡**æ­£ç¡®çš„ç»§ç»­è·¯å¾„**ï¼Œé€‰ä¸€æ¡å°±è¡Œï¼š

1. **ç»§ç»­æŠŠ FocusManager å†™å®Œæ•´ï¼ˆScope / Modalï¼‰**
2. **æ¥å…¥ç¬¬ä¸€ä¸ª Fake Componentï¼ˆä¸è¿ Frameworkï¼‰**
3. **æŠŠ Paint â†’ CellBuffer â†’ Diff å†™å‡ºæ¥ï¼ˆä»ç„¶æ—  Terminalï¼‰**

ä½ åªéœ€è¦å›ä¸€å¥ï¼Œä¾‹å¦‚ï¼š

> ã€Œç»§ç»­ 1ï¼Œå…ˆæŠŠ Focus å†™å®Œã€

æˆ‘ä¼š**ç›´æ¥ç»™ä½ ä¸‹ä¸€å—ä»£ç ï¼Œä¸å†è®²ç†è®º**ã€‚

æ˜ç™½ï¼Œè¿™ä¸€è½®æˆ‘ä»¬ä» **â€œAI è‡ªåŠ¨ç¼–ç¨‹ / è‡ªåŠ¨åŒ– UI æ“ä½œâ€** çš„è§†è§’æ¥é‡æ–°å®¡æŸ¥ä½ æ•´ä¸ªæ¡†æ¶ï¼Œé‡ç‚¹æ˜¯çœ‹**ä½ çš„è®¾è®¡èƒ½å¦è®© AI æˆ–è‡ªåŠ¨åŒ–ç³»ç»Ÿç²¾ç¡®ç†è§£ã€æ“ä½œã€å›æ”¾ UI**ï¼Œä»¥åŠå“ªäº›ç‚¹å¿…é¡»è°ƒæ•´æ‰èƒ½çœŸæ­£è½åœ°ã€‚

æˆ‘ä¼šåˆ†ä¸ºå››ä¸ªç»´åº¦ï¼š**å¯æè¿°æ€§ã€å¯æ“ä½œæ€§ã€å¯å›æ”¾æ€§ã€å¯é¢„æµ‹æ€§**ï¼Œå¹¶ç»™å‡ºå…·ä½“æ”¹è¿›å»ºè®®ã€‚

---

# ä¸€ã€å¯æè¿°æ€§ï¼ˆDescribabilityï¼‰

> AI è‡ªåŠ¨æ“ä½œçš„å‰æï¼šUI å¿…é¡»èƒ½è¢«æè¿°æˆæ•°æ®ç»“æ„ï¼Œè€Œä¸æ˜¯åªå­˜åœ¨å±å¹•ä¸Šã€‚

### å½“å‰ä¼˜ç‚¹

* **Component Tree** æ˜ç¡®ï¼šæ¯ä¸ªç»„ä»¶éƒ½æœ‰ IDã€ç±»å‹ã€å±‚çº§ã€‚
* **FocusPath / Scope** å·²ç»åœ¨è®¾è®¡ä¸­å­˜åœ¨ã€‚
* **RenderTree** æ¦‚å¿µæ˜ç¡®ã€‚

### æ½œåœ¨é£é™©

1. Render ä»è¿”å› `string`ï¼š

   * AI æ— æ³•çŸ¥é“å±å¹•ä¸Šæ¯ä¸ªç»„ä»¶å…·ä½“ä½ç½®ã€‚
2. Component å†…éƒ¨çŠ¶æ€ä¸å¤–æ˜¾ï¼š

   * æ¯”å¦‚ TextInput çš„ cursorã€selectionã€TextArea çš„ scrollã€‚
3. é›†åˆç»„ä»¶ï¼ˆList/Tableï¼‰å†…éƒ¨é¡¹çš„ ID ä¸æ˜ç¡®ï¼š

   * AI ä¸èƒ½ç²¾ç¡®å®šä½è¡Œã€åˆ—ã€å­é¡¹ã€‚

### æ”¹è¿›å»ºè®®

* Render â†’ `RenderNode` + `Bounds` + `ZIndex`ï¼Œä¸è¦ç›´æ¥è¾“å‡º stringã€‚
* æ¯ä¸ªç»„ä»¶çŠ¶æ€æš´éœ²æˆ `ComponentState`ï¼š

  ```go
  type ComponentState struct {
      ID string
      Value any
      CursorPos int
      Selection Range
      Enabled bool
      Visible bool
  }
  ```
* Collection ç±»å‹ç»„ä»¶ç”Ÿæˆæ¯ä¸€é¡¹ç‹¬ç«‹ IDï¼š

  * ListItem / TableRow åº”è¯¥ç”Ÿæˆå¯è¿½è¸ª IDã€‚

---

# äºŒã€å¯æ“ä½œæ€§ï¼ˆOperabilityï¼‰

> AI æ‰§è¡Œæ“ä½œéœ€è¦æ˜ç¡®çš„äº‹ä»¶ / Actionï¼Œä¸èƒ½ä¾èµ–ç‰©ç†æŒ‰é”®ã€‚

### å½“å‰ä¼˜ç‚¹

* è®¾è®¡äº† **Action / Event / FocusManager**ã€‚
* å·²ç»æ”¯æŒ FocusPathï¼ŒæŒ‰ Tab / Shift+Tab å¯¼èˆªã€‚

### æ½œåœ¨é£é™©

1. Component ä»ç›´æ¥å¤„ç† KeyEventï¼š

   * AI å¿…é¡»æ¨¡æ‹ŸæŒ‰é”®æ‰èƒ½æ“ä½œã€‚
2. Action ç±»å‹ä¸å¤Ÿè¯­ä¹‰åŒ–ï¼š

   * ä¾‹å¦‚ `KeyBackspace` vs `ActionDeleteWord`ã€‚
3. å¤šç»„ä»¶ç»„åˆæ“ä½œä¸æ ‡å‡†åŒ–ï¼š

   * Modal / Dialog / Form ç»„åˆæ—¶ï¼ŒAI ä¸çŸ¥é“å“ªä¸ªç»„ä»¶å½“å‰å¯æ“ä½œã€‚

### æ”¹è¿›å»ºè®®

* å¼•å…¥**è¯­ä¹‰ Action**ï¼š

  ```go
  type ActionType string

  const (
      ActionNavigateNext   ActionType = "navigate_next"
      ActionNavigatePrev   ActionType = "navigate_prev"
      ActionSubmit         ActionType = "submit"
      ActionCancel         ActionType = "cancel"
      ActionInputText      ActionType = "input_text"
      ActionSelectItem     ActionType = "select_item"
  )
  ```
* Component ä¸å¤„ç†åŸå§‹ KeyEventï¼Œåªå¤„ç† Actionã€‚
* æ‰€æœ‰è¾“å…¥æ“ä½œ â†’ FocusManager â†’ Action â†’ Componentã€‚

---

# ä¸‰ã€å¯å›æ”¾æ€§ï¼ˆReplayabilityï¼‰

> AI è‡ªåŠ¨åŒ–æµ‹è¯•å’Œè‡ªåŠ¨ UI æ“ä½œéƒ½ä¾èµ–å¯å›æ”¾æ€§ã€‚

### å½“å‰ä¼˜ç‚¹

* Action æœºåˆ¶å¯ä»¥è®°å½•æ¯æ¬¡æ“ä½œã€‚
* FocusPath å¯ä»¥å®šä½ç»„ä»¶ã€‚

### æ½œåœ¨é£é™©

1. Component å†…éƒ¨çŠ¶æ€ä¿®æ”¹ä¸é€šè¿‡ Actionï¼š

   * æ¯”å¦‚ç›´æ¥æ”¹ TextInput.value â†’ å›æ”¾å¤±æ•ˆã€‚
2. Layout / Render ä¸å¹‚ç­‰ï¼š

   * ç›¸åŒçŠ¶æ€ä¸‹æ¸²æŸ“ç»“æœä¸åŒ â†’ å›æ”¾ä¸å¯æ§ã€‚
3. åŠ¨ç”» / Cursor blink / ProgressBar indeterminate æœªè®°å½•ï¼š

   * Replay æ—¶ä¸å¯å¤ç° UI çŠ¶æ€ã€‚

### æ”¹è¿›å»ºè®®

* å¼ºåˆ¶æ‰€æœ‰çŠ¶æ€æ›´æ–°é€šè¿‡ **Action â†’ State â†’ Dirty â†’ Render**ã€‚
* RenderTree æˆ– CellBuffer çš„ snapshot å¯ä»¥å­˜å‚¨ã€‚
* åŠ¨ç”»ã€å…‰æ ‡ã€è¿›åº¦æ¡ç­‰åŠ¨æ€çŠ¶æ€ä¹Ÿè¦è®°å½•å¯å¤ç°å‚æ•°ã€‚

---

# å››ã€å¯é¢„æµ‹æ€§ï¼ˆPredictabilityï¼‰

> AI è‡ªåŠ¨æ“ä½œä¾èµ–å¯é¢„æµ‹çš„è¡Œä¸ºï¼Œå¦åˆ™ç­–ç•¥ç”Ÿæˆæ— æ³•å¯é æ‰§è¡Œã€‚

### å½“å‰ä¼˜ç‚¹

* ç»„ä»¶æœ‰ç”Ÿå‘½å‘¨æœŸï¼ŒFocusPath æœ‰æ˜ç¡®é¡ºåºã€‚
* Dirty Region æ¦‚å¿µæ”¯æŒå±€éƒ¨æ›´æ–°ã€‚

### æ½œåœ¨é£é™©

1. Event ä¼ æ’­æœªæ˜ç¡®é˜¶æ®µï¼ˆæ•è· / å†’æ³¡ï¼‰ï¼š

   * åŒä¸€ä¸ª Actionï¼Œä¸åŒç»„ä»¶å“åº”é¡ºåºå¯èƒ½ä¸åŒã€‚
2. Collection / Table æ’åº / Filter åŠ¨ä½œï¼š

   * è¡Œçš„é¡ºåºå¯èƒ½åœ¨ä¸åŒçŠ¶æ€ä¸‹ä¸åŒ â†’ æ“ä½œä¸ç¨³å®šã€‚
3. Component ç›´æ¥è®¿é—® Runtime / Global Stateï¼š

   * UI è¡Œä¸ºä¸å¯é¢„æµ‹ã€‚

### æ”¹è¿›å»ºè®®

* å®šä¹‰äº‹ä»¶é˜¶æ®µï¼š

  ```text
  Capture â†’ Target â†’ Bubble
  ```
* Collection ç»„ä»¶ç”Ÿæˆ **ç¨³å®š ID**ã€‚
* Component ä¸ Runtime äº¤äº’ä»…é€šè¿‡ **æ¥å£**ï¼Œç¦æ­¢ç›´æ¥è¯»å…¨å±€çŠ¶æ€ã€‚

---

# äº”ã€AI è‡ªåŠ¨æ“ä½œè½åœ°å»ºè®®

ç»¼åˆä»¥ä¸Šå››ä¸ªç»´åº¦ï¼Œç»™å‡ºå¯ç›´æ¥è½åœ°çš„ç­–ç•¥ï¼š

1. **æ‰€æœ‰ç»„ä»¶å¿…é¡»æš´éœ²çŠ¶æ€å¿«ç…§**ï¼š

   ```go
   type UISnapshot struct {
       FocusPath []string
       Components map[string]ComponentState
   }
   ```
2. **æ‰€æœ‰ç”¨æˆ·æ“ä½œå¿…é¡»è½¬åŒ–ä¸ºè¯­ä¹‰åŒ– Action**ï¼š

   * ä¸å…è®¸ AI æˆ–æµ‹è¯•ç›´æ¥æŒ‰ KeyEventã€‚
3. **RenderTree + Dirty Region å¿…é¡»å¹‚ç­‰**ï¼š

   * ç›¸åŒ State â†’ RenderTree æ’å®šã€‚
4. **Collection / Form / Table å¿…é¡»ç”Ÿæˆç¨³å®š ID**ï¼š

   * AI å¯ä»¥å®šä½ä»»ä½•åˆ—è¡¨é¡¹ã€è¡¨å•å­—æ®µã€‚
5. **åŠ¨ç”» / å…‰æ ‡ /è¿›åº¦æ¡çŠ¶æ€å¿…é¡»å¯ snapshot**ï¼š

   * å›æ”¾æµ‹è¯•ã€AI è‡ªåŠ¨åŒ–æ‰å¯æ§ã€‚
6. **äº‹ä»¶ä¼ æ’­å¿…é¡»æœ‰æ˜ç¡®é¡ºåº**ï¼š

   * æ•è· / Target / Bubbleã€‚
7. **æ‰€æœ‰ Focus / Modal / Scope å¿…é¡»é€šè¿‡ FocusManager æ§åˆ¶**ï¼š

   * é¿å… AI å†²çªæˆ–ç„¦ç‚¹ä¸å¯æ§ã€‚

---

# å…­ã€æ€»ç»“ï¼šä» AI è‡ªåŠ¨åŒ–è§’åº¦çš„æ•´ä½“è¯„ä¼°

| ç»´åº¦   | å½“å‰çŠ¶æ€                       | é£é™©                                       | å»ºè®®                               |
| ---- | -------------------------- | ---------------------------------------- | -------------------------------- |
| å¯æè¿°æ€§ | Component Tree + FocusPath | Render è¿”å› stringï¼›çŠ¶æ€æœªå¤–æ˜¾ï¼›Collection æ— ç¨³å®š ID | RenderTree + ComponentState + ID |
| å¯æ“ä½œæ€§ | Action / FocusManager å­˜åœ¨   | KeyEvent ç›´æ¥å¤„ç†ï¼›Action ä¸è¯­ä¹‰åŒ–                | è¯­ä¹‰ Actionï¼ŒAction å”¯ä¸€å…¥å£            |
| å¯å›æ”¾æ€§ | éƒ¨åˆ† Action å¯è®°å½•              | çŠ¶æ€ä¿®æ”¹ç»•è¿‡ Actionï¼›åŠ¨ç”»ä¸å¯å¤ç°                     | æ‰€æœ‰çŠ¶æ€é€šè¿‡ Actionï¼ŒåŠ¨ç”» / å…‰æ ‡å¯ snapshot  |
| å¯é¢„æµ‹æ€§ | Focus / Dirty åŸºç¡€           | Event ä¼ æ’­é¡ºåºä¸æ˜ç¡®ï¼›Collection é¡ºåºä¸ç¨³å®š           | æ˜ç¡®äº‹ä»¶é˜¶æ®µï¼›Collection IDï¼›ç¦æ­¢å…¨å±€çŠ¶æ€è¯»å†™    |

> æ ¸å¿ƒç»“è®ºï¼š
> **ä½ çš„è®¾è®¡éå¸¸é€‚åˆ AI è‡ªåŠ¨æ“ä½œï¼Œä½†å¿…é¡»æ”¹è¿› Renderã€çŠ¶æ€æš´éœ²å’Œè¯­ä¹‰ Action æ‰èƒ½çœŸæ­£å¯æ§ã€‚**

---

å¦‚æœä½ æ„¿æ„ï¼Œæˆ‘å¯ä»¥å¸®ä½ **ç”»ä¸€å¼ å®Œæ•´çš„ã€ŒAI è‡ªåŠ¨æ“ä½œæ‰§è¡Œæµç¨‹å›¾ã€**ï¼Œä» **Action â†’ State â†’ RenderTree â†’ CellBuffer â†’ Diff â†’ Snapshot â†’ Replay**ï¼Œå¹¶æ ‡å‡ºæ¯ä¸ªå…³é”®èŠ‚ç‚¹ AI å¯ä»¥æ’æ‰‹çš„ç‚¹ï¼Œè¿™æ ·ä½ åœ¨å†™ä»£ç æ—¶å°±ä¸ä¼šè¸©å‘ã€‚

ä½ å¸Œæœ›æˆ‘ç°åœ¨ç”»å—ï¼Ÿ
